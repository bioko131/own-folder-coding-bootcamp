var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Analytics=function(e){return e.Actions={Navigate:"navigate",PrimaryResize:"primary-resize",SecondaryResize:"secondary-resize",Transport:"transport",HideThumbnails:"hide-thumbnails",ShowThumbnails:"show-thumbnails",VolumeUp:"volume-up",VolumeDown:"volume-down",Mute:"mute",Unmute:"unmute",Play:"play",Pause:"pause",Rewind:"rewind",SkipToStart:"skip-to-start",Forward:"forward",SkipToEnd:"skip-to-end",Seek:"seek",Prereq:"prereq",Exit:"exit",Add:{Success:"add-event",Error:"add-error",Retry:"add-retry",Cancel:"add-cancel"},Edit:{Success:"edit-event",Error:"edit-error",Retry:"edit-retry",Cancel:"edit-cancel"},Delete:{Success:"delete-event",Error:"delete-error",Retry:"delete-retry",Cancel:"delete-cancel"},Speed:"speed",Bitrate:"bitrate",SecondaryTab:"secondary-tab",Quality:"quality",Desync:"multi-stream-desync"},e.Labels={Thumbnail:"thumbnail",Transcript:"caption",Content:"chapter",Search:"search",Normal:"normal",Fullscreen:"fullscreen",Hotkey:"hotkey",Login:"login",Folder:"folder",DoubleClick:"double-click",Forward:"forward",Note:"note",Bookmark:"bookmark",Comment:"comment",Question:"question",Access:"access",SessionList:"session-list",Settings:"settings",Share:"share",Editor:"editor",EditContents:"edit-contents",EditTranscript:"edit-transcript",EditSlides:"edit-slides",EditCut:"edit-cut",EditStream:"edit-stream",EditQuestionList:"edit-question-list",PrimaryAhead:"primary-ahead",SecondaryAhead:"secondary-ahead",OndemandAutoLevel:"onedmand-auto",OndemandManualLevel:"ondemand-manual",BroadcastAutoLevel:"broadcast-auto",BroadcastManualLevel:"broadcast-manual"},e.sendEvent=function(e){Panopto.GoogleAnalytics.sendEvent({productId:Panopto.viewer.GAEventProductId.behavior,source:"player",action:e.action,label:e.label})},e.sendFullScreenEvent=function(t,o){e.sendEvent({action:t?e.Actions.PrimaryResize:e.Actions.SecondaryResize,label:o?e.Labels.DoubleClick:e.Labels.Normal})},e.sendDesyncEvent=function(t){Panopto.GoogleAnalytics.sendEvent({productId:Panopto.viewer.GAEventProductId.sync,source:"player",action:e.Actions.Desync,label:t.diff>0?e.Labels.PrimaryAhead:e.Labels.SecondaryAhead,value:Math.round(1e3*Math.abs(t.diff)),customFields:{dimension1:Panopto.webServerFQDN,dimension2:t.deliveryId,dimension3:t.invocationId}})},e.QualityReporter=function(t){var o,n,i,a,r,s,l,u,d,c=!1,p=0,f=!t.isAudioOnly;return l=t.isBroadcast?new RegExp("Sessions/(?:(?:_hlsbc)|(?:_rtmp))/([a-z0-9-]{36})/master.m3u8\\??(.*)","i"):new RegExp("Sessions/[a-z0-9-]{36}/([a-z0-9-]{36}(?:-[a-z0-9-]{36})?)..*hls/master.m3u8\\??(.*)","i"),u=l.exec(t.streamUrl),u&&u.length?(u.length>=2&&(o=u[1]),u.length>=3&&(d=new RegExp("InvocationID=([a-z0-9-]{36})","i").exec(u[2]),n=d&&2===d.length?d[1]:"")):f=!1,{flushQualityReport:function(l,u,d,P,m,v){var h=u-p;f&&c&&h>=t.minDuration&&Panopto.GoogleAnalytics.sendEvent({productId:Panopto.viewer.GAEventProductId.quality,source:"player",action:e.Actions.Quality,label:t.isBroadcast?s?e.Labels.BroadcastAutoLevel:e.Labels.BroadcastManualLevel:s?e.Labels.OndemandAutoLevel:e.Labels.OndemandManualLevel,customFields:{dimension1:Panopto.webServerFQDN,dimension2:o,dimension3:n,metric1:Math.round((i+1)/a*100*h),metric2:Math.round(r/1024*h),metric3:Math.round(h)}}),c=l,p=u,i=d,a=P,r=m,s=v}}},e}(Panopto.Viewer.Analytics||{});var Panopto=Panopto||{};Panopto.Core=Panopto.Core||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=function(e){return e.TimedSyncRate=30,e.ControlSyncRate=1e3,e.SecondarySyncThreshold=1,e.InitialSecondaryThreshold=5,e.SecondaryStreamOffset=1.5,e.MinSegmentGap=1,e.ContiguousSegmentThreshold=.2,e.EndPositionThreshold=.1,e.DeliveryRefreshInterval=6e4,e.BroadcastEndedIncrement=5e3,e.ReopenedBroadcastInterval=3e4,e.QualityReportThreshold=2,e.BroadcastStreamRetryTimeout=5e3,e.BroadcastInitialSyncThreshold=5,e.LivePositionTolerance=1,e.BroadcastEndThreshold=1,e.MaxPositionInterpolation=500,e.SlideDeckId="slideDeck",e.ScreenCaptureClass="screen-capture",e.ObjectVideoTabClass="object-video",e.UrlTabClass="url",e.YouTubeIconClass="youtube",e.SlideDeckTabClass="slide-deck",e.PrimaryTabHeaderClass="primary-header",e.SecondaryTabHeaderClass="secondary-header",e.RecentBroadcastThreshold=144e5,e.UrlEventDuration=.5,e.PlayKeyCode=32,e.RewindKeyCode=37,e.ForwardKeyCode=39,e.VolumeUpKeyCode=38,e.VolumeDownKeyCode=40,e.MuteKeyCode=77,e.VolumeIncrement=10,e.PositionIncrement=5,e.MinVolume=0,e.MaxVolume=100,e.InitialVolume=100,e.SilverlightVersion="4.0.50401.0",e.PlaySpeedSilverlightVersion="5.0",e.QuickRewindSeconds=10,e.QuickForwardSeconds=30,e.FullScreenControlInterval=3,e.EditJumpSeconds=5,e.DisplayTimeMillisecondPrecision=2,e.DisplayTimePrecisionMultiplier=Math.pow(10,e.DisplayTimeMillisecondPrecision),e.UrlEventClosenessTolerance=.1,e.BoundaryCutTolerance=.1,e.LeftPaneRatio=.35,e.LeftPaneMinWidth=460,e.RightPaneMinWidth=480,e.HeaderBuffer=50,e.MaxTitleCharacters=60,e.EventRegionMinHeight=300,e.PlayerMinHeight=50,e.LiveNotesClass="live-notes",e.MaxInlineSecondaryTabs=3,e.CollapseSecondaryTabsWidth=1200,e.SliderDragThreshold=2,e.InputMargin=14,e.InputOptionsMargin=4,e.ScrollBarWidth=20,e.AudioOnlyMinimumWidth=2,e.ThumbnailScrollTimeout=5e3,e.EventScrollTimeout=5e3,e.FlyoutTimeout=2e3,e.BaseUrl="{0}://{1}{2}".format(Panopto.uriScheme,Panopto.webServerFQDN,Panopto.appRoot),e.SessionListUrl="{0}/Pages/Sessions/List.aspx".format(e.BaseUrl),e.SilverlightEditorUrlTemplate=e.BaseUrl+"/Pages/Editor/Default.aspx#{0}",e.SlideImageUrl="{0}/Pages/Viewer/Image.aspx".format(e.BaseUrl),e.ThumbUrl="{0}/Pages/Viewer/Thumb.aspx".format(e.BaseUrl),e.DummyPDFUrl="{0}/Scripts/PluginDetect/empty.pdf".format(e.BaseUrl),e.FlashPlayerUrl="http://get.adobe.com/flashplayer",e.SinglePageAppUrl="{0}://{1}{2}".format(Panopto.uriScheme,Panopto.webServerFQDN,Panopto.relativeSinglePageAppUrl),e.QuizEditUrlTemplate=e.SinglePageAppUrl+"quiz-configure/{0}",e.KollectiveEdgeUrl="about:flags",e.YouTubeEditUrlTemplate=e.SinglePageAppUrl+"youtubeEmbed/configure/{0}",e.YouTubeEmbedBaseUrl="www.youtube.com/embed/",e.JoinChannelOptionValue="joinChannel",e.SearchExpandDuration=400,e.FadeInterval=150,e.PlaySpeedResourceString="ViewerPlus_Speeds_{0}",e.BitrateResourceString="ViewerPlus_Bitrates_{0}",e.SearchTypeResourceString="ViewerPlus_Search_{0}",e.BitrateCookie="defaultBitrate",e.MBRBitrateCookie="defaultBitrateMBR",e.VolumeCookie="defaultVolume",e.CaptionsCookie="defaultCaptions",e.CaptionPlacementCookie="defaultCaptionPlacement",e.CaptionSizeCookie="defaultCaptionSize",e.CaptionColorCookie="defaultCaptionColor",e.BitrateLevels=[Panopto.GlobalResources[e.BitrateResourceString.format("Low")],Panopto.GlobalResources[e.BitrateResourceString.format("Medium")],Panopto.GlobalResources[e.BitrateResourceString.format("Medium")],Panopto.GlobalResources[e.BitrateResourceString.format("High")]],e.MaxScormSegments=100,e.ScormCompleteThreshold=.9,e.ScormOffsetMultiplier=5,e.ScormTimeKey="cmi.core.session_time",e.PluginDetectPDFReader="PDFReader",e.SortRelevanceValue="relevance",e.SortTimeValue="time",e.SearchSortOrders=[{value:e.SortRelevanceValue,name:Panopto.GlobalResources.ViewerPlus_SortByRelevance},{value:e.SortTimeValue,name:Panopto.GlobalResources.ViewerPlus_SortByTime}],e.MP4MimeType="video/mp4",e.HLSMimeType="application/x-mpegURL",e.Hive="Hive",e.Kollective="Kollective",e.ShowKollectiveEdgeMessageParam="ShowKollectiveEdgeMessage",e.KollectiveLongPollUrlBase="/api/v1/longpoll?ts={0}&ktoken=",e.LTIPage="/Panopto/LTI/LTI.aspx",e.OutcomeFormat="resultScore={0}&lis_result_sourcedid={1}&oauth_consumer_key={2}&lti_message_type=panopto_outcome_pox_response&lti_version=LTI-1p0",e}(Panopto.Viewer.Constants||{}),Panopto.Core.ViewerPlayState=Panopto.Core.ViewerPlayState||{},Panopto.Viewer.PlayState=function(e){return e.Playing=Panopto.Core.ViewerPlayState.Playing,e.Paused=Panopto.Core.ViewerPlayState.Paused,e.Stopped=Panopto.Core.ViewerPlayState.Stopped,e.Buffering=Panopto.Core.ViewerPlayState.Buffering,e}(Panopto.Viewer.PlayState||{}),Panopto.Viewer.ViewMode=function(e){return e.Primary=1,e.Secondary=2,e.LiveNotes=3,e}(Panopto.Viewer.ViewMode||{}),Panopto.Viewer.PlaySpeed=function(e){return e.Slowest=.5,e.Slow=.75,e.Normal=1,e.Fast=1.25,e.Faster=1.5,e.FasterYet=1.75,e.Fastest=2,e}(Panopto.Viewer.PlaySpeed||{}),Panopto.Viewer.MBRBitrate=function(e){return e.High=2,e.Medium=1,e.Auto=0,e}(Panopto.Viewer.MBRBitrate||{});var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.ViewMode=Panopto.Viewer.ViewMode||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Layout=function(e,t,o,n,i,a,r,s){var l,u=Panopto.Viewer.ViewMode,d=Panopto.Viewer.Constants,c=$("#viewer"),p=$("#viewerContent"),f=$("#leftPane"),P=$("#primaryPlayer"),m=$("#searchRegion"),v=$("#eventTabs"),h=$("#eventTabControl"),g=$("#eventTabPanes"),y=$("#hideEventsButton"),w=$("#rightPane"),C=$("#secondaryPlayer"),b=$("#playControls"),T=$("#thumbnailList"),S=$("#timelineContainer"),V=$("#inlineMessageLetterbox"),E=$("#inlineMessage"),I=$("#fullscreenControls"),R=$("#dockedCaption"),k=$("#dockedCaptionText"),L=$("#overlayCaption"),D=$("#playlistOverlay"),x="",U=!1,M=!($.browser.msie&&parseFloat($.browser.version)<10||r||s),B=!1,A=h.outerWidth(),H=function(e,t,n){e=n?d.LeftPaneMinWidth-A:e,g.width(e),_.each(o,function(o){o.resize(e-1,t)})},O=d.LeftPaneMinWidth,F="collapsed",G=function(t,n){t?(n?(f.width(O).css("max-width",O),B=!1):f.animate({width:O,"max-width":O},{step:function(){e.resize()},complete:function(){B=!1}}),y.show(),m.removeClass(F)):(_.each(o,function(e){e.selected(!1)}),y.hide(),m.addClass(F),B=!0,n?f.width(A).css("max-width",A+"px"):f.animate({width:A,"max-width":A},{step:function(){e.resize()}}))},z=function(e,t){var o=V.is(":visible");V.width(e).height(t).show(),E.css("margin-top",(t-E.height())/2),o||V.hide()};$("#wrapper").css("min-width","0px"),$("body").css("overflow","hidden"),$("#logoutWarningMessage").addClass("bottom"),$.browser.msie&&8===parseFloat($.browser.version)&&(b.find("#transportControls").css("table-layout","fixed"),b.find("#positionControl").css("width","100%")),$(window).resize(function(){e.resize()});var N="clicked";$(document).on("mousedown","a",function(){$(this).addClass(N)}).on("blur","a",function(){$(this).removeClass(N)}),M&&Panopto.Core.UI.Handlers.button(y.find("span"),function(){G(!1)}),e.resize=function(){var o,r,h,g,y,w,V=S.is(":visible")&&S.hasClass(Panopto.Core.Constants.ExpandedClass),E=$(window).height()-a.height()-(V?S.outerHeight():0),I=$(window).width(),k=f.outerWidth()-f.width(),L=m.is(":visible")?m.outerHeight(!0):0,x=(S.is(":visible")&&!V?S.outerHeight():0)+(R.is(":visible")?R.outerHeight():0)+(T.is(":visible")?T.outerHeight():0),U=Math.max(E-b.outerHeight()-x,d.PlayerMinHeight);switch(p.height(E),S.css("top",V?$(window).height()-S.outerHeight()+"px":""),l){case u.Primary:r=d.LeftPaneMinWidth,o=B?f.width():r,g=Math.max(I-o-k,d.RightPaneMinWidth),f.width(o),y=Math.max(E,d.EventRegionMinHeight)-L,v.height(y),H(o-A,y,B),D.width(r),t.resize(g,U),z(g,U),R.is(":visible")?(R.css("margin-top",P.outerHeight()+"px"),b.css("margin-top","")):(R.css("margin-top",""),b.css("margin-top",P.outerHeight()+"px")),c.css("min-width",o+k+d.RightPaneMinWidth),s&&s.resize(V?o+k+g:g),T.width(g),e.toggleInlineSecondaries(),e.resizeCaption();break;case u.Secondary:r=i.isPrimaryAudioOnly||s?d.LeftPaneMinWidth:Math.max(I*d.LeftPaneRatio,d.LeftPaneMinWidth),o=B?f.width():r,g=Math.max(I-o-k,d.RightPaneMinWidth),f.width(o),h=o*t.height()/t.width(),h=isNaN(h)?0:h,E-h>=d.EventRegionMinHeight?(t.resize(o,h),y=E-h-L):(t.resize(o,Math.max(E-d.EventRegionMinHeight,d.PlayerMinHeight)),y=d.EventRegionMinHeight-L),v.height(y),H(o-A,y,B),D.width(r),w=_.find(n,function(e){return e.selected()}),w?w.resize(g,U):(C.width(g),C.height(U)),z(g,U),s&&s.resize(V?o+k+g:g),T.width(g),e.toggleInlineSecondaries(),e.resizeCaption();break;case u.LiveNotes:o=d.LeftPaneMinWidth,f.width(o),H(o-A,E),D.width(0)}},e.viewMode=function(t){if("undefined"==typeof t)return l;if(t!==l){switch(l||!M||i.contents.length||(t===u.Primary||i.isPrimaryAudioOnly)&&G(!1,!0),t){case u.Primary:C.css("max-height",0),P.addClass("primary-only"),M&&(y.css("visibility","visible"),l&&G(!0,!0));break;case u.Secondary:C.css("max-height",""),i.isPrimaryAudioOnly||(B&&(G(!0,!0),e.selectFirstEventTab()),f.css("max-width",""),y.css("visibility","hidden")),P.removeClass("primary-only"),P.css("height",""),P.css("width",""),R.add(b).css("margin-top",""),c.css("min-width","");break;case u.LiveNotes:a.toggleLiveNotes(!0),P.hide(),b.hide(),h.hide(),w.hide()}l=t,e.resize()}},e.toggleInlineSecondaries=function(){var e=$(window).width()<d.CollapseSecondaryTabsWidth,t=$("#transportControls ."+d.SecondaryTabHeaderClass),o=$("#selectedSecondary"),i=_.filter(n,function(e){return!e.hiddenTab()});e?(o.toggle(i.length>1),t.css("display","none")):(o.toggle(i.length>d.MaxInlineSecondaryTabs),t.css("display",i.length>1&&i.length<=d.MaxInlineSecondaryTabs?"":"none"))},e.expandLeftPane=function(){M&&B&&G(!0)},e.expandTimeline=function(t){S.toggleClass(Panopto.Core.Constants.ExpandedClass,t),e.resize()},e.resizeCaption=function(o,n){var i=e.fullscreenPlayer(),a=i?i===t?P:C:l===u.Primary?P:C,r=a.find(".screen:visible"),s=0;i?(a=a.find("video"),s=I.outerHeight(!0)+10):r.length&&r.width()&&(a=r),"string"==typeof o&&(x=Panopto.Core.TextHelpers.displayLineBreaks(Panopto.Core.TextHelpers.cleanTextWithoutHighlighting(o))),"undefined"!=typeof n&&(U=n),i||!U?(L.html(x),L.toggle(!!x).css({"max-width":a.width(),top:0,left:0}),a.offset()&&L.css({left:a.offset().left+(a.width()-L.outerWidth())/2,top:a.offset().top+a.height()-L.outerHeight()-s})):(k.html(x),L.hide())}};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.API=Panopto.API||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.ViewMode=Panopto.Viewer.ViewMode||{},Panopto.Viewer.PlayState=Panopto.Viewer.PlayState||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Kollective=Panopto.Viewer.Kollective||{},Panopto.Viewer.Viewer=function(t,o,n,i,a,r,s,l,u){var d,c,p,f,P,m,v,h,g,y,w,C,b,T,S,V,E,I,R,k,L,D,x,U,M,B=Panopto.Core.ErrorCode,A=[],H=[],O=Panopto.Viewer.PlayState.Paused,F=0,G=0,z=0,N=!1,j=!0,Q=!1,K=!1,q=Panopto.Core.StringHelpers.parseQueryString(window.location.search.slice(1)),W=!1,J=Panopto.Viewer.Kollective,Y=!1,X="true"===q.ShowKollectiveEdgeMessage,Z="true"===q.startMuted,ee=q.outcome_did,te={},oe=function(e){$(".plugin-screen").css({"max-height":e?"":0,border:e?"":0,overflow:e?"":"hidden"})},ne=function(){var e=Panopto.Core.StringHelpers.parseQueryString(window.location.hash);return e.modalPage},ie=function(){return _.find(A,function(e){return e!==w})},ae=function(){var e;y?_.each(y.tabs(),function(e){A.push(e)}):(b.isBroadcast||(w=a.SearchTab($("#searchTabHeader"),$("#searchTabPane"),t,b.id,b.user,q.tid),A.push(w)),(b.contents.length||b.description)&&A.push(a.ContentsTab($("#contentsTabHeader"),$("#contentsTabPane"),t,b.id,b.contents,b.description)),b.hasCaptions&&A.push(a.TranscriptTab($("#transcriptTabHeader"),$("#transcriptTabPane"),t,b,q.tid)),b.user.key&&A.push(a.NotesTab($("#notesTabHeader"),$("#notesTabPane"),t,b.id,b.user,b.channels,b.allowPublicNotes)),b.user.key&&A.push(a.BookmarksTab($("#bookmarksTabHeader"),$("#bookmarksTabPane"),t,b.id,b.user)),Panopto.features.areSocialFeaturesEnabled&&b.discussionEnabled&&(C=a.CommentsTab($("#commentsTabHeader"),$("#commentsTabPane"),t,b.id,b.user,b.isBroadcast,b.discussionCacheSeconds),A.push(C))),e=ie(),e&&e.selected(!0)},re=function(){var e=function(e){var t=n.DocumentPlayer(R,e);H.push(a.SecondaryTab(t,e,e.iconCode))};v||(v=y?n.PrimarySegmentPlayer($("#primaryPlayer"),$("#primaryScreen"),b.playerInterface,t,y):n.PrimaryPlayer($("#primaryPlayer"),$("#primaryScreen"),b.playerInterface),t.reloadPrimaryContent(!0)),_.each(H,function(e){e.remove()}),H.length=0,_.each(b.documents,function(t){t.isPdf&&e(t)}),_.each(b.slideDecks,function(e){var o=n.SlidePlayer(R,e,t);H.push(a.SecondaryTab(o,e,Panopto.Core.Constants.SlideIconCode))}),!h&&b.secondaryStreams.length&&(h=n.SecondaryStreamPlayer(R,b.playerInterface)),_.each(b.secondaryStreams,function(e){H.push(a.SecondaryTab(h,e,t.getStreamIconCode(e)))}),_.each(b.documents,function(t){t.isPdf||e(t)}),H.sort(function(e,t){return e.timeline()[0]-t.timeline()[0]}),_.each(H,function(e){e.render()}),g||y||(g=n.ThumbnailPlayer(b.thumbnails,t)),ee&&_.each(b.documents,function(e){e.isQuiz&&(te[e.id]=null)})},se=function(e){var t=_.find(A,function(e){return e.selected()});t&&t.position(e),C&&b.isBroadcast&&j&&C.toggleBroadcastIsLive(v.isLive())},le=function(e){var o,n,i=t.fullscreenPlayer();b.captions&&p.captionsSelected()&&(o=b.captions[_.findLastIndex(b.captions,function(t){return t.time<e})]),n=o?o.text:"",i?i.setCaptionText(n):p.captionsDocked()?(v.setCaptionText(""),h&&h.setCaptionText("")):t.viewMode()===l.Secondary?(v.setCaptionText(""),h&&h.setCaptionText(n)):v.setCaptionText(n),t.resizeCaption(n,p.captionsDocked())},ue=function(){var e=b.isBroadcast&&!j,o=function(){Panopto.viewer.data.playlist?c.queueNextItem():!b.nextDelivery&&!e||y?t.position(0):(e?(Q=!0,L.text(E)):(t.position(0),b.nextDelivery.folderName=b.folder.name,Panopto.Core.UI.Components.nextDelivery(L,b.nextDelivery,Panopto.GlobalResources.NextDelivery_NextVideo,Panopto.GlobalResources.NextDelivery_PlayAgain,function(){t.playState(u.Playing)},Panopto.GlobalResources.NextDelivery_RecordingNow)),oe(!1),k.show(),t.resize())};t.playState(u.Paused,!0,!0),b.requiresSilverlight?setTimeout(o,100):o()},de=function(e,o){G=o="number"==typeof o?o:Math.max(F,t.position());var n,i,a,s,l,d=Date.now(),c=v.streamLength(),m=y?y.timelinePosition(o):o;m!==o?t.position(m):(c>0&&U!==c&&(U=c,_.each(H,function(e){e.adjustTimeline(U)})),o=Math.clamp(o,0,U),n=Math.round(o),i=Math.max(0,Math.round(U-o)),f.synchronize(o,z,e)&&(se(o),g&&g.position(o),(e||!M||d-M>r.ControlSyncRate)&&(M=d,a=Panopto.Core.TimeHelpers.formatDuration(n,Panopto.GlobalResources.TimeSeparator),s=(i?"-":"")+Panopto.Core.TimeHelpers.formatDuration(i,Panopto.GlobalResources.TimeSeparator),l=Panopto.Core.TimeHelpers.formatDuration(Math.round(U),Panopto.GlobalResources.TimeSeparator),p.synchronize(o,U,a,s,l)),y&&y.synchronize(o,O===u.Playing),v.syncTimes(a,l),h&&h.syncTimes(a,l),b.multiBitrateEnabled&&p.synchronizeBitrate(),P&&P.updateProgress(o),v.ended(o)&&ue(),p.synchronizeCaption(),le(o))),z=G},ce=function(){function e(e){var o=pe(e);t.selectEventTab(o)}var o=$(".event-tab-header");Panopto.Core.UI.Handlers.button(o,e),o.focus(function(){e(this)})},pe=function(e){return _.find(A,function(t){return t.headerId()===e.id})},fe=function(){var e=$("#eventTabControl"),o=$("#eventTabPanes");e.keydown(function(o){if(!o.ctrlKey){var n,i=e.find(".event-tab-header:visible");switch(o.keyCode){case Panopto.Core.Key.UpArrow:case Panopto.Core.Key.DownArrow:case Panopto.Core.Key.LeftArrow:case Panopto.Core.Key.RightArrow:var a=_.contains([Panopto.Core.Key.DownArrow,Panopto.Core.Key.RightArrow],o.keyCode),r=i.filter("."+Panopto.Core.Constants.SelectedClass),s=i.index(r)+(a?1:-1);n=i.eq(s%i.length);break;case Panopto.Core.Key.Home:case Panopto.Core.Key.End:n=o.keyCode===Panopto.Core.Key.End?i.last():i.first();break;default:return}var l=pe(n[0]);t.selectEventTab(l),n.focus(),o.stopPropagation()}}),o.keydown(function(t){t.ctrlKey&&t.keyCode===Panopto.Core.Key.UpArrow&&(e.find(".event-tab-header."+Panopto.Core.Constants.SelectedClass).focus(),t.stopPropagation())})},Pe=function(e){var o=parseInt(q.start,10);I.show(),ae(),re(),Panopto.Viewer.Layout(t,v,A,H,b,d,!1,y),U=b.isBroadcast?0:b.duration,p=Panopto.Viewer.PlayControls(t,b,v,H),f=Panopto.Viewer.SecondaryTabControl(t,v,H,p),ce(),f.attachTabHandlers(),fe(),Panopto.Viewer.BroadcastTimer(t,b,q,Y),q.isScorm&&(P=Panopto.Viewer.ScormControl(t,b.duration)),t.playState(e?u.Playing:u.Paused),isNaN(o)||P?P||de(!0):t.position(o),(Panopto.Core.Browser.isIE||Panopto.Core.Browser.isIE11)&&$(document).on("contextmenu",function(){t.playState(u.Paused)}),t.toggleScreens(!ne()),Z&&t.toggleMuted(),N=!0},me=function(e){if(K=!0,e&&e.ErrorCode)switch(e.ErrorCode){case B.SiteDisabled:t.toggleMessage(Panopto.GlobalResources.ViewerPlus_SiteDisabled);break;case B.LoginRequired:s.sendEvent({action:s.Actions.Prereq,label:s.Labels.Login}),window.location.href=Panopto.viewer.unauthorizedViewerTransferUrl;break;case B.AccessRequired:s.sendEvent({action:s.Actions.Prereq,label:s.Labels.Access}),window.location.href=e.RedirectUrl;break;case B.InvalidUrl:t.toggleMessage(Panopto.GlobalResources.ViewerPlus_InvalidUrl,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,r.SessionListUrl);break;case B.InvalidDelivery:t.toggleMessage(Panopto.GlobalResources.ViewerPlus_InvalidDelivery,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,r.SessionListUrl);break;case B.NotInAvailabilityWindow:t.toggleMessage(Panopto.GlobalResources.ViewerPlus_NotInAvailabilityWindow,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,r.SessionListUrl);break;case B.InvalidFormatForSSL:t.toggleMessage(Panopto.GlobalResources.ViewerPlus_InvalidFormatForSSL,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,r.SessionListUrl);break;case B.UnknownError:default:t.toggleMessage(Panopto.GlobalResources.ViewerPlus_UnknownError,Panopto.GlobalResources.ViewerPlus_ContactSupport,$(".support-email").attr("href"))}else Panopto.uriScheme!==window.location.protocol.replace(":","")&&Panopto.Core.Browser.isIE?t.toggleMessage(Panopto.GlobalResources.ViewerPlus_IESSLWarning,Panopto.GlobalResources.ViewerPlus_IESSLLink,Panopto.viewer.secureBrowserHelpUrl):t.toggleMessage(Panopto.GlobalResources.ViewerPlus_UnknownError,Panopto.GlobalResources.ViewerPlus_ContactSupport,$(".support-email").attr("href"))},ve=function(e,n){K=!1;var s,u=Panopto.Core.Browser.flashEnabled()&&!Panopto.viewer.htmlPlaybackOnly,p=e.flowPlayerEnabled||!b.isBroadcast&&Panopto.Core.Browser.supportsVideo(r.MP4MimeType);b=e,q.isScorm&&(b.nextDelivery=null),q.notes?b.user.key?(d=Panopto.Viewer.Header(t,b),A.push(a.NotesTab($("#notesTabHeader"),$("#notesTabPane"),t,b.id,b.user,b.channels,b.allowPublicNotes,!0)),A[0].selected(!0),Panopto.Viewer.Layout(t,v,A,H,b,d,!0),t.viewMode(l.LiveNotes),I.show(),Panopto.authCookieTimeoutMinutes&&setInterval(o.Delivery.refreshAuthCookie,60*Panopto.authCookieTimeoutMinutes*1e3/2)):window.location.href="{0}?ReturnUrl={1}".format(Panopto.loginUrl,encodeURIComponent(window.location.href)):b.isViewable?(t.toggleMessage(!1),d=Panopto.Viewer.Header(t,b,y,Panopto.viewer.data.playlist),c=d.playlistOverlay(),b.requiresSilverlight?(s=Silverlight.isInstalled(r.SilverlightVersion),!s||"wmv"===b.activePrimary.fileType&&Panopto.Core.Browser.isSafari?(s?t.toggleMessage(Panopto.GlobalResources.ViewerPlus_Webkit_WMV_Warning):Panopto.Core.Browser.isSilverlightSupported?$("#silverlightMessage").show():t.toggleMessage(Panopto.GlobalResources.Silverlight_DisabledChromeViewer,Panopto.GlobalResources.Silverlight_DisabledLink,"http://support.panopto.com/ChromeSilverlight"),(p||u)&&b.podcastCompleted&&($("#embedControl").show(),$("#embedControl").html(b.embedUrl))):Pe(n)):p||u?Pe(n):Panopto.viewer.htmlPlaybackOnly?t.toggleMessage(Panopto.GlobalResources.ViewerPlus_NoInternetExplorer):t.toggleMessage(Panopto.GlobalResources.ViewerPlus_InstallOrEnable,Panopto.GlobalResources.ViewerPlus_AdobeFlashPlayer,r.FlashPlayerUrl,"adobe-download")):(d=Panopto.Viewer.Header(t,b,y,Panopto.viewer.data.playlist),b.isBroadcast?b.activePrimary||t.toggleMessage(Panopto.GlobalResources.ViewerPlus_BroadcastNotStarted,Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,r.SessionListUrl):he(),setTimeout(function(){o.Delivery.getDelivery(b.id,q.tid,b.invocationId,{refreshAuthCookie:!0,isKollectiveAgentInstalled:Y},function(e){ve(i.Delivery(e),n)},me)},b.isBroadcast?b.broadcastRefreshInterval:r.DeliveryRefreshInterval))},he=function(){var e,o;b.folder.id?(e=Panopto.GlobalResources.ViewerPlus_SessionNotReady_WatchSomethingElse.format(b.folder.name),o=Panopto.Application.getBookmarkURL(r.SessionListUrl,{folderID:b.folder.id})):(e=Panopto.GlobalResources.ViewerPlus_WatchSomethingElse,o=r.SessionListUrl),t.toggleMessage(Panopto.GlobalResources.ViewerPlus_SessionNotReady+"<br>"+Panopto.GlobalResources.ViewerPlus_SessionNotReadyRefresh,e,o)},ge=function(e,n,a,s,l){l||(q.autoplay="false"),o.Delivery.getDelivery(e,n,"",{isLiveNotes:s,refreshAuthCookie:!0,isEditing:a,isKollectiveAgentInstalled:Y},function(e){var o,n=function(){D.hide(),ve(b,l)};b=i.Delivery(e),a?b.user.role<=Panopto.Data.AclRoleType.Viewer?window.location.href=Panopto.viewer.unauthorizedEditorTransferUrl:!Panopto.viewer.editingEnabled||Panopto.Core.Browser.isIE8?window.location.href=r.SilverlightEditorUrlTemplate.format(b.id):!b.requiresAdvancedEditor&&b.isReadyForEditing?(l=!1,q.autoplay="false",b.isViewable=b.isReadyForEditing,b.isRecentBroadcast=!1,b.multiBitrateEnabled=!1,y=Panopto.Viewer.Controls.Timeline.TimelineEditor(t,b,n)):(D.hide(),d=Panopto.Viewer.Header(t,b),o=b.requiresAdvancedEditor?Panopto.GlobalResources.ViewerPlus_Edit_AdvancedEditorRequired:Panopto.GlobalResources.ViewerPlus_Edit_SessionNotReady,t.toggleMessage(o.format("<a href='{0}'>{1}</a>".format(r.SilverlightEditorUrlTemplate.format(b.id),Panopto.GlobalResources.ViewerPlus_Edit_AdvancedEditorLink)),Panopto.GlobalResources.ViewerPlus_Edit_MoreInformation,Panopto.viewer.editorSupportUrl)):n()},function(e){D.hide(),me(e)})};return $(document).ready(function(){var e="true"===q.edit,o=Panopto.features.autoPlayEnabled&&!!q.id&&"false"!==q.autoplay,n=q.id;!n&&Panopto.viewer.data.playlist&&(n=Panopto.viewer.data.playlist.initialDeliveryId),I=$("#viewerContent"),R=$("#secondaryPlayer"),k=$("#inlineMessageLetterbox"),L=$("#inlineMessage"),D=$("#loadingMessage"),D.show(),m=Panopto.Viewer.ClientLogger(),Panopto.viewer.isKollectiveEnabled?X?t.toggleMessage(Panopto.Core.TextHelpers.displayLineBreaks(Panopto.GlobalResources.ViewerPlus_Kollective_EdgeWarning),Panopto.GlobalResources.ViewerPlus_Kollective_EdgeSupportLinkText,r.KollectiveEdgeUrl):J.detectAgent(function(t){Y=t,ge(q.id||n,q.tid,e,!!q.notes,o)}):ge(q.id||n,q.tid,e,!!q.notes,o)}),t.isDeliveryError=function(){return K},t.position=function(e){return"undefined"==typeof e?v?v.position():0:void(t.isDVRDisabled()||(b.isBroadcast&&v.isLive(!1),v.position(e),F=e,de(!0,e),k.hide(),oe(!0),Q=!1))},t.playState=function(e,o,n){var i;return"undefined"==typeof e?O:void(t.isDVRDisabled()&&e!=u.Playing||(p.togglePlayState(e===u.Paused),e!==O&&(b.isBroadcast&&e===u.Paused&&!o&&v.isLive(!1),e===u.Playing&&Q&&t.position(0),v.playState(e,!n),x&&b.isBroadcast||(e===u.Paused?clearInterval(x):x=setInterval(function(){de(!1)},r.TimedSyncRate)),O=e,i=_.find(H,function(e){return e.selected()}),i&&(f.clearSyncTimeout(),i.playState(O)),v.syncPlayState(O),h&&h.syncPlayState(O),k.hide(),oe(!0),y&&y.synchronize(t.position(),O===u.Playing))))},t.reloadPrimaryContent=function(e){v.content(b.primaryStreams,b.activePrimary,e,function(){t.synchronize(!0)})},t.setPrimarySegments=function(e,t,o,n){y&&v&&v.setSegments(e,t,o,n)},t.activePrimary=function(){return v.activePrimary()},t.activeSecondary=function(){var e=f.selectedTab();return e&&e.content()},t.selectSecondaryTab=function(e,t){f.selectTabById(e,t)},t.getSelectedEventTab=function(){return _.find(A,function(e){return e.selected()})},t.selectEventTab=function(e){var o=t.getSelectedEventTab();e!==o&&(o?o.selected(!1):t.expandLeftPane(),e.selected(!0),se(t.position()))},t.selectFirstEventTab=function(){var e=ie();e&&t.selectEventTab(e)},t.toggleMessage=function(e,o,n,i){var a=$("#viewerMessage"),r=a.find("#messageLink");e?(T=t.position(),N&&!V&&(V=t.playState(),t.playState(u.Paused)),t.isFullscreen(!1),I.hide(),D.hide(),a.find("#messageText").html(e),o?r.text(o).attr("href",n).show():r.hide(),a.find("#messageIcon").removeClass().addClass(i).attr("href",n),a.show()):a.is(":visible")&&(a.hide(),N&&(I.show(),t.reloadPrimaryContent(!0),h&&h.content(h.content(),!0),t.playState(V),v.playState(V),b.isBroadcast||t.position(T),V=void 0))},t.toggleScreens=function(e){t.viewMode&&t.viewMode()!==l.LiveNotes&&!k.is(":visible")&&(e&&S?(oe(!0),t.resize(),t.playState(S),S=void 0):e||S||(S=O,t.playState(u.Paused),oe(!1))),W||(Panopto.ModalPopup.defaultInstance.hide(function(){t.toggleScreens(!0)}),W=!0)},t.fullscreenPlayer=function(){return _.find([v,h],function(e){return e&&e.isFullscreen()})},t.isFullscreen=function(e,o){return"undefined"==typeof e?!!t.fullscreenPlayer():void(e?(v&&v.isFullscreen(o),h&&h.isFullscreen(!o)):(v&&v.isFullscreen(!1),h&&h.isFullscreen(!1)))},t.ensureSecondaryIsMinimized=function(){h&&h.minimizeIfHidden()},t.setCaptionStyles=function(e){v.setCaptionStyles(e),h&&h.setCaptionStyles(e)},t.synchronize=de,t.refreshPlayers=function(){re(),f.attachTabHandlers()},t.updateDelivery=function(e){b=e,I.is(":visible")&&t.reloadPrimaryContent(!1),b.secondaryStreams.length&&!h&&(h=n.SecondaryStreamPlayer(R,b.playerInterface)),_.each(b.secondaryStreams,function(e){var o=_.find(H,function(t){return t.id()===e.id}),n=1e3*Math.min(0,e.timeline[0]-v.streamLength());o?o.content(e):n<b.broadcastRefreshInterval&&setTimeout(function(){var o=a.SecondaryTab(h,e,t.getStreamIconCode(e));H.push(o),o.render(),f.attachTabHandlers(),t.toggleInlineSecondaries(),t.synchronize(!0)},n)}),t.toggleMessage(!1)},t.endBroadcast=function(){var e;j&&(j=!1,E=b.broadcastInterrupted?Panopto.GlobalResources.ViewerPlus_BroadcastInterrupted:Panopto.GlobalResources.ViewerPlus_BroadcastEnded_Notification,e=b.activePrimary.relativeEnd-r.BroadcastEndThreshold,v.updateMaxPosition(e),t.position()>e&&t.position(e),C&&C.toggleBroadcastIsLive(!0))},t.restartBroadcast=function(){j||(j=!0,Q=!1,v.updateMaxPosition(),v.isLive()&&(k.hide(),v.isLive(!1),t.playState(u.Playing),v.isLive(!0,function(){t.synchronize(!0)})),C&&C.toggleBroadcastIsLive(v.isLive()))},t.isActiveBroadcast=function(){return b.isBroadcast&&j},t.getStreamIconCode=function(e){var t;switch(e.type){case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio:t=Panopto.Core.Constants.AudioIconCode;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen:t=Panopto.Core.Constants.ScreenIconCode;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera:default:t=Panopto.Core.Constants.ObjectVideoIconCode}return t},t.logDesync=function(e){s.sendDesyncEvent({diff:e,deliveryId:b.id,invocationId:b.invocationId})},t.writeLineToClientLog=function(e,t){m.writeLine(e,G,t)},t.submitClientLog=function(e,t){m.submit(b.serverModel,e,t)},t.togglePlaying=function(e){if(!ne())switch(s.sendEvent({action:O===u.Playing?s.Actions.Pause:s.Actions.Play,label:e||s.Labels.Fullscreen}),O){case u.Playing:t.playState(u.Paused);break;default:t.playState(u.Playing)}},t.rewind=function(e,o){s.sendEvent({action:s.Actions.Rewind,label:e||s.Labels.Fullscreen}),o=o||r.QuickRewindSeconds,t.position(Math.max(0,t.position()-o))},t.skipToStart=function(e){s.sendEvent({action:s.Actions.SkipToStart,label:e||s.Labels.Fullscreen}),t.position(0)},t.forward=function(e,o){s.sendEvent({action:s.Actions.Forward,label:e||s.Labels.Fullscreen}),o=o||r.QuickForwardSeconds,b.isBroadcast&&v.isLive()||t.position(Math.min(U,t.position()+o))},t.skipToEnd=function(e){s.sendEvent({action:s.Actions.SkipToEnd,label:e||s.Labels.Fullscreen}),t.position(U)},t.volumeUp=function(e,t){e=e||s.Labels.Fullscreen,t=t||r.VolumeIncrement,p.updateVolume(v.volume()+t,!0,e)},t.volumeDown=function(e,t){e=e||s.Labels.Fullscreen,t=t||r.VolumeIncrement,p.updateVolume(v.volume()-t,!0,e)},t.toggleMuted=function(e){s.sendEvent({action:v.muted()?s.Actions.Unmute:s.Actions.Mute,label:e||s.Labels.Fullscreen}),p.toggleMuted()},t.hotkey=function(e){switch(e){case r.PlayKeyCode:t.togglePlaying(s.Labels.Hotkey);break;case r.RewindKeyCode:t.rewind(s.Labels.Hotkey,r.PositionIncrement);break;case r.ForwardKeyCode:
t.forward(s.Labels.Hotkey,r.PositionIncrement);break;case r.VolumeUpKeyCode:p.showVolumeControl(),t.volumeUp(s.Labels.Hotkey);break;case r.VolumeDownKeyCode:p.showVolumeControl(),t.volumeDown(s.Labels.Hotkey);break;case r.MuteKeyCode:t.toggleMuted(s.Labels.Hotkey)}},t.getQuestionList=function(e){return y?y.getQuestionList(e):void 0},t.updateQuestionList=function(e){return y?y.updateQuestionList(e):void 0},t.markQuizCompletion=function(o,n,i){var a=_.find(b.documents,function(e){return e.id===o});if(a&&(a.isSessionPlaybackBlocking=!1),ee&&void 0!==n&&void 0!==i&&(te[o]={score:n,pointsPossible:i},quizValues=_.values(te),quizValues.indexOf(null)===-1)){var s=0,l=0;_.each(quizValues,function(e){s+=e.score,l+=e.pointsPossible}),0!==l&&$.ajax({type:"GET",url:r.LTIPage,data:r.OutcomeFormat.format(s/l,ee,q.oauth_consumer_key),error:function(t){console.log(e)}})}t.togglePlaying()},t.getEvent=function(e){return y?y.getEvent(e):void 0},t.updateEvent=function(e){return y?y.updateEvent(e):void 0},t.isDVRDisabled=function(){return b.isBroadcast&&(v.optimizationProvider()===Panopto.Viewer.Constants.Kollective||Panopto.viewer.htmlPlaybackOnly&&!Panopto.viewer.isFlowplayerV7)},t}(Panopto.Viewer.Viewer||{},Panopto.API,Panopto.Viewer.Players,Panopto.Viewer.Data,Panopto.Viewer.Tabs,Panopto.Viewer.Constants,Panopto.Viewer.Analytics,Panopto.Viewer.ViewMode,Panopto.Viewer.PlayState);var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.BroadcastTimer=function(e,t,o,n){var i=Panopto.API,a=Panopto.Viewer.Constants,r=Panopto.Viewer.Data,s=(Panopto.Viewer.Tabs,t.broadcastRefreshInterval),l=function(o){t=o,e.updateDelivery(t),t.activePrimary?t.broadcastEnded?(e.endBroadcast(),t.broadcastInterrupted||(s+=a.BroadcastEndedIncrement)):(e.restartBroadcast(),s=t.broadcastRefreshInterval):window.location.reload(),u(s)},u=function(e){setTimeout(function(){i.Delivery.getDelivery(t.id,o.tid,t.invocationId,{isActiveBroadcast:!0,isKollectiveAgentInstalled:n},function(e){l(r.Delivery(e))},function(){u(e)})},e)},d=function(){setInterval(function(){i.Delivery.getDelivery(t.id,o.tid,t.invocationId,{isKollectiveAgentInstalled:n},function(e){var t=r.Delivery(e);t.isBroadcast&&location.reload()},function(){})},a.ReopenedBroadcastInterval)};t.isBroadcast?l(t):t.isRecentBroadcast&&d()};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.ClientLogger=function(){var e=Panopto.Core.ViewerLogEntryType,t=Panopto.Core.ServiceInterface.Objects,o=[e.StreamSync],n=[];n[e.UserInitiatedSync]="User-initiated sync of primary {0}",n[e.StreamDesync]="Desync of {0} detected, pausing to correct",n[e.StreamChange]="{0} player started playing stream {1}",n[e.PlayStateChange]="{0} player changed play state to {1}",n[e.PositionSet]="{0} player set position to {1}",n[e.PlaybackSpeedChange]="{0} player changed playback speed to {1}",n[e.QualityChange]="{0} player started playing segment at quality level {1} of {2} ({3})",n[e.FullscreenChange]="{0} player changed fullscreen to {1}",n[e.StreamSync]="Desync of {0} detected, which is within the tolerance";var i=t.ViewerClientLog({}),a=!1,r=function(e,r,s){(a||o.indexOf(e)===-1)&&(i.entries.push(t.ViewerClientLogEntry({type:e,position:r,detail:n[e].format(s),timestamp:(new Date).toWCFString()})),Panopto.Core.Logger.log("{0} {1} {2}".format(e,r,n[e].format(s)),Panopto.Core.LogMode.Playback))},s=function(e,t,o){i.deliveryParams=e,Panopto.Core.ServiceInterface.WCFRest.DataCS.submitViewerClientLog(i,t,o)},l=function(e){a=e};return{writeLine:r,submit:s,toggleVerbose:l}};var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Header=function(e,t,o,n){var i,a,r,s,l,u,d,c=Panopto.Viewer.Constants,p=Panopto.Data.AclRoleType,f=Panopto.API,P=$("#viewerHeader"),m=P.find("#logoContainer"),v=P.find("#deliveryTitle"),h=P.find("#editDeliveryTitle"),g=h.find("input"),y=P.find("#parentContext"),w=P.find("#starRating"),C=P.find("#podcastDownload"),b=P.find("#settingsButton"),T=P.find("#shareButton"),S=P.find("#editButton"),V=P.find("#viewerHelpLink"),E=P.find("#signInButton"),I=P.find("#saveMessage"),R=P.find("#undoButton"),k=P.find("#redoButton"),L=P.find("#commitButton"),D=P.find("#revertButton"),x=P.find("#closeButton"),U=[m,v,h,y,w,C,I,R,k,L,D,b,T,S,x,V,E],M=o?[{elements:[m,y,h,I,R,k,L,D,b,x,V]},{elements:[m,y,h,I,R,k,L,D,x,V]},{elements:[m,h,I,R,k,L,D,x,V]},{elements:[m,h,I,R,k,L,D,V]},{elements:[m,h,I,R,k,L,D]},{elements:[m,I,R,k,L,D]},{elements:[m,R,k,L,D]},{elements:[m]}]:[{elements:[m,y,v,w,C,b,T,S,V,E]},{elements:[m,y,v,C,b,T,S,V,E]},{elements:[m,y,v,V,E]},{elements:[m,v,V,E]},{elements:[m,v,V]},{elements:[m,V]},{elements:[m]}],B=!1,A=function(){var e=$(window).width(),t=_.find(M,function(t){return t.width<e-c.HeaderBuffer});!B&&t&&t!==r&&(_.each(U,function(e){e.hide()}),r=t,_.each(r.elements,function(e){e.show()}))},H=function(){g.width(Math.min(parseInt(g.css("max-width"),10),Panopto.Core.ElementHelpers.measureText(g,g.val()))),_.each(M,function(e){e.width=_.reduce(e.elements,function(e,t){return e+t.outerWidth(!0)},0)}),A(),$(window).resize(A)},O="{0}/Pages/Sessions/List.aspx".format(c.BaseUrl),F=(Panopto.Core.TimeHelpers.utcDateToFormattedString(t.date,"LL"),P.find("#viewerSupportDropdown")),G=F.find(".send-client-log"),z=function(e){e.width(0),e.css({visibility:"hidden"})},N=!Panopto.Core.Browser.inIframe()||Panopto.viewer.linksEnabledInIframe;if(n?s=_.template($("#parentContextTemplate").html(),{icon:"&#xE05F;",name:n.name,href:null,linkClass:"playlist-context"}):t.folder.name&&(s=_.template($("#parentContextTemplate").html(),{icon:"&#xE2C7;",name:t.folder.name,href:t.folder.id&&N?"{0}?folderID={1}".format(O,t.folder.id):null,linkClass:""})),Panopto.Branding.createLogo(m,Panopto.branding.smallLogo,N),$(document).attr("title",t.title),o?(g.attr(Panopto.Core.Constants.InitAttribute,t.title),i=Panopto.Core.UI.Components.editableLabel(g,function(e){var t=o.session();t.name=e,Panopto.Core.ServiceInterface.Rest.Sessions.update(t,function(){i.save(),$(document).attr("title",g.val()),H()},function(){i.revert(),t.name=g.val()})})):t.title.length<=c.MaxTitleCharacters?v.text(t.title):(d=Math.floor((c.MaxTitleCharacters-Panopto.GlobalResources.ViewerPlus_TitleEllipsis.length)/2),u=t.title.slice(0,d)+Panopto.GlobalResources.ViewerPlus_TitleEllipsis+t.title.slice(-d),v.text(u),v.attr("title",t.title)),t.downloadUrl?C.attr("href",t.downloadUrl):z(C),t.user.role>p.Viewer&&N?(o&&(Panopto.ModalPopup.defaultInstance.opener=o,o.updateData=function(){window.location.reload()}),Panopto.Core.UI.Handlers.button($("#settingsButton"),function(){e.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"SessionInfo",modalHeader:Panopto.Core.TextHelpers.innerText(t.title),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:t.id})})}),Panopto.Core.UI.Handlers.button($("#shareButton"),function(){e.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"SessionShare",modalHeader:Panopto.Core.TextHelpers.innerText(t.title),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:t.id})})}),t.isBroadcast||o?z(S):Panopto.Core.UI.Handlers.button($("#editButton"),function(){window.location.search+="&edit=true"})):(z(b),z(T),z(S)),s&&(y.html(s),n)){var j=y.find("#parentLink");j.addClass("active");var Q,K=Panopto.Core.StringHelpers.parseQueryString(window.location.search.slice(1)),q=!0;Q=e.isDeliveryError()?PanoptoTS.Core.UI.Components.PlaylistOverlayPlayState.None:K.id?PanoptoTS.Core.UI.Components.PlaylistOverlayPlayState.Play:PanoptoTS.Core.UI.Components.PlaylistOverlayPlayState.Delay,a=new PanoptoTS.Core.UI.Components.PlaylistOverlay($("#playlistOverlay"),j,n.id,t.id,PanoptoTS.Core.UI.Components.PlaylistOverlaySkin.Interactive,{includeViewableOnly:!0},q,Q),a.onToggle(function(e){j.toggleClass("active",e)}),a.onPlayItem(function(o){if(o===t.id)e.activePrimary()&&e.playState(Panopto.Viewer.PlayState.Playing);else{var n=Panopto.Core.StringHelpers.setQueryParameters(location.href,{id:o});location.replace(n)}})}return t.user.key&&Panopto.features.areRatingsEnabled&&!o&&(l=Panopto.Core.UI.Components.starRating(w,Panopto.GlobalResources.StarRating_OneStar,Panopto.GlobalResources.StarRating_MultipleStars,function(e){var o=l.value();l.value(e),f.Delivery.rateDelivery(t.id,e,function(){},function(){l.value(o)})}),Panopto.Branding.brandImageBackgrounds(".star",".star-accent-background .star","#"+Panopto.branding.accentColor),l.value(t.user.rating||0)),N?(Panopto.Core.UI.Components.popup(F,V,function(){e.toggleScreens(F.is(":visible")),F.toggle(),G.show(),F.css({right:$(window).width()-V.offset().left-V.outerWidth(),top:V.offset().top+V.outerHeight()})},function(){F.is(":visible")&&(F.hide(),e.toggleScreens(!0))},!0,!0),Panopto.Core.UI.Handlers.button(G,function(){e.submitClientLog(function(){alert(Panopto.GlobalResources.ViewerPlus_LogsSent)},function(){alert(Panopto.GlobalResources.ViewerPlus_LogsError)})})):(z(V),z(E)),P.show(),m.find("image").length||m.find("img").on("load",H).on("error",H),H(),{height:function(){return P.outerHeight()},playlistOverlay:function(){return a},toggleLiveNotes:function(e){B=e,P.toggleClass(c.LiveNotesClass,B),w.toggle(!B)}}};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.ViewMode=Panopto.Viewer.ViewMode||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.PlaySpeed=Panopto.Viewer.PlaySpeed||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.MBRBitrate=Panopto.Viewer.MBRBitrate||{},Panopto.Viewer.PlayState=Panopto.Viewer.PlayState||{},Panopto.Viewer.PlayControls=function(e,t,o,n){var i,a,r,s,l=Panopto.Viewer.ViewMode,u=Panopto.Viewer.Constants,d=Panopto.Viewer.PlaySpeed,c=Panopto.Viewer.Analytics,p=Panopto.Viewer.MBRBitrate,f=Panopto.Viewer.PlayState,P=.1,m=$("#skipToStartButton"),v=$("#rewindButton"),h=$("#playButton"),g=$("#forwardButton"),y=$("#skipToEndButton"),w=$("#timeElapsed"),C=$("#timeRemaining"),b=$("#positionSlider"),T=$("#elapsedBar"),S=$("#volumeSlider"),V=$("#volumeButton"),E=$("#volumeExpander"),I=$("#muteButton"),R=$("#volumeAlert"),k=$("#captionsButton"),L=$("#dockedCaption"),D=$("#dockedCaptionText"),x=$("#overlayCaption"),U=$("#qualityButton"),M=U.find("#qualityBarWrapper"),B=$("#quickRewindButton"),A=$("#playSpeedButton"),H=$("#playSpeedExpander"),O=$("#playSpeedMultiplier"),F=b.find("#positionHandle"),G=b.find("#hoverTimestamp"),z=b.find("#hoverTick"),N=$("#seekToLiveButton"),j=$("#liveButton"),Q=$("#qualityExpander"),K=$("#captionsExpander"),q=K.find("#captionPlacementOptions"),W=K.find("#captionColorOptions"),J=K.find("#captionSizeOptions"),Y=K.find("#captionsToggle"),X=$("#primaryPlayer"),Z=$("#secondaryPlayer"),ee=$("#viewer"),te=$("#absoluteControls"),oe=$("#fullscreenControls"),ne=$("#fsPlayButton"),ie=$("#fsRewindButton"),ae=$("#fsElapsed"),re=$("#fsDuration"),se=$("#fsSkipButton"),le=$("#fsExitButton"),ue=$("#fullscreenButton"),de=$("#primaryBuffering"),ce=$("#secondaryBuffering"),pe=Panopto.Core.CookieHelpers.getUserCookie(t.user.key,u.CaptionsCookie),fe="boolean"==typeof pe?pe:Panopto.viewer.captionsEnabledByDefault,Pe=Panopto.Core.CookieHelpers.getUserCookie(t.user.key,u.CaptionPlacementCookie),me=Panopto.Core.CookieHelpers.getUserCookie(t.user.key,u.CaptionSizeCookie),ve=Panopto.Core.CookieHelpers.getUserCookie(t.user.key,u.CaptionColorCookie),he=null!==Pe&&null!==me&&null!==ve?new PanoptoTS.Models.Settings.CaptionStyles(Pe,me,ve):Panopto.Captions.selectedStyles,ge=!1,ye=Panopto.Core.CookieHelpers.getUserCookie(t.user.key,t.requiresSilverlight?u.BitrateCookie:u.MBRBitrateCookie),we=!1,Ce=d.Normal,be=Panopto.Core.CookieHelpers.getUserCookie(t.user.key,u.VolumeCookie),Te=0,Se=t.duration,Ve="muted",Ee="paused",Ie="live",_e=function(e,n,i,a,s){n>0&&n!=Se&&(Se=n,b.slider("option","max",Se),b.find(".ui-slider-handle").attr("aria-valuemax",Se)),Math.abs(e-Se)<P&&(e=Se),r||b.slider("value",e),w.text(i),C.text(a),ae.text(i),re.text(s),t.isBroadcast&&(j.toggleClass(Ie,o.isLive()),j.attr("title",o.isLive()?"":Panopto.GlobalResources.ViewerPlus_Live_Tooltip),j.css("cursor",o.isLive()?"":"pointer"))},Re=function(){return he.placement===PanoptoTS.Models.Settings.CaptionPlacement.Docked},ke=function(){var o=L.is(":visible");k.toggle(!!t.hasCaptions),L.toggle(!!t.hasCaptions&&Re()&&fe),o!==L.is(":visible")&&e.resize(),X.find(".letterbox").toggleClass("no-border-radius",L.is(":visible")&&e.viewMode()===l.Primary),Z.toggleClass("no-border-radius",L.is(":visible")&&e.viewMode()===l.Secondary)},Le=function(){var t=_.find(Panopto.Captions.ColorOptions,function(e){return e.key===he.colorSchemeKey});L.add(x).css({"font-size":he.textSize+"px",color:t.color,"text-shadow":t.textShadow}),L.css({height:3*he.textSize,"border-color":t.dockedBorderColor,"background-color":t.dockedBackgroundColor}),D.css({"max-height":3*he.textSize}),x.css({opacity:t.overlayOpacity,"background-color":t.backgroundColor}),e.setCaptionStyles(he),q.children().each(function(e,t){$(t).toggleClass(Panopto.Core.Constants.SelectedClass,he.placement===$(t).data("value"))}),W.children().each(function(e,t){$(t).toggleClass(Panopto.Core.Constants.SelectedClass,he.colorSchemeKey===$(t).data("value"))}),J.children().each(function(e,t){$(t).toggleClass(Panopto.Core.Constants.SelectedClass,he.textSize===$(t).data("value"))})},De=function(){Panopto.Core.CookieHelpers.setUserCookie(t.user.key,u.CaptionPlacementCookie,he.placement),Panopto.Core.CookieHelpers.setUserCookie(t.user.key,u.CaptionColorCookie,he.colorSchemeKey),Panopto.Core.CookieHelpers.setUserCookie(t.user.key,u.CaptionSizeCookie,he.textSize),Le(),e.synchronize(),e.resize()},xe=function(){return t.flowPlayerEnabled||Ce===d.Normal},Ue=function(){var t,i,a=_.find(n,function(e){return e.selected()});switch(e.viewMode()){case l.Primary:t=o;break;case l.Secondary:default:t=a&&a.hasMBR()?a:o}ge=t.hasMBR(),i=Math.max(u.BitrateLevels.length+t.bitrateLevelOffset()-1,0),M.attr("class","bar-"+i),xe()&&U.attr("title",ge?Panopto.GlobalResources.ViewerPlus_YourConnection.format(u.BitrateLevels[i]):Panopto.GlobalResources.ViewerPlus_OnlyOneBitrate),o.optimizationProvider()&&!we?(we=!0,o.optimizationProvider()===u.Kollective?$("#qualityOptionHeader").text(Panopto.GlobalResources.ViewerPlus_OptimizedStream_Kollective):o.optimizationProvider()===u.Hive&&$("#qualityOptionHeader").text(Panopto.GlobalResources.ViewerPlus_OptimizedStream_Hive)):we&&!o.optimizationProvider()&&$("#qualityOptionHeader").text(Panopto.GlobalResources.ViewerPlus_Quality),U.toggleClass(Panopto.Core.Constants.DisabledClass,!xe()||!ge)},Me=function(e,i,a){o.bitrate(e),_.each(n,function(t){t.bitrate(e)}),_.each(p,function(t,o){$("#"+o).toggleClass("selected",t===e).attr("aria-pressed",t===e)}),i&&Panopto.Core.CookieHelpers.setUserCookie(t.user.key,a,e)},Be=function(e){var t=o.muted();V.toggleClass(Ve,t),I.toggleClass(Ve,t),I.attr("title",t?Panopto.GlobalResources.ViewerPlus_Unmute:Panopto.GlobalResources.ViewerPlus_Mute),e&&S.slider("value",o.volume())},Ae=function(){var e=!o.muted();o.muted(e),Be(!0);var t=e?Panopto.GlobalResources.ViewerPlus_ARIA_Muted:Panopto.GlobalResources.ViewerPlus_ARIA_VolumeValue.format(o.volume());R.text(t)},He=function(e,n,i){e=Panopto.Core.ElementHelpers.clampSliderValue(S,e),i&&c.sendEvent({action:o.volume()<e?c.Actions.VolumeUp:c.Actions.VolumeDown,label:i}),$("#volumeLevel").css("width",e+"%"),o.volume(e),Be(!1),n&&S.slider("value",e),Panopto.Core.CookieHelpers.setUserCookie(t.user.key,u.VolumeCookie,e)},Oe=function(){V.mouseenter(),a&&clearTimeout(a),a=setTimeout(function(){E.mouseleave()},u.FlyoutTimeout)},$e=function(e){T.css("width",100*e/b.slider("option","max")+"%")},Fe=function(e,t,o){e="number"==typeof t?Se*(t/b.width()):e,e=Math.round(Panopto.Core.ElementHelpers.clampSliderValue(b,e));var n;try{n=N.is(":hover")}catch(e){n=!1}var i=n||o?Panopto.GlobalResources.ViewerPlus_Live:Panopto.Core.TimeHelpers.formatDuration(e,Panopto.GlobalResources.TimeSeparator),a=F.offset().left-F.parent().offset().left,r=a+F.outerWidth();G.text(i),G.show(),"undefined"!=typeof t?(t=Math.clamp(t,0,b.width()),G.css("left",t>=a&&t<=r?r:t-G.width()/2),z.show().css("left",t),z.toggleClass("accent-tick",z.offset().left<F.offset().left)):(G.css("left",e/Se*b.width()+F.outerWidth(!0)),z.hide())},Ge=function(){k.add(Y).toggleClass("safety-text",fe),Y.attr("title",fe?Panopto.GlobalResources.ViewerPlus_Captions_Hide:Panopto.GlobalResources.ViewerPlus_Captions_Show)},ze=function(e){h.toggleClass(Ee,e),ne.toggleClass(Ee,e),h.attr("title",e?Panopto.GlobalResources.ViewerPlus_Play:Panopto.GlobalResources.ViewerPlus_Pause)},Ne=function(o,n){var n="undefined"!=typeof n?n:!e.isFullscreen(),i=!!o&&o.closest("#primaryScreen").length>0;e.isFullscreen(n,i),t.flowPlayerEnabled&&Panopto.Core.Browser.fullscreenEnabled&&(n?o.parent().append(te):ee.append(te)),ue.toggleClass("fullscreen",n),ue.finish().hide(),oe.finish().hide(),de.css("z-index",i||!n?"":-1),ce.css("z-index",i&&n?-1:""),e.synchronize()};return Panopto.Core.UI.Handlers.button(h,function(){e.togglePlaying(c.Labels.Normal)}),Panopto.Core.UI.Handlers.button(m,function(){e.skipToStart(c.Labels.Normal)}),Panopto.Core.UI.Handlers.button(v,function(){e.rewind(c.Labels.Normal,u.EditJumpSeconds)}),v.attr("title",Panopto.GlobalResources.ViewerPlus_Rewind.format(u.EditJumpSeconds)),Panopto.Core.UI.Handlers.button(g,function(){e.forward(c.Labels.Normal,u.EditJumpSeconds)}),g.attr("title",Panopto.GlobalResources.ViewerPlus_Forward.format(u.EditJumpSeconds)),Panopto.Core.UI.Handlers.button(y,function(){e.skipToEnd(c.Labels.Normal)}),Panopto.Core.UI.Handlers.button(B,function(){e.rewind(c.Labels.Normal)}),B.attr("title",Panopto.GlobalResources.ViewerPlus_Rewind.format(u.QuickRewindSeconds)),b.mousemove(function(e){r||(Te=e.clientX-b.offset().left,Fe(0,Te),s=!0)}).mouseleave(function(){r||(G.hide(),z.hide(),s=!1)}),F.mouseup(function(t){var o=t.clientX-b.offset().left;Math.abs(o-Te)<=u.SliderDragThreshold&&e.position(o/b.width()*Se)}),Panopto.Core.UI.Components.hoveringFlyout(E,V,!0,u.FadeInterval,u.FlyoutTimeout),S.slider({max:100,min:0,value:u.InitialVolume,step:1,orientation:"horizontal",change:function(e,t){He(t.value,!1,!!e.originalEvent&&c.Labels.Normal)},slide:function(e,t){He(t.value,!1)}}),Panopto.Core.UI.Accessibility.slider(S,function(e){return Panopto.GlobalResources.ViewerPlus_ARIA_PercentValue.format(e)},Panopto.GlobalResources.Viewer_Aria_VolumeSlider),Panopto.Core.UI.Handlers.button(I.add(V),function(){e.toggleMuted(c.Labels.Normal)}),He("number"==typeof be?be:u.InitialVolume,!0),b.slider({max:Se,min:0,value:0,step:1,orientation:"horizontal",change:function(t,n){var i,a=Panopto.Core.ElementHelpers.clampSliderValue(b,n.value);r=!1,$e(a),t.originalEvent?(F.hide(),i=$(document.elementFromPoint(t.clientX||0,t.clientY||0)),i.is(".timeline-event")?i.click():e.position(a),F.show(),o.playState(e.playState(),!0),z.hide(),G.hide(),c.sendEvent({action:c.Actions.Seek,label:c.Labels.Normal})):s&&Fe(0,Te)},slide:function(e,t){var i=_.find(n,function(e){return e.selected()}),a=Panopto.Core.ElementHelpers.clampSliderValue(b,t.value);r=!0,o.playState(f.Paused),i&&i.playState(f.Paused),Fe(a),$e(a)}}),Panopto.Core.UI.Accessibility.slider(b,function(e){return Panopto.Core.TimeHelpers.formatDuration(e,Panopto.GlobalResources.TimeSeparator)},Panopto.GlobalResources.Viewer_Aria_PositionSlider),t.isBroadcast&&(N.show(),j.show(),Panopto.Core.UI.Handlers.button(N.add(j),function(){o.isLive()||(e.playState(f.Playing),o.isLive(!0,function(){e.synchronize(!0)}))}),N.focus(function(){Fe(0,N.position().left+N.width()/2,!0)})),Panopto.viewer.userCaptionControlsEnabled&&(Panopto.Core.UI.Components.flyout(K,k,u.FlyoutTimeout,!0,u.FadeInterval),_.each(Panopto.Captions.PlacementOptions,function(e){q.append(_.template($("#placementOptionTemplate").html(),e))}),Panopto.Core.UI.Handlers.button(q.children(),function(e){he.placement=$(e).data("value"),De()}),_.each(Panopto.Captions.ColorOptions,function(e){W.append(_.template($("#colorOptionTemplate").html(),e))}),Panopto.Core.UI.Handlers.button(W.children(),function(e){he.colorSchemeKey=$(e).data("value"),De()}),_.each(Panopto.Captions.SizeOptions,function(e){J.append(_.template($("#sizeOptionTemplate").html(),e))}),Panopto.Core.UI.Handlers.button(J.children(),function(e){he.textSize=$(e).data("value"),De()})),Panopto.Core.UI.Handlers.button(Panopto.viewer.userCaptionControlsEnabled?Y:k,function(){fe=!fe,Panopto.Core.CookieHelpers.setUserCookie(t.user.key,u.CaptionsCookie,fe),Ge(),e.synchronize()}),K.find("li").attr("tabindex",k.attr("tabindex")),t.requiresSilverlight&&!Silverlight.isInstalled(u.PlaySpeedSilverlightVersion)||!t.playSpeedEnabled?A.hide():(Panopto.Core.UI.Components.flyout(H,A,u.FlyoutTimeout,!0,u.FadeInterval),H.find(".flyout-close").before(_.template($("#playSpeedTemplate").html(),{playSpeeds:_.map(d,function(e,t){return{text:Panopto.GlobalResources[u.PlaySpeedResourceString.format(t)],id:t,speedClass:e===d.Normal?"selected":(e>d.Normal?"fast":"")+(e===d.Fastest?" fastest":"")}})})),Panopto.Core.UI.Handlers.button(H.find(".play-speed"),function(e){Ce=d[e.id],o.playSpeed(Ce),_.each(n,function(e){e.playSpeed(Ce)}),_.each(d,function(e,t){$("#"+t).toggleClass("selected",e===Ce).attr("aria-pressed",e===Ce),e===Ce&&O.text(Panopto.GlobalResources[u.PlaySpeedResourceString.format(t)])}),A.toggleClass("fast",Ce>d.Normal),H.hide(),U.toggleClass("disabled",!xe()),xe()||U.attr("title",Panopto.GlobalResources.ViewerPlus_QualityDisabled),c.sendEvent({action:c.Actions.Speed,label:Ce.toString()})}),O.text(Panopto.GlobalResources[u.PlaySpeedResourceString.format("Normal")])),t.multiBitrateEnabled?(Panopto.Core.UI.Components.flyout(Q,U,u.FlyoutTimeout,!0,u.FadeInterval,function(){return xe()&&ge}),$("#qualityOptionHeader").after(_.template($("#qualityOptionTemplate").html(),{qualityOptions:_.map(p,function(e,t){return{text:Panopto.GlobalResources[u.BitrateResourceString.format(t)],id:t}})})),Panopto.Core.UI.Handlers.button(Q.find(".quality-option"),function(e){var o=p[e.id];Me(o,!0,t.requiresSilverlight?u.BitrateCookie:u.MBRBitrateCookie),Q.hide(),c.sendEvent({action:c.Actions.Bitrate,label:_.invert(p)[o].toLowerCase()})}),Me(null!==ye?parseInt(ye,10):t.requiresSilverlight?Panopto.viewer.defaultSSFBitrate:Panopto.viewer.defaultMBRBitrate),E.css("right",U.outerWidth()+"px")):U.hide(),$(document).keydown(function(t){e.hotkey(t.keyCode)}),Panopto.Core.UI.Handlers.button(ne,function(){e.togglePlaying()}),Panopto.Core.UI.Handlers.button(ie,function(){e.rewind()}),Panopto.Core.UI.Handlers.button(se,function(){e.forward()}),Panopto.Core.UI.Handlers.button(le,function(){Ne(void 0,!1)}),$(document).on("dblclick","video",function(){Ne($(this))}),$(document).on("mousemove","video",function(){var t=$(this);t.css("cursor","default"),Panopto.Core.UI.Handlers.button(ue,function(){Ne(t)}),ue.css({top:t.offset().top,right:$(window).width()-(t.offset().left+t.width())}).fadeIn(u.FadeInterval),e.isFullscreen()&&oe.fadeIn(u.FadeInterval),clearTimeout(i),i=setTimeout(function(){ue.is(":hover")||oe.is(":hover")||(t.css("cursor","none"),ue.fadeOut(u.FadeInterval),oe.fadeOut(u.FadeInterval))},1e3*u.FullScreenControlInterval)}),$(document).on("click","video",function(){e.togglePlaying()}),$(document).on("contextmenu","video",function(){return!1}),$(document).keydown(function(t){if(t.keyCode===Panopto.Core.Key.Esc&&e.isFullscreen())return Ne(void 0,!1),!1}),t.flowPlayerEnabled&&Panopto.Core.Browser.fullscreenEnabled&&Panopto.Core.Browser.fullscreenEvent(function(e){e||Ne(void 0,!1)}),$(document).on("contextmenu","video",function(){return!1}),$(document).keydown(function(t){if(t.keyCode===Panopto.Core.Key.Esc&&e.isFullscreen())return Ne(),!1}),C.toggle(!t.isBroadcast),Le(),Ge(),{synchronize:_e,synchronizeCaption:ke,synchronizeBitrate:Ue,setBitrate:Me,toggleMuted:Ae,updateVolume:He,showVolumeControl:Oe,togglePlayState:ze,playSpeed:function(){return Ce},captionsSelected:function(){return fe},captionsDocked:Re}};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.ScormData=function(e,t){var o,n,i=Panopto.Viewer.Constants,a=[],r=0,s=0,l=function(){return r/e>i.ScormCompleteThreshold};if(window.console&&console.log(t),t&&(o=t.split("t"),o[0].length===e)){for(n=0;n<e;n++)a[n]=o[0].charAt(n),r+="x"===a[n]?1:0;s=o[1]||0}if(!a.length)for(n=0;n<e;n++)a[n]=" ";return{serialize:function(e){return a.join("")+"t"+e},markProgress:function(e){return e=Math.min(a.length,e),"x"!==a[e]&&(a[e]="x",r++,!0)},segmentsWatched:function(){return r},completed:l,shouldUpdateSegments:function(){return l()||r%10===0},shouldUpdatePosition:function(e,t,o,n){return Math.abs(e-t)>i.ScormOffsetMultiplier*o||e===n},lastPosition:function(){return s}}},Panopto.Viewer.ScormControl=function(e,t){var o,n=Panopto.Viewer.Constants,i=Math.min(Math.ceil(t),n.MaxScormSegments),a=t/i,r=0,s=0,l=function(e){var i=o.markProgress(Math.floor(e/a));if(i&&o.shouldUpdateSegments()||o.shouldUpdatePosition(e,s,a,t))try{SD.SetBookmark(o.serialize(e)),SD.LMSSetValue(n.ScormTimeKey,Math.floor(1e3*(o.segmentsWatched()*a-r))),i&&o.completed()&&SD.SetReachedEnd(),SD.CommitData(),s=e}catch(e){}};try{return o=Panopto.Viewer.ScormData(i,SD.GetBookmark()),o.lastPosition()&&(e.position(o.lastPosition()||0),s=o.lastPosition()),r=o.segmentsWatched()*a,{updateProgress:l}}catch(e){}};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.ViewMode=Panopto.Viewer.ViewMode||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.PlayState=Panopto.Viewer.PlayState||{},Panopto.Viewer.SecondaryTabControl=function(e,t,o,n){var i,a,r,s=Panopto.Viewer.ViewMode,l=Panopto.Viewer.Constants,u=Panopto.Viewer.PlayState,d=Panopto.Core.ViewerLogEntryType,c=!1,p=0,f=$("#selectedSecondaryText"),P=$("#selectedSecondaryIcon"),m=function(t,n){var i;_.each(o,function(o){o!==t?o.selected(!1,n):(i=!o.selected(),e.writeLineToClientLog(d.StreamChange,["Secondary",o.id()]))}),t.selected(!0,n),e.ensureSecondaryIsMinimized(),t.position(e.position(),!0,i),t.playState(e.playState(),n),e.resize()},v=function(){return _.find(o,function(e){return e.selected()})},h=function(t,n){var i=v(),a=_.find(o,function(e){return e.id()===t});!a||!a.available(e.position())||n&&i.id()===l.SlideDeckId||m(a)},g=function(){var t=$("."+l.SecondaryTabHeaderClass),n=$("#selectedSecondary"),i=$("#secondaryExpander");Panopto.Core.UI.Handlers.button(t,function(t){var n=_.find(o,function(e){return e.owns(t)});n&&n.enabled()&&("number"==typeof n.seekTime()&&e.position(n.seekTime()),m(n,!0)),i.hide()}),Panopto.Core.UI.Components.flyout(i,n,l.FlyoutTimeout,!0,l.FadeInterval),e.toggleInlineSecondaries()},y=function(r,s){var p,f,P,m=0,v=t.activePrimary(),h=_.find(o,function(e){return e.selected()});v&&(s&&e.writeLineToClientLog(d.UserInitiatedSync,[v.id]),i!==v.id&&(i=v.id,e.writeLineToClientLog(d.StreamChange,["Primary",v.id])),c!==t.isFullscreen()&&e.writeLineToClientLog(d.FullscreenChange,["Primary",t.isFullscreen()])),h&&(s||c&&!t.isFullscreen()?(t.playState(e.playState(),s),h.playState(e.playState()),h.position(r,!0)):t.isFullscreen()?(C(),t.playState(e.playState(),s)):e.playState()===u.Playing&&(m=h.position(r),p=m?Math.abs(m):0,p>l.SecondarySyncThreshold*n.playSpeed()?(f=m>0?t:h,P=m>0?h:t,a||(e.logDesync(m),e.writeLineToClientLog(d.StreamDesync,[m])),f.playState(u.Paused),P.playState(u.Playing),C(),a=setTimeout(function(){f.playState(u.Playing),C()},1e3*p/n.playSpeed())):e.writeLineToClientLog(d.StreamSync,[m]))),c=t.isFullscreen()},w=function(e,t){_.each(o,function(o){var n=o.content().isBroadcast&&t.indexOf(o)!==-1;o.enabled(e&&!n)})},C=function(){window.clearTimeout(a),a=void 0},b=function(t,n,i){var a=!1,c=null,v=!1,h=[],g=!1,b=_.filter(o,function(e){return e.available(t)}),T=[],S=_.find(o,function(e){return e.isSessionPlaybackBlocking()&&e.timeline()[0]<t}),V=_.find(o,function(e){var o=e.timeline()[0];return e.pauseWhenAvailable()&&e!==r&&o<=t&&o>=n&&b.indexOf(e)!==b.length-1});return i&&C(),S&&t!==S.timeline()[0]?(e.playState(u.Paused),e.position(S.timeline()[0])):V&&t!==V.timeline()[0]?e.position(V.timeline()[0]):(_.each(o,function(e){h=h.concat(e.timeline()),e.available(t)?c=e:(T.push(e),e.selected()&&(e.selected(!1),g=!0))}),h.sort(function(e,t){return e-t}),p=_.find(h,function(e){return e>t}),v=p<l.InitialSecondaryThreshold&&h.length&&h[0]<l.InitialSecondaryThreshold,c?(e.viewMode(s.Secondary),g=g||!r||_.indexOf(o,c)>_.indexOf(o,r),g&&(m(c),e.resize()),g&&c.pauseWhenAvailable()&&(e.playState(u.Paused),e.isFullscreen(!1)),w(!c.hiddenTab(),T)):(_.each(o,function(e){e.selected(!1)}),e.ensureSecondaryIsMinimized(),e.viewMode(v?s.Secondary:s.Primary),f.text(Panopto.GlobalResources.ViewerPlus_SecondarySources),P.html("").attr("class",""),w(!0,T)),r&&!c&&e.writeLineToClientLog(d.StreamChange,["Secondary","null"]),r=c,y(t,i),a=!0),a};return{selectTabById:h,attachTabHandlers:g,clearSyncTimeout:C,selectedTab:v,synchronize:b,synchronizeSecondaryTab:y}};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.StreamUploader=function(e){var t=e.sessionId,o=e.streamType,n=e.supportedExtensions,i=e.$addButton,a=e.$uploadList,r=e.invalidFileError,s=e.onComplete,l=$("#uploadTemplate"),u="upload-bytes",d="upload-progress",c="upload-delete",p="upload-error",f="upload-processing",P=function(e){var t;a.append(_.template(l.html(),e)),t=a.find("#"+e.fileId),Panopto.Core.UI.Handlers.button(t.find("."+c),function(){e.request.cancel(),Panopto.Core.ServiceInterface.MultipartUploadManager.cancelUpload(e.fileId),e.uploadId?Panopto.Core.ServiceInterface.SessionUploadManagement.deleteUpload(e.uploadId,function(){t.remove()},function(){v(e,Panopto.GlobalResources.ViewerPlus_Edit_UploadDeleteError)}):t.remove()}),e.$row=t},m=function(e){e.$row.find("."+u).show().text(Panopto.Core.StringHelpers.readableUploadProgress(e.bytesUploaded,e.fileSize,Panopto.GlobalResources,"ViewerPlus_Edit_UploadProgress")),e.$row.find("."+d).show(),e.$row.find(".upload-progress-bar").css("width","{0}%".format(e.bytesUploaded/e.fileSize*100)),e.$row.find("."+p).hide()},v=function(e,t){e.$row.find("."+u).text(""),e.$row.find("."+d).hide(),e.$row.find("."+f).css("visibility","hidden"),e.$row.find("."+p).show().text(t)},h=function(e){var i=_.uniqueId("file"),a=new Panopto.Core.CancellableRequest,s=new Panopto.Core.CancellableRequest,l={fileId:i,filename:e.name,fileSize:e.size,bytesUploaded:0,extension:"."+Panopto.Core.StringHelpers.parseExtension(e.name),request:new Panopto.Core.CancellableRequest(function(){a.cancel(),s.cancel()})};P(l),_.contains(n,l.extension)?a=Panopto.Core.ServiceInterface.SessionUploadManagement.openUpload({sessionId:t,filename:e.name,startTime:new Date,streamType:o},function(t){l.uploadId=t.ID,Panopto.Core.ServiceInterface.MultipartUploadManager.queueUpload({file:e,fileId:i,uploadUri:t.UploadTarget},function(e){l.bytesUploaded=e,m(l)},function(){s=Panopto.Core.ServiceInterface.SessionUploadManagement.closeUpload(t,function(){g(l)},function(){v(l,Panopto.GlobalResources.ViewerPlus_Edit_UploadError)})},function(){v(l,Panopto.GlobalResources.ViewerPlus_Edit_UploadError)}),Panopto.Core.ServiceInterface.MultipartUploadManager.upload()},function(){v(l,Panopto.GlobalResources.ViewerPlus_Edit_UploadError)}):v(l,r)},g=function(e){var t=function(){setTimeout(function(){Panopto.Core.ServiceInterface.SessionUploadManagement.getUpload(e.uploadId,function(o){o.State===Panopto.Core.UploadStatus.Complete?s(e.$row):o.State===Panopto.Core.UploadStatus.ProcessingError?v(e,Panopto.GlobalResources.ViewerPlus_Edit_UploadProcessingError):t()},t)},1e4)};e.$row.find("."+u).hide(),e.$row.find("."+d).hide(),e.$row.find("."+f).show(),t()},y=$("<input />",{type:"file",multiple:!1,accept:n.join(",")});y.on("change",function(e){
var t=e.originalEvent.target.files;t.length&&h(t[0])}).hide().insertAfter(i),Panopto.Core.UI.Handlers.button(i,function(){y.click()},{keyEvent:"keypress"}),Panopto.Core.ServiceInterface.SessionUploadManagement.setHost(window.location.origin),Panopto.Core.ServiceInterface.SessionUploadManagement.getUploads(t,function(e){_.each(e.ProcessingUploads,function(e){var t;e.StreamType===o&&(t={uploadId:e.ID,fileId:_.uniqueId("file"),filename:e.UserFilename,request:new Panopto.Core.CancellableRequest},P(t),g(t))})},function(){}),$(window).on("beforeunload",function(){return Panopto.Core.ServiceInterface.MultipartUploadManager.isRunning()?Panopto.GlobalResources.ViewerPlus_Edit_WaitForUpload:void 0})};var Panopto=Panopto||{};Panopto.UI=Panopto.UI||{},Panopto.UI.Components=Panopto.UI.Components||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Controls=Panopto.Viewer.Controls||{},Panopto.Viewer.Controls.ThumbnailStrip=function(e,t,o,n,i){var a,r,s=Panopto.Viewer.Constants,l=Panopto.Viewer.Analytics,u=Panopto.Core.UI.Components.scrollingHighlight(e,!1,s.ThumbnailScrollTimeout),d=function(r){var d,c=a,p=[],f=0,P=Panopto.cacheRoot+"/Styles/Less/Application/Images/Widgets/audio_only_large.png",m=function(){f++,r&&f===p.length&&r()};a=_.map(t,function(t){var o=n?n.activeState().toTimelineRelativeTime(t.timelineTime)/Panopto.Core.Constants.TimelineChunkMultiplier:t.time;return t.id=t.id||_.uniqueId(),{time:o,timestamp:Panopto.Core.TimeHelpers.formatDuration(o,Panopto.GlobalResources.TimeSeparator),id:"thumbnail"+t.id+e.attr("id"),thumbnailId:t.id,src:t.queryParams?"{0}?{1}".format(s.ThumbUrl,Panopto.Core.StringHelpers.serializeObjectToQueryString(t.queryParams)):t.thumbnailUrl||P,tabId:t.tabId||(t.type===Panopto.Core.EventTargetType.PowerPoint?Panopto.Viewer.Constants.SlideDeckId:t.streamId),isSlide:t.isSlide,editable:!!n}}),d=_.filter(c,function(e){return!_.find(a,function(t){return e.thumbnailId===t.thumbnailId})}),_.each(a,function(e){var t=_.find(c,function(t){return e.thumbnailId===t.thumbnailId});t?t.time!==e.time&&(p.push(e),d.push(t)):p.push(e)}),_.each(d,function(e){$("#"+e.id).remove()}),_.each(a,function(t,o){var n;p.indexOf(t)>=0&&(n=_.template($("#thumbnailTemplate").html(),{thumbnails:[t]}),0===o?e.prepend(n):o===a.length-1?e.append(n):$("#"+a[o-1].id).after(n))});var v=[];_.each(p,function(e){var t=$("#"+e.id),a=t.find(".thumbnail-buttons"),r=a.find(".thumbnail-edit"),s=a.find(".thumbnail-delete"),d=t.find("img");_.each(d,function(e){v.push(e)}),d.on("load",function(){t.show(),m()}).on("error",function(){$(this).attr("src")!==P?$(this).attr("src",P):(t.width(t.height()),t.show(),m())}),Panopto.Core.UI.Handlers.button(t,function(t){u.highlight(e,function(e){o.position(e.time),e.tabId&&o.selectSecondaryTab(e.tabId,e.isSlide),l.sendEvent({action:l.Actions.Navigate,label:l.Labels.Thumbnail})})}),n&&(i?a.show():Panopto.Core.UI.Handlers.hoverableParent(t,a,function(e){a.toggle(e)}),Panopto.Core.UI.Handlers.button(r,function(){n.openEventDialog(e.thumbnailId)}),Panopto.Core.UI.Handlers.button(s,function(){n.removeEvent(e.thumbnailId)}))}),Panopto.Core.ImageHelpers.queueLoad($(v),8)},c=function(e,t){var o;e!==r&&(_.each(a,function(t){t.time<=e&&(o=t)}),u.highlight(o,!1,t),r=e)},p=function(t){e.toggle(t&&a.length>0)};return{render:d,position:c,toggle:p,thumbnails:function(e){return e?(t=e,void d()):t}}};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Controls=Panopto.Viewer.Controls||{},Panopto.Viewer.Controls.Timeline=Panopto.Viewer.Controls.Timeline||{},Panopto.Viewer.Controls.Timeline.TimelineSegment=function(e,t,o){return{element:e,start:t/Panopto.Core.Constants.TimelineChunkMultiplier,end:o/Panopto.Core.Constants.TimelineChunkMultiplier}},Panopto.Viewer.Controls.Timeline.TimelineConverter=function(e,t){var o,n,i,a=Panopto.Viewer.Controls.Timeline.TimelineSegment,r=function(t,r){o=t;var l,u,d=_.sortBy(o.streams(),"absoluteStart"),c=r?Panopto.Core.Logic.Timeline.Timeline(d,o.cuts()):o.timeline(),p=c.elements(),f=c.firstPrimaryIndex(),P=c.lastPrimaryIndex(),m=0,v=o.firstPrimaryOffset()/Panopto.Core.Constants.TimelineChunkMultiplier;for(n=[],i=[],l=0;l<=p.length-1;l++)l>=f&&l<=P&&(u=a(p[l],m,m+p[l].length()),n.push(u),p[l].containsPrimary()&&i.push(u)),m+=p[l].length();_.each(n,function(e){e.start-=v,e.end-=v}),e.setPrimarySegments(n,i,o.duration()/Panopto.Core.Constants.TimelineChunkMultiplier,!r),s()},s=function(){_.each(t.secondaryStreams,function(e){e.segments.length=0,e.timeline.length=0,_.each(n,function(t){var o=t.element.getStreamById(e.id);o&&(e.segments.push({relativeStart:t.start,relativeEnd:t.end,streamOffset:o.offset/Panopto.Core.Constants.TimelineChunkMultiplier}),e.timeline.push(t.start,t.end))})})},l=function(e){var t,n,a=e;return i&&(n=_.some(i,function(t){return t.start<=e&&t.end>=e}),n||(t=_.find(i,function(t){return t.start>e}),a=t?t.start:o.duration()/Panopto.Core.Constants.TimelineChunkMultiplier)),a};return{timelinePosition:l,computeSegments:r}};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Controls=Panopto.Viewer.Controls||{},Panopto.Viewer.Controls.Timeline=Panopto.Viewer.Controls.Timeline||{},Panopto.Viewer.Controls.Timeline.TimelineEditor=function(e,t,o){var n,i,a,r,s,l,u,d,c,p,f,P,m,v,h={},g=!0,y=[],w=!1,C=[],b=new Panopto.Core.JobQueue({maxDegreeOfParallelism:1,maxAttempts:1,autoStart:!0}),T=[],S=$("#timelineContainer"),V=$("#saveMessageText"),E=$("#saveRetryLink"),I=$("#undoButton"),R=$("#redoButton"),k=$("#commitButton"),L=$("#revertButton"),D=$("#closeButton"),x=($(".editor-toggle"),$("#moreTabsButton")),U=$("#advancedEditorLink"),M=$("#expandTimelineButton"),B=$("#toggleTimelineButton"),A=$("#slideStackExpandedView"),H=$("#slideStackExpandedViewTriangle"),O=A.add(H),F=function(e){s.resize(e-M.outerWidth())},G=function(t,o){var n=e.activePrimary(),i=e.activeSecondary(),a=i&&(_.find(u.streams(),function(e){return e.id===i.id})||i.id===Panopto.Viewer.Constants.SlideDeckId);s.synchronize(t*Panopto.Core.Constants.TimelineChunkMultiplier,{playing:o,primaryAudioOnly:n&&n.type===Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio,secondaryAvailable:a}),m.position(t)},z=function(e){return _.find(u.streams(),function(t){return t.id===e})},N=function(e){var t;switch(e.type){case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio:t=Panopto.GlobalResources.ViewerPlus_AudioTitle;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen:case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Slide:t=Panopto.GlobalResources.ViewerPlus_ScreenCaptureTitle;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera:default:t=Panopto.GlobalResources.ViewerPlus_ObjectVideoTitle}return t},j=function(e,t,o){e=e||z(t);var n=e.name;return n||(n=N(e)),o?Panopto.GlobalResources.ViewerPlus_Edit_StreamNameAndType.format(n,e.isPrimary?Panopto.GlobalResources.ViewerPlus_Edit_Primary.toLowerCase():Panopto.GlobalResources.ViewerPlus_Edit_Secondary.toLowerCase()):n},Q=function(e,t){e=e||z(t);var o;switch(e.type){case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen:case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Slide:o=Panopto.Viewer.Constants.ScreenCaptureClass;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio:case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera:default:o=Panopto.Viewer.Constants.ObjectVideoTabClass}return o},K=function(){var o=_.filter(u.events(),function(e){return!e.isDefaultThumbnail}),n=_.filter(o,function(e){return e.link}),i=_.filter(o,function(e){return e.type===Panopto.Core.EventType.SlideChange}),a=_.filter(o,function(e){return e.type===Panopto.Core.EventType.Caption}),r=function(e){return u.toTimelineRelativeTime(e)/Panopto.Core.Constants.TimelineChunkMultiplier};t.documents.length=0,_.each(u.questionLists(),function(e){var o=(e.sessionRelativeTime-u.firstPrimaryOffset())/Panopto.Core.Constants.TimelineChunkMultiplier;t.documents.push({title:e.name,id:"urlTab"+e.id,timeline:[o,o+Panopto.Viewer.Constants.UrlEventDuration],url:Panopto.Viewer.Constants.QuizEditUrlTemplate.format(e.id),iconCode:Panopto.Core.Constants.QuestionListIconCode,pauseWhenAvailable:!0,hiddenTab:!0})}),_.each(n,function(e){var o=r(e.timelineTime),n=e.link.indexOf(Panopto.Viewer.Constants.YouTubeEmbedBaseUrl)!==-1,i=n?Panopto.Viewer.Constants.YouTubeEditUrlTemplate.format(e.id):e.link;t.documents.push({title:e.name||Panopto.GlobalResources.ViewerPlus_Website,id:"urlTab"+e.id,timeline:[o,o+Panopto.Viewer.Constants.UrlEventDuration],url:i,pauseWhenAvailable:!0,iconClass:n?Panopto.Viewer.Constants.YouTubeIconClass:void 0,iconCode:n?void 0:Panopto.Core.Constants.LinkIconCode})}),t.documents.sort(function(e,t){return e.timeline[0]-t.timeline[0]}),t.slideDecks.length=0,i.length&&t.slideDecks.push({title:Panopto.GlobalResources.ViewerPlus_SlidesTitle,id:Panopto.Viewer.Constants.SlideDeckId,timeline:[0],slides:_.map(i,function(e){return{time:r(e.timelineTime),url:e.slideUrl}}),iconCode:Panopto.Core.Constants.SlideIconCode,tabClass:Panopto.Viewer.Constants.SlideDeckTabClass}),t.hasCaptions=!!a.length,a.length&&(t.captions=[],_.each(a,function(e){t.captions.push({time:r(e.timelineTime),text:_.escape(e.name)})})),_.each(t.secondaryStreams,function(e){e.title=j(void 0,e.id)}),e.refreshPlayers()},q=function(e){return g?r.timelinePosition(e):e},W=function(e){var t=_.find(u.events(),function(t){return t.id===e}),o=_.find(C,function(e){return e.ownsEvent(t)});o.openEditDialog(t),O.hide()},J=function(e){ie(),u.events().splice(_.findIndex(u.events(),function(t){return t.id===e}),1),Z(),O.hide()},Y=function(){f.events(u.streams()),a.cuts(u.cuts()),p.events(u.cuts()),P&&P.events(u.questionLists()),u.events().sort(function(e,t){return e.timelineTime-t.timelineTime}),_.each(C,function(e){e.events(u.events())}),m.thumbnails(u.events())},X=function(t){r.computeSegments(u,g),ne(),t||(m.toggle(!S.is(":visible")),e.resize(),K(),e.synchronize(!0))},Z=function(e){Y(),e||s.applyState(u),X(e),de()},ee=function(){Y(),s.applyState(u),X()},te=function(){var e=y.indexOf(u);e&&(u=y[e-1],Z())},oe=function(){var e=y.indexOf(u);e<y.length-1&&(u=y[e+1],Z())},ne=function(){var e=y.indexOf(u);I.toggleClass(Panopto.Core.Constants.DisabledClass,!e),R.toggleClass(Panopto.Core.Constants.DisabledClass,e===y.length-1),k.add(L).toggleClass(Panopto.Core.Constants.DisabledClass,u===l||!i.id)},ie=function(){var e=y.indexOf(u),t=u.copy();y.splice(e+1,y.length-1-e,t),u=t,Y()},ae=function(e){return _.each(e,function(e){e.sessionId=t.id}),_.filter(e,function(e){return e.timelineTime})},re=function(e){_.each(e,function(e){e.sessionId=t.id})},se=function(e){w=!0,clearTimeout(v),V.show(),V.text(e),V.removeClass(Panopto.Core.Constants.ErrorClass),k.add(L).toggleClass(Panopto.Core.Constants.DisabledClass,!0),E.hide()},le=function(e,t,o){w=!1,ne(),t?(V.text(e.format(Panopto.Core.TimeHelpers.utcDateToFormattedString(Panopto.Core.TimeHelpers.toLocalPanoptoTime(Date.now(),Panopto.timeZone),"LT"))),v=setTimeout(function(){V.fadeOut()},2e4)):(V.text(e),V.addClass(Panopto.Core.Constants.ErrorClass),E.toggle(!!o),Panopto.Core.UI.Handlers.button(E,o))},ue=function(t){"SessionChangeSet Update can't change the owner of the change set"!==t.responseJSON&&"Object not found"!==t.responseJSON&&"Session already has an uncommitted change set."!==t.responseJSON||(i.id=void 0,I.add(R).add(k).add(L).toggleClass("disabled",!0),e.toggleMessage(Panopto.GlobalResources.ViewerPlus_Edit_ChangesLost))},de=function(){b.hasQueuedJobs()||b.queueJob({attempt:function(e){var o,n,a,r,s=function(){le(Panopto.GlobalResources.ViewerPlus_Edit_SavedAt,!0),e(!0)},p=function(t){le(Panopto.GlobalResources.ViewerPlus_Edit_SaveFailure,!1,de),ue(t),e(!1)};u===l?Panopto.Core.ServiceInterface.Rest.SessionChangeSets.deleteChangeSet(i.id,function(){i=Panopto.Core.ServiceInterface.Rest.Objects.SessionChangeSet({sessionId:t.id}),s()},p):(o=_.object(_.map(d,function(e){return e.id}),d),n=_.object(_.map(u.events(),function(e){return e.id}),u.events()),a=_.object(_.map(c,function(e){return e.id}),c),r=_.object(_.map(u.questionLists(),function(e){return e.id}),u.questionLists()),i.cutsToReplace=u.cuts(),i.streamsToUpdate=u.streams(),i.slideDecksToDelete=u.slideDecksToDelete(),i.eventsToAdd=_.filter(u.events(),function(e){return!o[e.id]}),i.eventsToUpdate=_.filter(u.events(),function(e){return o[e.id]&&e.edited}),i.eventsToDelete=_.filter(d,function(e){return!n[e.id]}),i.questionListRevisions=_.filter(u.questionLists(),function(e){return!a[e.id]||e.edited}),i.questionListIdsToDelete=_.map(_.filter(c,function(e){return!r[e.id]}),function(e){return e.id}),se(Panopto.GlobalResources.ViewerPlus_Edit_Saving),Panopto.Core.ServiceInterface.Rest.SessionChangeSets.save(i,function(e){i.id=e.id,s()},p))}})},ce=function(){b.queueJob({attempt:function(e){u!==l&&i.id&&(se(Panopto.GlobalResources.ViewerPlus_Edit_Publishing),Panopto.Core.ServiceInterface.Rest.SessionChangeSets.commitChanges(i,function(){le(Panopto.GlobalResources.ViewerPlus_Edit_PublishedAt,!0),i.id=void 0,e(!0),confirm(Panopto.GlobalResources.ViewerPlus_Edit_ContinueEditing)?D.click():window.location.reload()},function(t){le(Panopto.GlobalResources.ViewerPlus_Edit_PublishFailure,!1,ce),ue(t),e(!1)}))}})},pe=function(){confirm(Panopto.GlobalResources.ViewerPlus_Edit_ConfirmRevert)&&(b.emptyQueue(),b.queueJob({attempt:function(e){u!==l&&i.id&&(se(Panopto.GlobalResources.ViewerPlus_Edit_Reverting),Panopto.Core.ServiceInterface.Rest.SessionChangeSets.deleteChangeSet(i.id,function(){le(Panopto.GlobalResources.ViewerPlus_Edit_RevertedAt,!0),i=Panopto.Core.ServiceInterface.Rest.Objects.SessionChangeSet({sessionId:t.id}),y.length=0,u=l,y.push(u),ee(),e(!0)},function(t){le(Panopto.GlobalResources.ViewerPlus_Edit_RevertFailure,!1,pe),detectLostChangeset(t),e(!1)}))}}))},fe=function(e,t,o,n){var i=Panopto.Core.Logic.Timeline.Timeline(t),a=[],r=e.absoluteStart;_.each(i.elements(),function(e){e.streams().length||a.push({start:r,end:r+e.length(),length:e.length()}),r+=e.length()}),a.reverse(),_.each(a,function(i){var a=[];_.each(t,function(e){e.absoluteStart>=i.end&&(e.absoluteStart-=i.length)}),_.each(o,function(t){t.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session&&t.start+e.absoluteStart>=i.end&&(t.start-=i.length)}),_.each(n,function(e){var t;e.timelineTime>i.start&&e.timelineTime<i.end&&e.type===Panopto.Core.EventType.SlideChange?(t=_.find(n,function(t){return t.type===Panopto.Core.EventType.SlideChange&&t.timelineTime>e.timelineTime}),t&&t.timelineTime<=i.end?a.push(e):(e.timelineTime=i.start,e.edited=!0)):e.timelineTime>=i.end&&(e.timelineTime-=i.length,e.edited=!0)}),_.each(a,function(e){n.splice(n.indexOf(e),1)})})},Pe=function(){var e=_.filter(u.streams(),function(e){return e.isPrimary}),t=_.pluck(e,"id"),o=_.filter(u.cuts(),function(e){return e.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream&&_.contains(t,e.targetId)}),n=Panopto.Core.Logic.Timeline.Timeline(e,o);_.each(n.elements(),function(e){var t,o=e.streams();if(o.length>1)for(t=1;t<o.length;t++)a.addCut(o[t].offset,o[t].offset+e.length(),o[t].stream.id,Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream)})},me=function(e,o,n){var i;a.addCut(e,o,n||t.id,n?Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream:Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session),i=Panopto.Core.Logic.Timeline.Timeline(u.streams(),u.cuts()),n||_.some(i.elements(),function(e){return e.containsPrimary()})||(a.removeAll(t.id,Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session),s.applyState(u),alert(Panopto.GlobalResources.ViewerPlus_Edit_CutEntireSession))},ve=function(e,o){a.removeCut(e,o||t.id,o?Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream:Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session)},he=function(e,t,o,n){ve(e,n),me(t,o,n)},ge=function(t){ie(),u.questionLists().push(Panopto.Core.ServiceInterface.Rest.Objects.QuestionList({name:t||Panopto.GlobalResources.ViewerPlus_Edit_QuestionList_DefaultName,sessionId:n.id,sessionRelativeTime:e.position()*Panopto.Core.Constants.TimelineChunkMultiplier+u.firstPrimaryOffset(),isSessionPlaybackBlocking:!0,allowRetake:!0,showFinalGrade:!0,allowReview:!0,questions:[Panopto.Core.ServiceInterface.Rest.Objects.Question({name:Panopto.GlobalResources.ViewerPlus_Edit_QuestionList_DefaultQuestionName,questionType:Panopto.Core.QuestionType.MultipleChoice,options:[Panopto.Core.ServiceInterface.Rest.Objects.QuestionOption({name:Panopto.GlobalResources.ViewerPlus_Edit_QuestionList_DefaultOption1,isCorrect:!0}),Panopto.Core.ServiceInterface.Rest.Objects.QuestionOption({name:Panopto.GlobalResources.ViewerPlus_Edit_QuestionList_DefaultOption2,isCorrect:!1})]})]})),Z(!1)},ye=function(t){var o=u.fromTimelineRelativeTime(e.position()*Panopto.Core.Constants.TimelineChunkMultiplier);ie();var i=_.find(u.events(),function(e){return e.isDefaultThumbnail});i&&u.events().splice(u.events().indexOf(i),1);var a=t?e.activePrimary():e.activeSecondary(),r=Panopto.Core.ServiceInterface.Rest.Objects.Event({sessionId:n.id,timelineTime:o,isDefaultThumbnail:!0});if(_.find(u.streams(),function(e){return e.id===a.id}))r.type=Panopto.Core.EventType.Label,r.streamId=a.id;else if(a.id===Panopto.Viewer.Constants.SlideDeckId){r.type=Panopto.Core.EventType.SlideChange;var s=_.filter(u.events(),function(e){return e.type===Panopto.Core.EventType.SlideChange});s=_.sortBy(s,"timelineTime"),r.slideId=s[0].slideId,_.find(s,function(e){return!(e.timelineTime<=o)||void(r.slideId=e.slideId)})}u.events().push(r),Z()},we=function(e){return _.find(u.questionLists(),function(t){return t.id===e})},Ce=function(e){ie();var t=Panopto.Core.ServiceInterface.Rest.Objects.QuestionList(e);t.edited=!0;var o=we(t.id);return u.questionLists().splice(u.questionLists().indexOf(o),1,t),Z(o.name===t.name&&o.timelineRelativeTime===t.timelineRelativeTime),t},be=function(e){var t=_.find(u.events(),function(t){return t.id===e});return t.sessionRelativeTime=u.toTimelineRelativeTime(t.timelineTime),t},Te=function(t){ie();var o=Panopto.Core.ServiceInterface.Rest.Objects.Event(t);o.edited=!0,o.timelineTime=u.fromTimelineRelativeTime(t.sessionRelativeTime);var n=be(o.id);u.events().splice(u.events().indexOf(n),1,o);var i=n.timelineTime!==o.timelineTime;return Z(n.name===o.name&&!i),i&&e.position(t.sessionRelativeTime/Panopto.Core.Constants.TimelineChunkMultiplier),o.sessionRelativeTime=t.sessionRelativeTime,o},Se=function(){var e=u.cuts(),t=[],o=Panopto.Viewer.Constants.BoundaryCutTolerance*Panopto.Core.Constants.TimelineChunkMultiplier;_.each(e,function(e){var n=_.find(u.streams(),function(t){return t.id===e.targetId}),i=n?n.duration:u.duration();e.start>=i||e.end()<=0?t.push(e):(e.start<0&&(e.start=0),(e.end()>i||Math.abs(e.end()-i)<o)&&(e.duration=i-e.start))}),_.each(t,function(t){e.splice(e.indexOf(t),1)})},Ve=function(i,v,b,V,E){var F=_.min(_.filter(i,function(e){return e.isPrimary}),function(e){return e.absoluteStart}),G=function(e){var t=e.streamId?0:u.firstPrimaryOffset();me(e.markers[0].time()+t,e.markers[1].time()+t,e.streamId)},z=function(e){ve(e.markers[0].time()+(e.streamId?0:u.firstPrimaryOffset()),e.streamId)};_.each(t.primaryStreams.concat(t.secondaryStreams),function(e){var t=_.find(i,function(t){return t.id===e.id});t&&(e.length=t.duration/Panopto.Core.Constants.TimelineChunkMultiplier,e.url=t.url,e.httpUrl=t.httpUrl)}),V=ae(V),re(E),d=V,V=_.map(V,function(e){return e.copy()}),c=E,E=_.map(E,function(e){return e.copy()}),fe(F,i,v,V),S.show(),a=Panopto.Core.Logic.Timeline.CutEditor(v),r=Panopto.Viewer.Controls.Timeline.TimelineConverter(e,t),s=Panopto.Core.UI.Components.Editor.TimelineView($("#timelineViewContainer"),Panopto.branding.accentColor,{positionChanged:function(t){e.position(t/Panopto.Core.Constants.TimelineChunkMultiplier)},cutAdded:function(e){ie(),G(e),Z(!0)},cutRemoved:function(e){ie(),z(e),Z(!0)},cutResized:function(e,t){var o=t.streamId?0:u.firstPrimaryOffset();ie(),he(e+o,t.markers[0].time()+o,t.markers[1].time()+o,t.streamId),Z(!0)},focusAdded:function(e,t){ie(),_.each(e,z),_.each(t,G),Z(!0)},previewChanged:function(e){g=e,X()},thumbnailChosen:ye,uploadChosen:function(){e.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"SessionInfo",modalHeader:Panopto.Core.TextHelpers.innerText(n.name),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:n.id})})},stackExpanded:function(t,o){var n,i,a,r="expanded-view",s=t.length===T.length&&_.every(T,function(e){return _.find(t,function(t){return e.id===t.id})});s?(O.hide(),T=[]):(T=t,n=Panopto.Viewer.Controls.ThumbnailStrip(A,t,e,h,!0),i=o.offset().left+o.outerWidth()/2,a=o.offset().top-10,A.empty(),n.render(function(){A.show().toggleClass("no-scroll",A[0].scrollWidth===A.innerWidth()).css({left:Math.clamp(i-A.outerWidth()/2,0,$(window).width()-A.outerWidth()),top:a-A.outerHeight()}),H.show().css({left:i,top:a}),$(document).on("mousedown."+r,function(e){A.is(e.target)||H.is(e.target)||0!==A.find(e.target).length||(O.hide(),$(document).off("mousedown."+r))})}))}},{previewCuts:Panopto.GlobalResources.ViewerPlus_Edit_PreviewCuts,timeSeparator:Panopto.GlobalResources.TimeSeparator,millisecondPrecision:Panopto.Viewer.Constants.DisplayTimeMillisecondPrecision,pointerTool:Panopto.GlobalResources.ViewerPlus_Edit_Tools_Pointer,cutTool:Panopto.GlobalResources.ViewerPlus_Edit_Tools_Cut,quizTool:Panopto.GlobalResources.ViewerPlus_Edit_Tools_Quiz,focusTool:Panopto.GlobalResources.ViewerPlus_Edit_Tools_Focus,thumbnailButton:Panopto.GlobalResources.ViewerPlus_Edit_SetDefaultThumbnail,setPrimaryAsDefaultThumbnail:Panopto.GlobalResources.ViewerPlus_Edit_SetPrimaryAsDefaultThumbnail,setSecondaryAsDefaultThumbnail:Panopto.GlobalResources.ViewerPlus_Edit_SetSecondaryAsDefaultThumbnail,uploadCustomDefaultThumbnail:Panopto.GlobalResources.ViewerPlus_Edit_UploadCustomDefaultThumbnail,zoomIn:Panopto.GlobalResources.ViewerPlus_Edit_ZoomIn,zoomOut:Panopto.GlobalResources.ViewerPlus_Edit_ZoomOut,getStreamName:function(e){return j(e,void 0,!0)},presentationName:Panopto.GlobalResources.ViewerPlus_Edit_PresentationViewTitle,noThumbnailUrl:Panopto.cacheRoot+"/Styles/Less/Application/Images/Widgets/audio_only_large.png"}),l=u=Panopto.Core.UI.Components.Editor.TimelineState(i,v,V,[],E),y.push(u),Pe(),Se(),C.push(Panopto.Viewer.Tabs.Editor.EditContentsTab($("#editContentsTabHeader"),$("#editContentsTabPane"),e,h)),C.push(Panopto.Viewer.Tabs.Editor.EditTranscriptTab($("#editTranscriptTabHeader"),$("#editTranscriptTabPane"),e,h)),C.push(Panopto.Viewer.Tabs.Editor.EditSlidesTab($("#editSlidesTabHeader"),$("#editSlidesTabPane"),e,h,b)),p=Panopto.Viewer.Tabs.Editor.EditCutTab($("#editCutTabHeader"),$("#editCutTabPane"),e,h),f=Panopto.Viewer.Tabs.Editor.EditStreamTab($("#editStreamTabHeader"),$("#editStreamTabPane"),e,h),t.user.canCreateQuestionLists&&(P=Panopto.Viewer.Tabs.Editor.EditQuestionListTab($("#editQuestionListTabHeader"),$("#editQuestionListTabPane"),e,h)),m=Panopto.Viewer.Players.ThumbnailPlayer(V,e,h),Panopto.Core.UI.Handlers.button(I,te),Panopto.Core.UI.Handlers.button(R,oe),Panopto.Core.UI.Handlers.button(k,function(){k.hasClass(Panopto.Core.Constants.DisabledClass)||ce()}),Panopto.Core.UI.Handlers.button(L,function(){L.hasClass(Panopto.Core.Constants.DisabledClass)||pe()}),ne(),$(document).keydown(function(e){if(e.ctrlKey)switch(e.keyCode){case Panopto.Core.Key.Y:oe(),e.preventDefault();break;case Panopto.Core.Key.Z:te(),e.preventDefault()}}),$("#"+p.headerId()).add("#"+f.headerId()).hide(),x.show(),U.find("a").attr("href",Panopto.Viewer.Constants.SilverlightEditorUrlTemplate.format(t.id)),Panopto.Core.UI.Handlers.button(x.find("span"),function(){x.hide(),$("#"+p.headerId()).add("#"+f.headerId()).show(),U.show()}),Panopto.Core.UI.Handlers.button(M,function(){var t;M.toggleClass(Panopto.Core.Constants.ExpandedClass),t=M.hasClass(Panopto.Core.Constants.ExpandedClass),M.attr("title",t?Panopto.GlobalResources.ViewerPlus_Edit_Collapse:Panopto.GlobalResources.ViewerPlus_Edit_Expand),e.expandTimeline(t)}),B.show(),Panopto.Core.UI.Handlers.button(B,function(){var t=S.is(":visible");S.toggle(!t),m.toggle(t),B.text(t?Panopto.GlobalResources.ViewerPlus_Edit_TimelineButtonText:Panopto.GlobalResources.ViewerPlus_Edit_PreviewButtonText).attr("title",t?Panopto.GlobalResources.ViewerPlus_Edit_TimelineButtonTitle:Panopto.GlobalResources.ViewerPlus_Edit_PreviewButtonTitle).toggleClass("previewing",t),e.resize()}),$(window).on("beforeunload",function(){return w?Panopto.GlobalResources.ViewerPlus_Edit_UnsavedChanges:void 0}),Panopto.Core.UI.Handlers.button(D,function(){window.location.search=window.location.search.replace("&edit=true","")}),o(),Ee(b)},Ee=function(o){var n=function(){e.toggleMessage(Panopto.GlobalResources.ViewerPlus_UnknownError,Panopto.GlobalResources.ViewerPlus_ContactSupport,$(".support-email").attr("href"))},a=function(){i=Panopto.Core.ServiceInterface.Rest.Objects.SessionChangeSet({sessionId:t.id}),ee()},r=function(t){Panopto.Core.ServiceInterface.Rest.SessionChangeSets.updateOwner(t.id,void 0,function(t){var n=[],a=[],r=[];i=t,u=u.copy(),y[0]=u,u.cuts().length=0,_.each(i.streamsToUpdate,function(e){var t=_.find(u.streams(),function(t){return e.id===t.id});t?(t.name=e.name,t.absoluteStart=e.absoluteStart):(n.push(e),i.cutsToReplace=_.filter(i.cutsToReplace,function(t){return t.targetId!==e.id}),i.eventsToAdd=_.filter(i.eventsToAdd,function(t){return t.streamId!==e.id}),i.eventsToUpdate=_.filter(i.eventsToUpdate,function(t){return t.streamId!==e.id}),i.eventsToDelete=_.filter(i.eventsToDelete,function(t){return t.streamId!==e.id}))}),_.each(n,function(e){i.streamsToUpdate.splice(i.streamsToUpdate.indexOf(e),1)}),_.each(i.cutsToReplace,function(e){u.cuts().push(e)}),u.refreshTimeline(),_.each(i.slideDecksToDelete,function(e){var t=_.find(o,function(t){return e.id===t.id});t?u.slideDecksToDelete().push(e):a.push(e)}),_.each(a,function(e){i.slideDecksToDelete.splice(i.slideDecksToDelete.indexOf(e),1)}),_.each(i.eventsToAdd,function(e){u.events().push(e)}),_.each(i.eventsToUpdate,function(e){var t=u.events()[_.findIndex(u.events(),function(t){return e.id===t.id})];t?(t.edited=!0,t.name=e.name,t.metadata=e.metadata,t.timelineTime=e.timelineTime,t.link=e.link,t.isDefaultThumbnail=e.isDefaultThumbnail):r.push(e)}),_.each(r,function(e){i.eventsToUpdate.splice(i.eventsToUpdate.indexOf(e),1)}),r.length=0,_.each(i.eventsToDelete,function(e){var t=_.find(u.events(),function(t){return e.id===t.id});t?u.events().splice(u.events().indexOf(t),1):r.push(e)}),_.each(r,function(e){i.eventsToDelete.splice(i.eventsToDelete.indexOf(e),1)}),_.each(i.questionListRevisions,function(e){var t=_.findIndex(u.questionLists(),function(t){return e.id===t.id});t>=0?(e.edited=!0,u.questionLists()[t]=e):u.questionLists().push(e)}),_.each(i.questionListIdsToDelete,function(e){u.questionLists().splice(_.findIndex(u.questionLists(),function(t){return e===t.id}),1)}),e.toggleMessage(!1),ee()},n)};Panopto.Core.ServiceInterface.Rest.SessionChangeSets.get(t.id,function(t){var o=t.results[0];o?o.ownerId!==Panopto.user.userId?(e.toggleMessage(_.template($("#pendingEditsMessageTemplate").html(),{message:Panopto.GlobalResources.ViewerPlus_Edit_PendingChanges.format(o.ownerName,Panopto.Core.TimeHelpers.utcDateToFormattedString(Panopto.Core.TimeHelpers.toLocalPanoptoTime(o.updateDate,Panopto.timeZone),"LLL")),claim:Panopto.GlobalResources.ViewerPlus_Edit_TakeOver.format(o.ownerName),discard:Panopto.GlobalResources.ViewerPlus_Edit_Discard.format(o.ownerName)})),Panopto.Core.UI.Handlers.button($(".pending-edits-claim"),function(){r(o)}),Panopto.Core.UI.Handlers.button($(".pending-edits-discard"),function(){Panopto.Core.ServiceInterface.Rest.SessionChangeSets.deleteChangeSet(o.id,function(){e.toggleMessage(!1),a()},n)})):r(o):a()},n)},Ie=function(){var o=function(){e.toggleMessage(Panopto.GlobalResources.ViewerPlus_UnknownError,Panopto.GlobalResources.ViewerPlus_ContactSupport,$(".support-email").attr("href"))};Panopto.Core.ServiceInterface.Rest.Sessions.getOne(t.id,function(e){n=e,Panopto.Core.ServiceInterface.Rest.Sessions.getAllStreams(t.id,function(e){Panopto.Core.ServiceInterface.Rest.Sessions.getAllCuts(t.id,function(n){Panopto.Core.ServiceInterface.Rest.Sessions.getAllSlideDecks(t.id,function(i){Panopto.Core.ServiceInterface.Rest.Sessions.getAllEvents(t.id,{eventTypes:[Panopto.Core.EventType.Label,Panopto.Core.EventType.SlideChange,Panopto.Core.EventType.Caption,Panopto.Core.EventType.SpeechRecognition]},function(a){Panopto.Core.ServiceInterface.Rest.Sessions.getAllQuestionLists(t.id,function(t){Ve(e,n,i,a,t)},o)},o)},o)},o)},o)},o)};return Ie(),h.resize=F,h.synchronize=G,h.timelinePosition=q,h.pushEdit=ie,h.applyState=Z,h.openEventDialog=W,h.removeEvent=J,h.resizeCut=he,h.addQuestionList=ge,h.applyPrimaryHeuristicCuts=Pe,h.getQuestionList=we,h.updateQuestionList=Ce,h.getEvent=be,h.updateEvent=Te,h.getStreamFriendlyType=N,h.getStream=z,h.getStreamName=j,h.getStreamIconClass=Q,h.activeState=function(){return u},h.tabs=function(){var e=C.concat(p,f);return P&&(e=e.concat(P)),e},h.session=function(){return n},h};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Data.Content=function(e,t,o,n){return n=n||[],{title:e,id:t,tabClass:o,timeline:n}},Panopto.Viewer.Data.Stream=function(e,t,o){var n,i=[],a=[],r=e.Name||("SCREEN"===e.Tag?Panopto.GlobalResources.ViewerPlus_ScreenCaptureTitle:Panopto.GlobalResources.ViewerPlus_ObjectVideoTitle),s="SCREEN"===e.Tag?Panopto.Viewer.Constants.ScreenCaptureClass:Panopto.Viewer.Constants.ObjectVideoTabClass,l=function(e,o){var n=e-Panopto.Viewer.Constants.SecondaryStreamOffset;return t?e:o&&n<=o+Panopto.Viewer.Constants.MinSegmentGap?e:Math.max(0,n)};switch(e.RelativeSegments&&e.RelativeSegments.length?_.each(e.RelativeSegments,function(e,t){var o=Panopto.Viewer.Data.SecondarySegment(e),n=a[t-1];o.timelineStart=l(o.relativeStart,n?n.relativeEnd:0),a.push(o),i.push(o.timelineStart,o.relativeEnd)}):(i.push(l(e.RelativeStart)),e.RelativeEnd&&i.push(e.RelativeEnd)),n=Panopto.Viewer.Data.Content(r,e.PublicID,s,i),n.url=e.StreamUrl,n.httpUrl=e.StreamHttpUrl,n.fileType=e.ViewerMediaFileTypeName,n.relativeStart=e.RelativeStart,n.relativeEnd=e.RelativeEnd,n.length=e.RelativeEnd?e.RelativeEnd-e.RelativeStart:0,n.segments=a,n.isBroadcast=t,n.interrupted=e.Interrupted,n.editFileType=e.EditMediaFileTypeName,n.deliveryTitle=o,n.broadcastSegmentDuration=e.BroadcastSegmentDuration,e.Tag){case"AUDIO":n.type=Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio,n.isAudioOnly=!0;break;case"SCREEN":n.type=Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen,n.isAudioOnly=!1;break;default:n.type=Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera,n.isAudioOnly=!1}return n.optimizationToken=e.OptimizationToken,n},Panopto.Viewer.Data.SecondarySegment=function(e){return{relativeStart:e.RelativeStart,relativeEnd:e.End?e.RelativeStart+(e.End-e.Start):1/0,streamOffset:e.Start}},Panopto.Viewer.Data.SlideDeck=function(e){var t=_.map(e,Panopto.Viewer.Data.Slide);t[0].time=0;var o=[t[0].time],n=Panopto.Viewer.Data.Content(Panopto.GlobalResources.ViewerPlus_SlidesTitle,Panopto.Viewer.Constants.SlideDeckId,Panopto.Viewer.Constants.SlideDeckTabClass,o);return n.slides=t,n},Panopto.Viewer.Data.Slide=function(e){return{time:e.Time,queryParams:{id:e.ObjectIdentifier,number:e.ObjectSequenceNumber,x:void 0}}},Panopto.Viewer.Data.Document=function(e){var t=e.Caption||(e.FileName?decodeURIComponent(e.FileName):Panopto.GlobalResources.ViewerPlus_Website),o=e.ID||e.PublicId||e.PublicID,n=[],i=!1,a=window.location.protocol+"//",r=/^.*?:\/\//;"number"==typeof e.Time?(n.push(e.Time),n.push(e.Time+Panopto.Viewer.Constants.UrlEventDuration)):(i=!0,
n.push(0));var s=Panopto.Viewer.Data.Content(t,o,i?"pdf":Panopto.Viewer.Constants.UrlTabClass,n);s.isPdf=i,s.url=e.Url||e.URL,s.url=s.url?a+s.url.replace(r,""):s.url;var l=s.url.indexOf(Panopto.Viewer.Constants.YouTubeEmbedBaseUrl)!==-1;return s.pauseWhenAvailable=!i,s.isSessionPlaybackBlocking=e.IsSessionPlaybackBlocking,s.iconCode=i?Panopto.Core.Constants.DocumentIconCode:e.IsQuestionList?Panopto.Core.Constants.QuestionListIconCode:l?void 0:Panopto.Core.Constants.LinkIconCode,s.iconClass=l?Panopto.Viewer.Constants.YouTubeIconClass:void 0,s.hiddenTab=e.IsQuestionList,s.isQuiz=e.IsQuestionList,s},Panopto.Viewer.Data.Thumbnail=function(e,t){var o,n="PowerPoint"===e.EventTargetType;return e.ObjectStreamID!==Panopto.Core.Constants.EmptyGuid?o=e.ObjectStreamID:n&&(o=t?t.id:Panopto.Viewer.Constants.SlideDeckId),{time:e.Time,queryParams:{eventTargetPID:e.ObjectPublicIdentifier,sessionPID:e.SessionID,number:e.ObjectSequenceNumber,isPrimary:"Primary"===e.EventTargetType,absoluteTime:e.AbsoluteTime},tabId:o,isSlide:n,text:e.Caption}},Panopto.Viewer.Data.Event=function(e){e.EventTargetType=e.EventTargetType||"UserCreatedTranscript";var t="Transcript"===e.EventTargetType||"UserCreatedTranscript"===e.EventTargetType,o=t?e.Data:e.Caption,n=e.EventTargetType.replace(" ",""),i=["ObjectVideo","Primary","PowerPoint"],a=(e.UserName||"").toLowerCase();return"Questions"===n&&(n="Comments"),t?o=o||e.Caption:i.indexOf(e.EventTargetType)<0&&(o=o||e.Data),!e.ID&&e.EventID&&(e.ID=e.EventID),{id:e.ID?"event"+e.ID:e.PublicId&&e.PublicId!==Panopto.Core.Constants.EmptyGuid?"event"+e.PublicId:(e.EventTargetType+"-"+e.Time).replace(/\./gi,""),eventId:e.ID,eventPublicId:e.PublicId,sessionId:e.SessionID,time:e.Time,creationTime:e.CreationTime,text:o,user:a,userDisplayName:e.UserDisplayName||a,type:n,isQuestionList:e.IsQuestionList,saved:!0,createdDuringWebcast:"Comments"===n&&e.CreatedDuringWebcast,url:e.Url}},Panopto.Viewer.Data.Channel=function(e,t,o){return{value:e,name:t?t:e,isUser:o}};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Data.Delivery=function(e){var t,o,n,i,a=Panopto.Viewer.Data,r=[],s=e.Delivery.IsActiveBroadcast,l=Panopto.Core.TimeHelpers.formatWin32EpochTimeToDate(e.Delivery.SessionStartTime),u=e.Delivery.SessionName,d=_.sortBy(_.map(_.filter(e.Delivery.Streams,function(e){return"Archival"===e.StreamTypeName}),function(e){return a.Stream(e,s,u)}),"relativeStart"),c=d.length&&s?_.find(d,function(e){return!e.relativeEnd})||_.max(d,function(e){return e.relativeEnd}):d[0],p=_.map(_.filter(e.Delivery.Streams,function(e){return"Archival"!==e.StreamTypeName}),function(e){return a.Stream(e,s,u)}),f=!!c&&("ism"===c.fileType||"wmv"===c.fileType),P=Panopto.viewer.flowplayerEnabled&&c&&!f&&(!s||Panopto.viewer.isFlowplayerV7||Panopto.viewer.htmlPlaybackOnly)&&("hls"===c.fileType&&!new RegExp(Panopto.features.hlsFlashFallbackRegex).test(navigator.userAgent)&&_.any(flowplayer.engines,function(e){return"hlsjs"===e.engineName})||"mp4"===c.fileType&&Panopto.Core.Browser.supportsVideo(Panopto.Viewer.Constants.MP4MimeType));t=_.filter(e.Delivery.Timestamps,function(t){return(t.Time||0===t.Time)&&t.Time<=e.Delivery.Duration&&t.ObjectIdentifier&&t.ObjectSequenceNumber});var m=Panopto.Core.StringHelpers.parseQueryString(window.location.search.slice(1),void 0,!0);return o=_.filter(t,function(e){return"PowerPoint"===e.EventTargetType}),n=_.filter(t,function(e){return e.Url}),_.each(n,function(e){r.push(a.Document(e))}),_.each(e.Delivery.EventTargets,function(e){r.push(a.Document(e))}),i=_.filter(t,function(e){return!e.Url&&("ObjectVideo"===e.EventTargetType||"Primary"===e.EventTargetType)}).concat(o),i.sort(function(e,t){return e.Time-t.Time}),{title:u,id:e.Delivery.PublicID,date:l,duration:e.Delivery.Duration,description:e.Delivery.SessionAbstract,invocationId:e.InvocationId,embedUrl:e.EmbedUrl,downloadUrl:e.DownloadUrl,podcastCompleted:e.PodcastCompleted,broadcastRefreshInterval:1e3*e.BroadcastRefreshInterval,allowPublicNotes:e.AllowPublicNotes,hasCaptions:e.Delivery.HasCaptions,isBroadcast:s,isViewable:s&&c||e.Delivery.IsViewerEncodeComplete,isReadyForEditing:e.Delivery.IsReadyForEditing,requiresAdvancedEditor:e.Delivery.RequiresAdvancedEditor,broadcastEnded:e.Delivery.BroadcastEnded,broadcastInterrupted:e.Delivery.BroadcastInterrupted,isRecentBroadcast:e.Delivery.IsBroadcast&&e.Delivery.IsViewerEncodeComplete&&(new Date).getTime()-l.getTime()<=Panopto.Viewer.Constants.RecentBroadcastThreshold,isPrimaryAudioOnly:e.Delivery.IsPrimaryAudioOnly,playerInterface:f?Panopto.Viewer.Players.SilverlightPlayer:P?Panopto.viewer.flowplayerStateMachineEnabled&&void 0===m.usestatemachine||"true"===m.usestatemachine?Panopto.Viewer.Players.FlowPlayerMachine:Panopto.Viewer.Players.FlowPlayer:Panopto.Viewer.Players.VideoJsPlayer,requiresSilverlight:f,flowPlayerEnabled:P,multiBitrateEnabled:!!c&&(P||"ism"===c.fileType||"hls"===c.fileType&&Panopto.Core.Browser.flashEnabled()),playSpeedEnabled:!(!c||s)&&(P||("hls"===c.fileType||"mp4"===c.fileType)&&Panopto.Core.Browser.supportsVideo(Panopto.Viewer.Constants.MP4MimeType)||"wmv"===c.fileType&&!Panopto.Core.Browser.isWebkit),discussionEnabled:e.Delivery.DiscussionEnabled,discussionCacheSeconds:e.DiscussionCacheSeconds,activePrimary:c,primaryStreams:s?d:[c],secondaryStreams:p,slideDecks:o.length?[a.SlideDeck(o)]:[],documents:r,thumbnails:_.map(i,function(e){return a.Thumbnail(e,_.find(p,function(e){return e.tabClass===Panopto.Viewer.Constants.ScreenCaptureClass}))}),contents:_.chain(i.concat(n)).unique().map(a.Event).filter(function(e){return jQuery.trim(e.text)}).value(),channels:e.Delivery.PublicNotesStreams?_.map(e.Delivery.PublicNotesStreams,function(e){return a.Channel(e,e,!0)}):void 0,user:{name:e.UserName,key:(e.UserKey||"").toLowerCase(),rating:e.UserRating,role:e.FolderRole,canCreateQuestionLists:e.UserCanCreateQuestionLists},folder:{name:e.Delivery.SessionGroupLongName,description:e.Delivery.SessionGroupAbstract,id:e.Delivery.SessionGroupPublicID},nextDelivery:!!e.Delivery.NextDeliveryUrl&&{url:e.Delivery.NextDeliveryUrl,title:e.Delivery.NextDeliveryTitle,description:e.Delivery.NextDeliveryDescription,duration:Panopto.Core.TimeHelpers.formatDuration(e.Delivery.NextDeliveryDuration,Panopto.GlobalResources.TimeSeparator),thumbUrl:e.Delivery.NextDeliveryThumbUrl,isLive:e.Delivery.NextDeliveryIsLive},serverModel:e}};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Players.DocumentPlayer=function(e,t){var o,n,i,a,r=0,s=0,l=function(){n.show(),r=parseInt(n.css("border-left-width"),10)+parseInt(n.css("border-right-width"),10),s=parseInt(n.css("border-top-width"),10)+parseInt(n.css("border-bottom-width"),10),t.isPdf&&n.addClass("plugin-screen")},u=function(){t.url.indexOf(Panopto.Viewer.Constants.YouTubeEmbedBaseUrl)!==-1&&(a=new YT.Player(t.id+"frame",{events:{onStateChange:function(e){0===e.data&&Panopto.Viewer.Viewer.togglePlaying()}}}))};return e.append(_.template($("#documentPlayerTemplate").html(),t)),o=e.find("#"+t.id),n=o.find(".document-frame"),t.isPdf?PluginDetect.onDetectionDone(Panopto.Viewer.Constants.PluginDetectPDFReader,function(e){var i=e.isMinVersion(Panopto.Viewer.Constants.PluginDetectPDFReader,0);i<0?o.find(".adobe-reader-install").show():(l(),n.attr("src",t.url))},Panopto.Viewer.Constants.DummyPDFUrl,!0):l(),i=Panopto.Viewer.Players.PlayerBase(e,o),i.resize=function(t,n){e.width(t),e.height(n),o.width(t-r),o.height(n-s)},i.remove=function(){o.remove()},i.toggle=function(e){var i=e?t.url:"";o.toggle(e),n.attr("src")!==i&&(n.attr("src",i),e&&u())},i};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.PlayState=Panopto.Viewer.PlayState||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.MBRBitrate=Panopto.Viewer.MBRBitrate||{},Panopto.Viewer.Hive=Panopto.Viewer.Hive||{},Panopto.Viewer.Kollective=Panopto.Viewer.Kollective||{},Panopto.Viewer.Players.FlowPlayer=function(e,t){var o,n,i,a,r,s,l,u,d,c,p,f,P=Panopto.Viewer.Constants,m=Panopto.Viewer.PlayState,v=Panopto.Viewer.Analytics,h=Panopto.Viewer.MBRBitrate,g=Panopto.Viewer.Hive,y=PanoptoTS.Core.Test.ViewerEventSource,w=PanoptoTS.Core.Test.ViewerEventType,C=!e,b=!1,T=!1,S=!1,V=0,E=!1,I=1,R=!1,k=$("#"+(e?"primaryBuffering":"secondaryBuffering")),L=Panopto.Viewer.Kollective,D=PanoptoTS.Core.Test.ViewerScriptLoggerFactory.createLogger(e?"Primary":"Secondary"),x=function(){k.hide(),clearTimeout(d)},U=function(e){e&&x(),d=setTimeout(function(){k.show(),k.css({top:t.offset().top+(t.height()-k.height())/2,left:t.offset().left+(t.width()-k.width())/2})},P.MaxPositionInterpolation)},M=function(){u&&u.flushQualityReport(o.engine.hlsjs&&E,o.video.time,V,o.engine.hlsjs&&o.engine.hlsjs.levels&&o.engine.hlsjs.levels.length,o.engine.hlsjs&&o.engine.hlsjs.levels&&o.engine.hlsjs.levels.length&&o.engine.hlsjs.levels[V].bitrate,o.engine.hlsjs&&o.engine.hlsjs.autoLevelEnabled)},B=function(i,a,r){D.log(y.LogInput,w.Load,i.url);var s={sources:[{src:i.url,type:i.url.indexOf(".m3u8")!==-1?P.HLSMimeType:P.MP4MimeType}],live:i.isBroadcast,dvr:i.isBroadcast};L.isKollectiveOptimized(i.optimizationToken)&&(s={sources:[{src:i.optimizationToken,type:P.HLSMimeType}]});var l=function(){p===i.url&&(u=v.QualityReporter({streamUrl:i.url,isBroadcast:i.isBroadcast,isAudioOnly:i.isAudioOnly,minDuration:P.QualityReportThreshold}),j()),r&&r()};if(R=i.isBroadcast,f=i.broadcastSegmentDuration,o)(a||p!==i.url)&&A(s,l);else{D.log(y.LogOutput,w.Load,i.url),p=i.url,o=flowplayer(t[0],{key:Panopto.viewer.flowplayerKey,clip:s,hive:g.createFlowplayerPlugin(i)},l),n=t.find("video")[0],o.on("finish",function(){b&&(T=!0)}),o.on("hlsLevelSwitch",function(t,n,i){V!==i.level&&(V=i.level,Panopto.Viewer.Viewer.writeLineToClientLog(Panopto.Core.ViewerLogEntryType.QualityChange,[e?"Primary":"Secondary",V,o.engine.hlsjs.levels.length,o.engine.hlsjs.levels[V].bitrate]),M())}),o.on("progress",function(){E&&U(!0)});var d=function(e){e?U(!1):x()};L.tryLoadOptimizedStream(i.optimizationToken,null,function(){},function(){},d)}},A=function(e,t){p=e.sources[0].src;var n=function(){b=!1,E=!1,V=0,1!==I&&(D.log(y.LogOutput,w.Speed,1),o.speed(1)),o.one("stop",function(){D.log(y.LogOutput,w.Load,e.sources[0].src),o.load(e,t)}),D.log(y.LogOutput,w.Stop),o.stop()};T=!1,b?(M(),n()):o.one("ready",function(){p===e.sources[0].src&&n()})},H=function(e,t){var n=!R||o.video.buffer?o.video.duration:o.video.duration-3*f;c=Math.min(e,n),D.log(y.LogOutput,w.Seek,c),o.seek(c,function(){M(),t&&t()}),i=void 0,T=!1},O=function(e){var t=!1,n=function(){E?(D.log(y.LogOutput,w.Play),o.resume()):(D.log(y.LogOutput,w.Pause),o.pause()),M()};switch(e){case m.Playing:t=!E,E=!0,U(!0);break;case m.Paused:t=E,E=!1,x()}t&&(o.seeking&&o.one("seek",n),n()),a=void 0},F=function(e){I=e,D.log(y.LogOutput,w.Speed,e),o.speed(e),r=void 0},G=function(e){if(D.log(y.LogOutput,w.Bitrate,e),o.engine.hlsjs)switch(e){case h.Auto:o.engine.hlsjs.nextLevel=-1;break;case Panopto.Viewer.MBRBitrate.Medium:o.engine.hlsjs.nextLevel=Math.max(0,o.engine.hlsjs.levels.length-2);break;case Panopto.Viewer.MBRBitrate.High:o.engine.hlsjs.nextLevel=o.engine.hlsjs.levels.length-1}},z=function(t){e&&(D.log(y.LogOutput,w.Volume,t),o.volume(t/100)),l=void 0},N=function(t){var n=!e||t;D.log(y.LogOutput,w.Mute,n),o.mute(n),C=void 0},j=function(){"undefined"!=typeof i&&H(i),"undefined"!=typeof a&&O(a),"undefined"!=typeof r&&F(r),"undefined"!=typeof s&&G(s),setTimeout(function(){"undefined"!=typeof l&&z(l),"undefined"!=typeof C&&N(C)}),b=!0,_.each(n.textTracks,function(e){e.mode="hidden"}),1!==I&&F(I),o.video.width&&o.video.height?Panopto.Viewer.Viewer.resize():o.one("progress",function(){Panopto.Viewer.Viewer.resize()})};return flowplayer.conf.hlsjs||(flowplayer.conf.fullscreen=!0,flowplayer.conf.hlsjs={listeners:["hlsLevelSwitch"],startLevel:"auto",safari:!0},Panopto.Core.Browser.isFirefox&&(flowplayer.conf.hlsjs.maxBufferHole=.8)),{content:function(e,t,o){B(e,t,o)},position:function(e,t){if("undefined"==typeof e){var n=b?o.seeking?c:o.video.time:i;return isFinite(n)?n:0}D.log(y.LogInput,w.Seek,e),b?H(e,t):i=e},playState:function(e){D.log(y.LogInput,e==m.Playing?w.Play:w.Pause),b?O(e):a=e},playSpeed:function(e){D.log(y.LogInput,w.Speed,e),b?F(e):r=e},bitrate:function(e){D.log(y.LogInput,w.Bitrate,e),b?G(e):s=e},volume:function(e){D.log(y.LogInput,w.Volume,e),b?z(e):l=e},muted:function(e){D.log(y.LogInput,w.Mute,e),b?N(e):C=e},isFullscreen:function(e){return"undefined"==typeof e?S:(D.log(y.LogInput,w.FullScreen,e),void(o&&(D.log(y.LogOutput,w.FullScreen,e),e!==S&&o.fullscreen(),S=e)))},width:function(){return b?o.video.width||n.videoWidth:16},height:function(){return b?o.video.height||n.videoHeight:9},ended:function(){return T},streamLength:function(){return b?o.video.duration:0},numericBitrate:function(){return b&&o.engine.hlsjs?o.engine.hlsjs.levels[V].bitrate:0},bitrateOptions:function(){return b&&o.engine.hlsjs?_.map(o.engine.hlsjs.levels,function(e){return e.bitrate}):[]},syncPlayState:function(){},syncTimes:function(){},setCaptionText:function(){},setCaptionStyles:function(){},showShadow:function(){},optimizationProvider:function(){}}};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.PlayState=Panopto.Viewer.PlayState||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.MBRBitrate=Panopto.Viewer.MBRBitrate||{},Panopto.Viewer.Hive=Panopto.Viewer.Hive||{},Panopto.Viewer.Kollective=Panopto.Viewer.Kollective||{},Panopto.Viewer.Players.FlowPlayerMachine=function(e,t){var o,n,i,a,r,s,l,u,d=Panopto.Viewer.Constants,c=Panopto.Viewer.PlayState,p=Panopto.Viewer.Analytics,f=(Panopto.Viewer.MBRBitrate,Panopto.Viewer.Hive),P=e?"Primary":"Secondary",m=!1,v=!1,h=0,g=0,y=!1,w=function(e){return{name:e,data:[],expectedEndState:void 0}},C=w("Main"),b=w("Ready"),T=$("#"+(e?"primaryBuffering":"secondaryBuffering")),S=Panopto.Viewer.Kollective,V=function(e,t){var o=!0;if(!t.completeCallback){var n;e.data.length?n=e.data[e.data.length-1]:e===C&&(n=s),n&&n.trigger===t.trigger&&n.data===t.data&&(o=!1)}return o},E=function(e){var t=_.reduce(e.data,function(e,t,o){return e+"["+o+"] "+t.trigger.name+" "},"");window.console&&console.log("[{0}] {1} {2}: {3}".format(P,"Queue",e.name,t))},I=function(e,t){return _.find(e.transitions,function(e){return e.trigger===t.trigger})},R=function(e,t){var o,n=I(e,t);return n?(o=n.toState,o?o.triggerOnEnter&&(o=R(o,L(o.triggerOnEnter))):o=e):_.contains(e.ignoreTriggers,t.trigger)&&(o=e),o},k=function(e,t){V(e,t)&&(e===C&&(e.expectedEndState||(e.expectedEndState=R(r,s)),t.expectedStartState=e.expectedEndState,e.expectedEndState=R(e.expectedEndState,t)),e.data.push(t),D(t,e===C?"Queued":"Delay queued"),E(e))},L=function(e,t,o){return{trigger:e,data:t,completeCallback:o}},D=function(e,t){var o=new Date,n="[{0}] {1}:{2}.{3} {4} trigger {5} from state {6}{7}{8}".format(P,o.getMinutes(),o.getSeconds(),o.getMilliseconds(),t,e.trigger.name,r.name,"undefined"!=typeof e.data?" with data "+e.data:"",e.expectedStartState?" expectedState "+e.expectedStartState.name:"");window.console&&console.log(n)},x=function(e,t,o){var n=L(e,t,o);null!=s||C.length?k(C,n):U(n)},U=function(e){var t=I(r,e);if(t)if(t.delayToQueue)k(t.delayToQueue,e);else{if(s=e,l=t,s.expectedStartState!==r&&C.data.length){s.expectedStartState=r;var n=!1,i=r;_.each(C.data,function(e){n||e.expectedStartState===i?n=!0:(e.expectedStartState=i,i=R(i,e))}),n||(C.expectedEndState=i)}D(e,"Running");var a="exit",u=function(){o.off("."+a),e.completeCallback&&e.completeCallback(),B(l,e.data)};l.exitEvent&&o.one(l.exitEvent.name+"."+a,u),t.action?t.action(e.data,u):u()}else _.contains(r.ignoreTriggers,e.trigger)||D(e,"No transition for"),B()},M=function(e){_.any(r.transitions,function(e){return e.triggerEvent})&&o.off("."+r.name),r=e,_.each(r.transitions,function(e){e.triggerEvent&&o.on(e.triggerEvent.name+"."+r.name,function(){x(e.trigger)})})},B=function(e,t){if(e&&e!==l)window.console&&console.log("Transition ended which is not the current transition");else{s=void 0,l=void 0;var o;e&&e.toState&&(M(e.toState),e.toState.triggerOnEnter&&(o=L(e.toState.triggerOnEnter,t))),!o&&C.data.length&&(o=C.data[0],C.data=C.data.slice(1),C.expectedEndState=void 0),o&&U(o)}},A={ready:{name:"ready"},resumed:{name:"resume"},paused:{name:"pause"},stopped:{name:"stop"},finish:{name:"finish"},seek:{name:"seek"},qualityChange:{name:"quality"},speedChange:{name:"speed"},volumeChange:{name:"volume"},muteChange:{name:"mute"}},H={load:{name:"load"},ready:{name:"ready"},play:{name:"play"},pause:{name:"pause"},stop:{name:"stop"},finish:{name:"finish"},updatePosition:{name:"updatePosition"},updateBitrate:{name:"updateBitrate"},updateSpeed:{name:"updateSpeed"},updateVolume:{name:"updateVolume"},updateMuted:{name:"updateMuted"}},O={uninitialized:{name:"uninitialized"},loaded:{name:"loaded",triggerOnEnter:H.ready},playing:{name:"playing"},paused:{name:"paused"},finished:{name:"finished"},stopped:{name:"stopped",triggerOnEnter:H.load}},F={play:{trigger:H.play,toState:O.playing,action:function(e,t){o.playing?t():o.play()},exitEvent:A.resumed},pause:{trigger:H.pause,toState:O.paused,action:function(e,t){o.playing?o.pause():t()},exitEvent:A.paused},ready:{trigger:H.ready,action:function(e,t){i=p.QualityReporter({streamUrl:e.content.url,isBroadcast:e.content.isBroadcast,isAudioOnly:e.content.isAudioOnly,minDuration:d.QualityReportThreshold}),m=!0,C.data=b.data.concat(C.data),b.data.length=0,b.expectedEndState=void 0,e.onLoad&&e.onLoad(),_.each(n.textTracks,function(e){e.mode="hidden"}),o.video.width&&o.video.height?Panopto.Viewer.Viewer.resize():o.one("progress",function(){Panopto.Viewer.Viewer.resize()}),t()}},finish:{trigger:H.finish,triggerEvent:A.finish,toState:O.finished},initialLoad:{trigger:H.load,toState:O.loaded,action:function(i,r){o=flowplayer(t[0],{key:Panopto.viewer.flowplayerKey,clip:i.clip,hive:f.createFlowplayerPlugin(i.content)},r),n=t.find("video")[0],o.on("hlsLevelSwitch",function(t,n,i){h!==i.level&&(h=i.level,Panopto.Viewer.Viewer.writeLineToClientLog(Panopto.Core.ViewerLogEntryType.QualityChange,[e?"Primary":"Secondary",h,o.engine.hlsjs.levels.length,o.engine.hlsjs.levels[h].bitrate]),z())}),setInterval(G,d.MaxPositionInterpolation),y=i.content.isBroadcast,a=i.content.broadcastSegmentDuration}},load:{trigger:H.load,toState:O.loaded,action:function(e,t){e.clip.sources[0].src!==o.video.sources[0].src?o.load(e.clip):t()},exitEvent:A.ready},inactiveSet:[{trigger:H.play,delayToQueue:b},{trigger:H.pause,delayToQueue:b},{trigger:H.updatePosition,delayToQueue:b},{trigger:H.updateBitrate,delayToQueue:b},{trigger:H.updateSpeed,delayToQueue:b},{trigger:H.updateVolume,delayToQueue:b},{trigger:H.updateMuted,delayToQueue:b}],activeSet:[{trigger:H.updatePosition,action:function(e,t){o.video.time!==e?o.seek(e):t()},exitEvent:A.seek},{trigger:H.updateBitrate,action:function(e,t){o.engine.hlsjs.quality!==e?o.quality(e):t()},exitEvent:A.qualityChange},{trigger:H.updateSpeed,action:function(e,t){o.currentSpeed!==e?o.speed(e):t()},exitEvent:A.speedChange},{trigger:H.updateVolume,action:function(e,t){o.volumeLevel!=e?o.volume(e):t()},exitEvent:A.volumeChange},{trigger:H.updateMuted,action:function(e,t){o.muted!==e?o.mute(e):t()},exitEvent:A.muteChange},{trigger:H.load,action:function(){z(),o.stop()},exitEvent:A.stopped,toState:O.stopped}]};O.uninitialized.transitions=F.inactiveSet.slice(),O.uninitialized.transitions.push(F.initialLoad),O.loaded.transitions=F.activeSet.slice(),O.loaded.transitions.push(F.ready),O.loaded.transitions.push(F.play),O.loaded.transitions.push(F.pause),O.playing.transitions=F.activeSet.slice(),O.playing.transitions.push(F.pause),O.playing.transitions.push(F.finish),O.playing.ignoreTriggers=[H.play],O.paused.transitions=F.activeSet.slice(),O.paused.transitions.push(F.play),O.paused.ignoreTriggers=[H.pause],O.stopped.transitions=F.inactiveSet.slice(),O.stopped.transitions.push(F.load),O.finished.transitions=F.activeSet.slice(),O.finished.transitions.push(F.play),O.finished.transitions.push(F.pause),O.finished.transitions.push(F.load),r=O.uninitialized;var G=function(){r!==O.paused?o&&o.video&&u!==o.video.time?(T.hide(),u=o.video.time):(T.show(),T.css({top:t.offset().top+(t.height()-T.height())/2,left:t.offset().left+(t.width()-T.width())/2})):(u=void 0,T.hide())},z=function(){i&&i.flushQualityReport(o.engine.hlsjs&&o.playing,o.video.time,h,o.engine.hlsjs&&o.engine.hlsjs.levels&&o.engine.hlsjs.levels.length,o.engine.hlsjs&&o.engine.hlsjs.levels&&o.engine.hlsjs.levels.length&&o.engine.hlsjs.levels[h].bitrate,o.engine.hlsjs&&o.engine.hlsjs.autoLevelEnabled)},N=function(e,t,o){var n={content:e,clip:{sources:[{src:e.url,type:e.url.indexOf(".m3u8")!==-1?d.HLSMimeType:d.MP4MimeType}],live:e.isBroadcast,dvr:e.isBroadcast},onLoad:o};if(r==O.uninitialized&&S.isKollectiveOptimized(e.optimizationToken)){var i=n;n={content:i.content,clip:{sources:[{src:e.optimizationToken,type:d.HLSMimeType}]},onLoad:i.onLoad},S.tryLoadOptimizedStream(e.optimizationToken,null,function(){x(H.load,n)},function(){x(H.load,i)},function(e){e?setBufferingTimeout(!1):clearBufferingTimeout()})}x(H.load,n)};return flowplayer.conf.hlsjs||(flowplayer.conf.hlsjs={listeners:["hlsLevelSwitch"],startLevel:"auto"},Panopto.Core.Browser.isFirefox&&(flowplayer.conf.hlsjs.maxBufferHole=.8)),{content:function(e,t,o){N(e,t,o)},position:function(e,t){if("undefined"==typeof e){var n=r===O.playing||r===O.paused?o.video.time:g;return isFinite(n)?n:0}var i=!y||o.video.buffer?o.video.duration:o.video.duration-3*a;g=i&&!isNaN(i)?Math.min(e,i):e,x(H.updatePosition,g,t)},playState:function(e){x(e==c.Playing?H.play:H.pause)},playSpeed:function(e){x(H.updateSpeed,e)},bitrate:function(e){x(H.updateBitrate,e)},volume:function(e){x(H.updateVolume,e/100)},muted:function(e){x(H.updateMuted,e)},isFullscreen:function(e){return"undefined"==typeof e?v:void(o&&(e!==v&&o.fullscreen(),v=e))},width:function(){return m?o.video.width||n.videoWidth:16},height:function(){return m?o.video.height||n.videoHeight:9},ended:function(){return r===O.finished},streamLength:function(){return m?o.video.duration:0},numericBitrate:function(){return m&&o.engine.hlsjs?o.engine.hlsjs.levels[h].bitrate:0},bitrateOptions:function(){return m&&o.engine.hlsjs?_.map(o.engine.hlsjs.levels,function(e){return e.bitrate}):[]},syncPlayState:function(){},syncTimes:function(){},setCaptionText:function(){},setCaptionStyles:function(){},showShadow:function(){},optimizationProvider:function(){}}};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Players.PlayerBase=function(e,t){var o=Panopto.Viewer.Constants;return{toggle:function(e){t.toggle(e)},resize:function(n,i,a){n=n-parseInt(e.css("border-left-width"),10)||n,i=i-parseInt(e.css("border-bottom-width"),10)||i,a="undefined"!=typeof a?a:t.width()/t.height();var r=n/i;isNaN(a)?Panopto.Core.Browser.isMac&&Panopto.Core.Browser.isFirefox?(t.height(1),e.height(1),e.width(0)):(t.height(o.AudioOnlyMinimumWidth),t.width(o.AudioOnlyMinimumWidth),e.height(o.AudioOnlyMinimumWidth),e.width(o.AudioOnlyMinimumWidth),e.css({position:"absolute",left:"-{0}px".format(o.AudioOnlyMinimumWidth)})):(e.css({position:"",left:""}),r<=a?(t.width(n),t.height(n/a),t.css({"margin-top":-n/a/2+"px","margin-left":-n/2+"px"})):(t.height(i),t.width(i*a),t.css({"margin-top":-i/2+"px","margin-left":-i*a/2+"px"})),e.width(n),e.height(i))},content:function(e){},playState:function(e){},position:function(e){},bitrate:function(e){},playSpeed:function(e){},numericBitrate:function(){return 0},hasMBR:function(){return!1},bitrateLevelOffset:function(){return 0},remove:function(){}}};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Players.PrimaryPlayer=function(e,t,o){var n,i,a,r,s,l,u,d,c,p=Panopto.Viewer.Players.StreamPlayer(e,t,o,!0),f=Panopto.Core.Extensions.base(p),P=0,m=!0,v=function(e,t,o){var n=Panopto.Core.StringHelpers.parseQueryString(e.url.slice(e.url.indexOf("?")+1));i=e,c||(c=Panopto.Core.Analytics.PlaybackLogger(p,n.InvocationID),c.start()),f.content(i,t,function(){i.isBroadcast&&l&&l(),o&&o()})},h=function(e){return _.find(n,function(t){return e<t.relativeEnd||!t.relativeEnd})||_.max(n,function(e){return e.relativeEnd})};return p.content=function(e,t,o,a){var r;n=e,i&&(i=_.find(e,function(e){return e.id===i.id})),!i&&t.isBroadcast&&f.position(1/0),i&&!o||v(i||t,o,r||a)},p.position=function(e,t){var o,n,a,r=function(){l&&l()};return"undefined"==typeof e?(o=f.position(),n=i.relativeEnd,a=h(n),n&&o>=n&&a.id!==i.id&&(v(a),f.position(n-a.relativeStart),p.playState(Panopto.Viewer.PlayState.Playing,!0)),o+i.relativeStart):(a=h(e),a.id!==i.id&&v(a),i.isBroadcast&&!m&&e!==s&&e!==1/0&&e>=P-Panopto.Viewer.Constants.LivePositionTolerance?p.isLive(!0,t):(e-=i.relativeStart,f.position(e,function(){r(),t&&t()}),r()),void 0)},p.isLive=function(e,t){return"undefined"==typeof e?m:void(e&&!m?(r&&window.clearInterval(r),p.position(s||1/0,t),p.playState(Panopto.Viewer.PlayState.Playing),m=!0):!e&&m&&(P=s||p.position(),r=window.setInterval(function(){s&&P>=s?window.clearInterval(r):P+=Panopto.Viewer.Constants.TimedSyncRate/1e3},Panopto.Viewer.Constants.TimedSyncRate),m=!1))},p.updateMaxPosition=function(e){e||m||(m=!0,p.isLive(!1)),s=e,s&&P>s&&(P=s)},p.streamLength=function(){return i.isBroadcast?m?p.position():P:f.streamLength()},p.ended=function(){var e=h(i.relativeEnd),t=f.ended();return t&&e.id!==i.id?(t=!1,p.position(i.relativeEnd),p.playState(Panopto.Viewer.PlayState.Playing)):s&&p.position()>=s&&(t=!0),t&&i.isBroadcast&&(m=!0),t&&d&&d(void 0,Panopto.Viewer.PlayState.Stopped),t},p.activePrimary=function(){return i},p.onSeek=function(e){l=e},p.offSeek=function(){l=void 0},p.onSpeedChange=function(e){u=e},p.offSpeedChange=function(){u=void 0},p.onPlayStateChangeLog=function(e){d=e},p.offPlayStateChangeLog=function(){d=void 0},p.playSpeed=function(e){var t=f.playSpeed();return void 0===e?t:(f.playSpeed(e),void(e!==t&&u&&u()))},p.playState=function(e,t){f.playState(e),t&&e!==a&&d&&d(a,e),a=e},p.streamId=function(){return i.id},p};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Players.PrimarySegmentPlayer=function(e,t,o,n,i){var a,r,s,l,u,d,c,p=Panopto.Viewer.Players.StreamPlayer(e,t,o,!0),f=Panopto.Core.Extensions.base(p),P=!1,m=$("#primaryTabHeaders"),v=[],h=function(e){var t;return c&&(t=_.find(e.element.streams(),function(e){return e.stream.id===c})),t=t||_.find(e.element.streams(),function(e){return e.stream.isPrimary})},g=function(e,t){var o,n,i=_.find(a,function(t){return t.start<=e&&t.end>e});t&&i&&i.start<l.start&&(i=l),i&&i!==l&&(o=h(i),o?(n=o.stream.url!==u.stream.url,u=o,l=i,_.each(v,function(t){t.available(e)}),n&&(y(_.find(v,function(e){return e.id()===u.stream.id})),f.content(u.stream),p.position(e),f.playState(d))):(i=_.find(r,function(t){return t.start>e}),i?p.position(i.start):P=!0))},y=function(e){e&&(_.each(v,function(t){t!==e&&t.selected(!1)}),e.selected(!0),c=e.id())};return p.content=function(e,t,o,n){f.content(t)},p.setSegments=function(e,t,o,P){var w=[],C=a?p.position():0,b="primary";a=e,r=t,s=o,l?g(C):(l=r[0],u=h(l),f.content(u.stream)),P&&(w=_.chain(r).map(function(e){return e.element.streams()}).flatten().map(function(e){return e.stream}).filter(function(e){return e.isPrimary}).map(function(e){return e.id}).uniq().value()),m.empty(),v.length=0,w.length<2?c=void 0:(_.each(w,function(e){var t,o=[],a=!1;_.each(r,function(n){t=n.element.getStreamById(e),t?a||(o.push(n.start),a=!0):a&&(o.push(n.start),a=!1)}),m.append(_.template($("#playerTabHeaderTemplate").html(),{content:{id:e,title:i.getStreamName(void 0,e),tabClass:i.getStreamIconClass(void 0,e)},type:b,tabindex:0})),v.push(Panopto.Viewer.Tabs.PlayerTabHeader(m.find("#"+b+e),e,o,!0,t&&t.stream?n.getStreamIconCode(t.stream):Panopto.Core.Constants.ObjectVideoIconCode))}),Panopto.Core.UI.Handlers.button(m.find("."+Panopto.Viewer.Constants.PrimaryTabHeaderClass),function(e){var t=_.find(v,function(t){return t.owns(e)}),o=p.position();t&&("number"==typeof t.seekTime()&&(o=t.seekTime(),n.position(o)),y(t),u=h(l),f.content(u.stream),p.position(o),f.playState(d))}),_.each(v,function(e){e.available(C)}),y(c?_.find(v,function(e){return e.id()===c}):_.find(v,function(e){return e.id()===u.stream.id})))},p.activePrimary=function(){return u?u.stream:void 0},p.playState=function(e){d=e,f.playState(e)},p.position=function(e){return l?"undefined"==typeof e?(e=f.position()+l.start-u.offset/Panopto.Core.Constants.TimelineChunkMultiplier,g(e,!0),e):(P=!1,g(e),f.position(e-l.start+u.offset/Panopto.Core.Constants.TimelineChunkMultiplier),void 0):f.position(e)},p.streamLength=function(){return r?s:f.streamLength()},p.ended=function(e){var t=f.ended();return t&&l!==_.last(r)?(t=!1,p.position(l.end)):e===s&&(P=!0),P||f.ended()},p};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Players.SecondaryStreamPlayer=function(e,t){var o,n,i,a,r,s=Panopto.Viewer.Constants,l=!1;return e.append(_.template($("#streamPlayerTemplate").html())),i=e.find("#secondaryScreen"),o=Panopto.Viewer.Players.StreamPlayer(e,i,t,!1),n=Panopto.Core.Extensions.base(o),o.content=function(e,t,o){return"undefined"==typeof e?a:(a=e,void n.content(e,t,o))},o.position=function(e,t,i){var l,u,d,c=t,p=function(t){return e-t.relativeStart+t.streamOffset};return a.segments&&a.segments.length?(d=_.find(a.segments,function(t){return e>=t.timelineStart&&e<t.relativeEnd}),d=d||(e<a.segments[0].timelineStart?a.segments[0]:a.segments[a.segments.length-1]),l=p(d),t||d===r||(c=l-p(r)>s.ContiguousSegmentThreshold,i=c),r=d):l=e-a.relativeStart,c?(u=l+(i?s.SecondaryStreamOffset:0),void n.position(a.length?Math.clamp(u,0,a.length):Math.max(0,u))):o.ended(l)?0:l-n.position()},o.toggle=function(e){l=e,i.toggleClass("hidden-screen",!e)},o.minimizeIfHidden=function(){l||o.isFullscreen(!1)},o.ended=function(e){var t=o.streamLength();return n.ended()||!(!t||a.isBroadcast)&&e>=t-s.EndPositionThreshold},o};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.PlayState=Panopto.Viewer.PlayState||{},Panopto.Viewer.Players.SilverlightPlayer=function(e,t){var o,n,i,a,r,s,l=Panopto.Viewer.Constants,u=Panopto.Viewer.PlayState,d=0,c=function(e){o.Position=e,d=void 0},p=function(e){switch(e){case u.Playing:o.Play();break;case u.Paused:o.Pause()}n=void 0},f=function(e){o.Bitrate=e},P=function(e){o.PlaySpeed=e,i=void 0},m=function(e){o.Volume=e,r=void 0},v=function(e){o.IsMuted=e,s=void 0};return Silverlight.Silverlight(),{content:function(u){try{o.ContentUrl=u.url}catch(h){Silverlight.createObjectEx({source:Panopto.viewer.xapLocation,parentElement:t[0],id:"silverlightPlayer"+(e?"Primary":"Secondary"),properties:{width:"100%",height:"100%",version:l.SilverlightVersion},alt:"",events:{onLoad:function(e){o=e.getHost().content.SilverlightPlayer,o.ContentUrl=u.url,u.httpUrl&&(o.HttpUrl=u.httpUrl),d&&c(d),n&&p(n),i&&P(i),"undefined"!=typeof r&&m(r),s&&v(s),f(a)}},initParams:Panopto.Core.StringHelpers.serializeObjectToInitParams({isPrimary:e,wmodBase:Panopto.viewer.wmodBase,fullScreenControlInterval:l.FullScreenControlInterval,
serviceScheme:Panopto.uriScheme,authCookieTimeout:Panopto.authCookieTimeoutMinutes,accentColor:Panopto.Core.UI.Color.parse(Panopto.branding.accentColor).toHex(),safetyAccent:Panopto.Core.UI.Color.parse(Panopto.branding.accentColor).getSafety().toHex(),exitFullScreenText:Panopto.GlobalResources.ViewerPlus_ExitFullScreen})})}},playState:function(e){try{p(e)}catch(t){n=e}},position:function(e){if("undefined"!=typeof e)try{c(e)}catch(t){d=e}else try{return o.Position}catch(e){return d}},ended:function(){try{return o.IsEnded}catch(e){return!1}},bitrate:function(e){try{f(e)}catch(t){a=e}},numericBitrate:function(){try{return o.NumericBitrate}catch(e){return 0}},bitrateOptions:function(){try{return o.BitrateOptions}catch(e){return[]}},playSpeed:function(e){try{P(e)}catch(t){i=e}},volume:function(e){try{m(e)}catch(t){r=e}},muted:function(e){try{v(e)}catch(t){s=e}},width:function(){return o.ContentWidth},height:function(){return o.ContentHeight},showShadow:function(e){try{o.ShowShadow=e}catch(e){}},streamLength:function(){try{return o.StreamLength}catch(e){return 0}},seekToLive:function(){try{o.SeekToLive()}catch(e){}},syncPlayState:function(e){try{o.SyncPlayState(e===u.Playing)}catch(e){}},syncTimes:function(e,t){try{o.SyncTimes(e,t)}catch(e){}},isFullscreen:function(e){if("undefined"!=typeof e)if(e);else try{o.Minimize()}catch(e){}else try{return o.IsFullscreen}catch(e){return!1}},setCaptionText:function(){},setCaptionStyles:function(){},optimizationProvider:function(){}}};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Players.SlidePlayer=function(e,t,o){var n,i,a,r,s,l=Panopto.Viewer.Constants,u=1,d=function(e){var r,s=_.last(_.filter(t.slides,function(t){return t.time<=e}));s=s||t.slides[0],s&&s!==a&&(r=s.url||"{0}?{1}".format(l.SlideImageUrl,Panopto.Core.StringHelpers.serializeObjectToQueryString(s.queryParams)),Panopto.Core.ImageHelpers.bufferAndReplaceImageUrl(n,i,r,function(e){u=e.width/e.height||0}),n.unbind("load").on("load",function(){o.resize()}),a=s)};return e.append(_.template($("#slidePlayerTemplate").html(),{id:t.id})),n=e.find("#"+t.id+"-image"),i=e.find("#"+t.id+"-buffer"),r=Panopto.Viewer.Players.PlayerBase(e,n),s=Panopto.Core.Extensions.base(r),r.resize=function(e,t){s.resize(e,t,u)},r.position=function(e){d(e)},r.remove=function(){n.remove(),i.remove()},r};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.PlayState=Panopto.Viewer.PlayState||{},Panopto.Viewer.Players.StreamPlayer=function(e,t,o,n){var i,a,r,s,l=Panopto.Viewer.Constants,u=Panopto.Viewer.PlayState,d=Panopto.Viewer.PlaySpeed,c=Panopto.Viewer.Players.PlayerBase(e,t),p=Panopto.Core.Extensions.base(c),f=Panopto.Viewer.Constants.InitialVolume,P=!1,m=n?"Primary":"Secondary",v=0,h=d.Normal;return i=o(n,t),c.resize=function(o,n){var a;try{a=i.width()/i.height()}catch(e){}p.resize(o,n,a),i.showShadow(e.height()===t.height())},c.content=function(e,t,o){i.content(e,t,o)},c.playState=function(e){i.playState(e),s!==e&&(v=i.position(),Panopto.Viewer.Viewer.writeLineToClientLog(Panopto.Core.ViewerLogEntryType.PlayStateChange,[m,e])),s=e},c.position=function(e,t){if("undefined"==typeof e){var e=Math.max(i.position()||0,0);return a&&e===a&&e!==v&&s===u.Playing?e+=Math.min(h*((new Date).getTime()-r),l.MaxPositionInterpolation)/1e3:(a=e,r=(new Date).getTime()),e}i.position(e,t),v=e,Panopto.Viewer.Viewer.writeLineToClientLog(Panopto.Core.ViewerLogEntryType.PositionSet,[m,e])},c.bitrate=function(e){i.bitrate(e)},c.numericBitrate=function(){return i.numericBitrate()},c.hasMBR=function(){return i.bitrateOptions().length>1},c.bitrateLevelOffset=function(){var e=i.bitrateOptions();return e.indexOf(i.numericBitrate())+1-e.length},c.playSpeed=function(e){return void 0===e?h:(i.playSpeed(e),h!==e&&Panopto.Viewer.Viewer.writeLineToClientLog(Panopto.Core.ViewerLogEntryType.PlaybackSpeedChange,[m,e]),h=e,void 0)},c.syncPlayState=function(e){i.syncPlayState(e)},c.syncTimes=function(e,t){i.syncTimes(e,t)},c.setCaptionText=function(e){i.setCaptionText(e)},c.setCaptionStyles=function(e){i.setCaptionStyles(e)},c.volume=function(e){return"undefined"==typeof e?P?0:f:void(0!==e?(i.volume(e),f=e,c.muted(!1)):c.muted(!0))},c.muted=function(e){return"undefined"==typeof e?P:(i.muted(e),void(P=e))},c.width=function(){try{return i.width()}catch(e){return t.width()}},c.height=function(){try{return i.height()}catch(e){return t.height()}},c.streamLength=function(){return i.streamLength()},c.ended=function(){return i.ended()},c.isFullscreen=function(e){return i.isFullscreen(e)},c.optimizationProvider=function(){return i.optimizationProvider()},c};var Panopto=Panopto||{};Panopto.UI=Panopto.UI||{},Panopto.UI.Components=Panopto.UI.Components||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Players.ThumbnailPlayer=function(e,t,o){var n=(Panopto.Viewer.Constants,Panopto.Viewer.Analytics),i=Panopto.Viewer.Players.PlayerBase(a),a=$("#thumbnailList"),r=$("#toggleThumbnailsButton"),s=Panopto.Viewer.Controls.ThumbnailStrip(a,e,t,o),l=!1,u=function(e){e="undefined"==typeof e?!a.is(":visible"):e,e?(r.text(Panopto.GlobalResources.ViewerPlus_HideThumbnails),a.slideDown({step:function(){t.resize&&t.resize()},complete:function(){l=!1,i.position(t.position(),!0)}}),r.attr(Panopto.Core.Constants.AriaExpandedAttribute,(!0).toString()),n.sendEvent({action:n.Actions.ShowThumbnails,label:n.Labels.Normal})):(l=!0,r.text(Panopto.GlobalResources.ViewerPlus_ShowThumbnails),r.attr(Panopto.Core.Constants.AriaExpandedAttribute,(!1).toString()),a.slideUp({step:function(){t.resize&&t.resize()}}),n.sendEvent({action:n.Actions.HideThumbnails,label:n.Labels.Normal}))},d=function(){s.render()};return Panopto.Core.UI.Handlers.button(r,function(){u()}),r.add(a).toggle(e.length>0&&!o),d(),i.toggle=function(e){s.toggle(e)},i.resize=function(e,t){},i.position=function(e,t){l||s.position(e,t)},i.thumbnails=function(e){return e?void s.thumbnails(o?_.filter(e,function(e){return!e.isDefaultThumbnail&&(e.type===Panopto.Core.EventType.Label||e.type===Panopto.Core.EventType.SlideChange)}):e):s.thumbnails()},i};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Players=Panopto.Viewer.Players||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.PlayState=Panopto.Viewer.PlayState||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Kollective=Panopto.Viewer.Kollective||{},Panopto.Viewer.Players.VideoJsPlayer=function(e,t){var o,n,i,a,r,s,l,u,d,c,p,f,P=Panopto.Viewer.Constants,m=Panopto.Viewer.PlayState,v=Panopto.Viewer.Analytics,h=Panopto.Viewer.Viewer,g=t.find(".video-js")[0].id,y=0,w=1,C=!e,b=!1,T=!1,S=!1,V=!1,E=!1,I=Panopto.Core.Browser.isSafari?"loadeddata":"loadedmetadata",R=16,k=9,L=[],D=Panopto.Viewer.Kollective,x=Panopto.Core.StringHelpers.parseQueryString(window.location.search.slice(1),!0,!0),U="disabled"!==x.p2poptimization,M=$("#"+(e?"primaryBuffering":"secondaryBuffering")),B=function(e){return e?"loadedmetadata":I},A=function(e){p&&p.flushQualityReport("Flash"===o.techName&&e,o.currentTime(),"Flash"===o.techName&&o.level(),"Flash"===o.techName&&o.numberOfLevels(),"Flash"===o.techName&&L[o.level()],"Flash"===o.techName&&o.autoLevelEnabled())},H=function(e){o.one("timeupdate",function(){A(a===m.Playing)}),o.currentTime(e),b?(b=!1,y=e):"undefined"!=typeof y&&(y=e)},O=function(e){switch(e){case m.Playing:o.play(),r&&z(r),A(!0);break;case m.Paused:o.pause(),A(!1)}i=void 0,a=e},F=function(e){var t=0,n=o.currentTime();if(L.length){switch(e){case Panopto.Viewer.MBRBitrate.Auto:t=-1;break;case Panopto.Viewer.MBRBitrate.Medium:t=Math.max(0,o.numberOfLevels()-2);break;case Panopto.Viewer.MBRBitrate.High:t=o.numberOfLevels()-1}1===o.numberOfLevels()&&(t=-1),o.level(t),o.currentTime(n),A(a===m.Playing)}},G=function(){return!("Flash"===o.techName&&o.currentSrc().indexOf(".m3u8")!==-1)},z=function(e){var t,i=o.volume(),r=o.muted();w=G()?o.playbackRate():1,1===w&&1!==e?"Flash"===o.techName&&(t=[u[1]],o.options({techOrder:["html5","flash"]}),S=!0,A(!1)):1===e&&S&&(t=u,o.options({techOrder:["flash","html5"]}),S=!1,o.one("loadedmetadata",function(){s&&F(s)})),t?(n=o.currentTime(),o.src(t).one(B(!S),function(){a===m.Playing?o.play():y=n,o.currentTime(n),n=void 0,o.volume(i),o.muted(r)}).one("loadeddata",function(){G()&&o.playbackRate(e)})):G()&&o.playbackRate(e)},N=function(t){e&&o.volume(t/Panopto.Viewer.Constants.MaxVolume),l=void 0},j=function(t){(e||t)&&o.muted(t),C=void 0},Q=function(e,t){var o=function(e){var o=new RegExp("RESOLUTION=(\\d*)x(\\d*)","i"),n=new RegExp("BANDWIDTH=(\\d*)","i"),i=o.exec(e);i&&3===i.length?(R=parseFloat(i[1]),k=parseFloat(i[2])):(R=0,k=0),L.length=0;do i=n.exec(e),i&&(L.push(parseFloat(i[1])),e=e.slice(i.index+i[0].length));while(i);L.sort(function(e,t){return e-t}),t&&t(),h.resize()};if(!window.XDomainRequest||window.location.protocol===Panopto.Core.UrlHelpers.getProtocol(e.url)&&window.location.hostname===Panopto.Core.UrlHelpers.getHost(e.url))$.ajax({url:e.url,success:o});else{var n=new XDomainRequest;n.open("get",e.url),n.onload=function(){o(n.responseText)},n.onerror=function(){},n.onprogress=function(){},n.ontimeout=function(){},n.send()}},K=function(){V=!0,o.play(),"number"==typeof y&&(H(y),y=void 0),o.pause(),i&&O(i),"undefined"!=typeof l&&N(l),C&&j(C),s&&F(s)},q=function(){var e=_.find(Panopto.Captions.ColorOptions,function(e){return e.key===d.colorSchemeKey}),t="transparent"!==e.backgroundColor;o.setCaptionOptions(e.color,t?e.backgroundColor:"#000000",d.textSize,e.overlayOpacity,t,"none"!==e.textShadow)},W=function(){"Flash"===o.techName&&(o.brandingColors(Panopto.Core.UI.Color.parse(Panopto.branding.accentColor).toHex(),Panopto.Core.UI.Color.parse(Panopto.branding.accentColor).getSafety().toHex()),o.localizedStrings(Panopto.GlobalResources.ViewerPlus_ExitFullScreen),d&&q())},J=function(t,n){o.off("loadeddata"),o.off("loadedmetadata"),o.one(B("Flash"===o.techName),K),t?(o.options({techOrder:["html5"]}),o.one("loadedmetadata",function(){var e=$("#"+g).find("video")[0];R=e.videoWidth,k=e.videoHeight,L=[],h.resize()})):o.on("loadedmetadata",W),n&&o.one("loadeddata",n),(Panopto.Core.Browser.isIE||Panopto.Core.Browser.isIE11)&&"Html5"===o.techName&&o.isFullscreen()&&(o.exitFullscreen(),o.one("loadeddata",function(){o.requestFullscreen()}));var i=function(){o.src([{src:s.optimizationToken,type:P.HLSMimeType}]),f=P.Kollective,o.on("loadstart",function(){o.play()})},a=function(){o.src(u),f="",o.on("loadstart",function(){o.play()})},r=function(e){o.toggleBuffering(e)},s=u[0];U&&Panopto.viewer.isKollectiveEnabled&&s.optimizationToken?D.tryLoadOptimizedStream(s.optimizationToken,o,i,a,r):U&&Panopto.viewer.isHiveEnabled&&s.optimizationToken?o.initSession(s.optimizationToken,function(e,t){o.src([{src:e,type:P.HLSMimeType}]),f=P.Hive},function(){o.src(u)}):o.src(u),e&&c.deliveryTitle&&Panopto.viewer.ooyalaProviderCode&&Ooyala.Analytics.VideojsReporter(Panopto.viewer.ooyalaProviderCode,o,{mediaId:"{0} ({1})".format(c.deliveryTitle,c.id),contentType:Ooyala.Analytics.MediaContentType.EXTERNAL_CONTENT})},Y=function(e,t,o){u&&!t&&u[0].src===e.url||(c=e,V=!1,b=!1,A(!1),p=v.QualityReporter({streamUrl:e.url,isBroadcast:e.isBroadcast,isAudioOnly:e.isAudioOnly,minDuration:P.QualityReportThreshold}),u=[],_.each(_.filter([e.url,e.httpUrl],function(e){return e}),function(t){var o=t.indexOf(".m3u8")>=0,n={src:t,type:o?P.HLSMimeType:P.MP4MimeType};o&&e.optimizationToken&&(n.optimizationToken=e.optimizationToken),_.find(u,function(e){return e.src===t})||o&&!Panopto.Core.Browser.flashEnabled()&&Panopto.Core.Browser.supportsVideo(P.HLSMimeType)||u.push(n)}),_.some(u,function(e){return e.type===P.HLSMimeType})?Q(e,function(){ee(function(){J(!1,o)})}):ee(function(){J(!0,o)}))},X=function(){var e=Panopto.Core.Browser.isWebkit;o.on("rewind",function(){h.rewind()}).on("forward",function(){h.forward()}).on("togglePlaying",function(){h.togglePlaying()}).on("hotkey",function(t,o){!E&&e||h.hotkey(o)}).on("fullscreenModeChanged",function(){E=!E,h.synchronize()}).on("waiting",function(){"Flash"===o.techName&&o.toggleBuffering(!0),Panopto.viewer.isHiveEnabled&&o.trigger("hiveWaiting")}).on("canplay",function(){"Flash"===o.techName&&o.toggleBuffering(!1)})},Z=function(){var e=ne();o.on("waiting",function(){ie(e).show()}).on("canplay",function(){M.hide()}).on("seeked",function(){M.hide()})},ee=function(t){if(o)t();else if(!T){T=!0,Panopto.viewer.detectFlashCrashAndFallBackToHTML&&setTimeout(ae,1e3);var n={};Panopto.viewer.isHiveEnabled&&(n={hive:{hiveTechOrder:["HiveJava","StatsJS"]}});var i;if(Panopto.viewer.isKollectiveEnabled&&Panopto.Core.Browser.isEdge){var r=ne();ie(r).css({"z-index":10001}).show(),i=setTimeout(D.handleEdgeIssue,1e4)}videojs(g,{techOrder:Panopto.Core.Browser.flashEnabled()?["flash","html5"]:["html5"],controls:!1,preload:"auto",autoplay:!1,flash:{swf:Panopto.viewer.swfLocation},plugins:n},function(){o=videojs(g),i&&(M.hide(),window.clearTimeout(i)),o.on("levelswitch",function(){A(a===m.Playing),h.writeLineToClientLog(Panopto.Core.ViewerLogEntryType.QualityChange,[e?"Primary":"Secondary",o.level(),o.numberOfLevels(),L[o.level()]])}),o.on("ended",function(){b=!0}),X(),Z(),t()})}},te=!1,oe=function(){te||(window.location.search+="&{0}=true".format(Panopto.Core.Constants.IgnoreFlashParamKey),te=!0)},ne=function(){M.show();var e=M.outerWidth(!0),t=M.outerHeight(!0);return M.hide(),{bufferingWidth:e,bufferingHeight:t}},ie=function(e){var o="#{0} video".format(t.attr("id")),n=$(o);return M.css({top:n.offset().top+(n.height()-e.bufferingHeight)/2,left:n.offset().left+(n.width()-e.bufferingWidth)/2})},ae=function(){var t=$("#"+g).find("object");if(e&&t.length)try{t[0].exitFullscreen||oe()}catch(e){oe()}};return videojs.options.flash.flashVars={hls_debug:!1,hls_debug2:!1},{content:Y,playState:function(e){V?O(e):i=e},position:function(e,t){return"undefined"==typeof e?(e=V?n||o.currentTime():y,Panopto.viewer.detectFlashCrashAndFallBackToHTML&&o&&"Flash"===o.techName&&ae(),e===1/0?0:e):void(V?(t&&o.on("timeupdate",function(){o.currentTime()!==1/0&&(t(),o.off("timeupdate"))}),H(e)):y=e)},ended:function(){return b},bitrate:function(e){V&&F(e),s=e},numericBitrate:function(){return V&&"Flash"===o.techName?L[o.level()]:0},bitrateOptions:function(){return o&&"Flash"===o.techName?L:[]},playSpeed:function(e){V&&z(e),r=e},volume:function(e){V?N(e):l=e},muted:function(e){V?j(e):C=e},width:function(){return R},height:function(){return k},showShadow:function(e){o&&"Flash"===o.techName&&o.showShadow(e)},streamLength:function(){return V?o.duration():0},syncPlayState:function(e){o&&"Flash"===o.techName&&o.syncPlayState(e===m.Playing)},syncTimes:function(e,t){o&&"Flash"===o.techName&&o.syncTimes(e,t)},isFullscreen:function(e){return"undefined"==typeof e?!!V&&(o.isFullscreen()||E):void(V&&(e?o.requestFullscreen():o.exitFullscreen()))},setCaptionText:function(e){o&&"Flash"===o.techName&&o.setCaptionText(e)},optimizationProvider:function(){return f},setCaptionStyles:function(e){d=e,o&&"Flash"===o.techName&&q()}}};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Hive=function(e){var t=Panopto.Core.StringHelpers.parseQueryString(window.location.search.slice(1)),o="disabled"!==t.P2POptimization,n=function(e){return o&&Panopto.viewer.isDebugModeForFlowplayerHiveEnabled&&Panopto.viewer.isHiveEnabled&&!Panopto.viewer.isKollectiveEnabled&&e},i=function(e){var t={};return n(e.optimizationToken)&&(t={sources:[{type:"application/x-mpegurl",ticket:e.optimizationToken}],options:{debugLevel:"debug",hiveTechOrder:["HiveJava","StatsJS"]}}),t};return e.isHiveOptimized=n,e.createFlowplayerPlugin=i,e}(Panopto.Viewer.Hive||{});var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.FlashLongPoll=Panopto.Viewer.FlashLongPoll||{},Panopto.Viewer.Kollective=function(e){var t,o=Panopto.Viewer.Constants,n=Panopto.Core.StringHelpers.parseQueryString(window.location.search.slice(1)),i="disabled"!==n.P2POptimization,a=function(e){return i&&Panopto.viewer.isKollectiveEnabled&&e},r=function(e){return e.split("ktoken=")[1].split("&")[0]},s=function(e){var t={callback:function(t){var o=!1;try{o=t&&t.isInstalled()&&t.checkMinVersion(Panopto.viewer.kollectiveMinimumVersion),o||console.log(t.getAgentDetectionLog())}catch(e){o=!1,console.log(e)}finally{e(o)}},flash_loader_url:Panopto.appRoot+"/Scripts/Kollective/flash/kontikiagentflashloader-3.swf",use_ajax:!0,use_jsonp:!0,use_ssl:!0,callback_timeout:Panopto.viewer.kollectiveClientDetectionTimeout};try{kontikiAgent=new KontikiAgent(t)}catch(t){console.log(t),e(!1)}},l=function(e,o,n,i,s){if(a(e)){var l=function(){$.ajax({url:e,tryCount:0,success:function(){c(o,n,s)},error:function(e){d(this,e,o,i,s)}})};Panopto.viewer.useKollectiveFlashLongPoll?(s(!0),FlashLongPoll.start({optimizationToken:e,ktoken:r(e),callback:function(e,t){return P(e,t,l,i,s)}})):Panopto.viewer.kollectiveSkipLongPoll?c(o,n,s):(t=p(e),f(0,0,l,i,s),s(!0),$.ajax({url:e,success:function(){c(o,n,s)},error:function(){console.log("First Kollective call failed, if long poll also fails fallback.")}}))}},u=function(){window.location.search+="&{0}=true".format(o.ShowKollectiveEdgeMessageParam)},d=function(e,t,o,n){404===t.status&&e.tryCount<Panopto.viewer.kollectiveM3U8RetryCount?(e.tryCount+=1,$.ajax(e)):(n(!1),o())},c=function(e,t,o){if(e&&Panopto.viewer.isKollectiveEnabled&&Panopto.Core.Browser.isEdge){var n=setTimeout(u,1e4);e.one("loadeddata",function(){window.clearTimeout(n),o(!1)})}else o(!1);t()},p=function(e){var t="";try{var n=e.split("/"),i=r(e);t=n[0]+"//"+n[2]+o.KollectiveLongPollUrlBase+i}catch(e){console.log(e)}return t},f=function(e,o,n,i,a){$.ajax({url:t.format(e),method:"GET",datatype:"json",timeout:Panopto.viewer.kollectiveLongPollAjaxTimeout,success:function(e){try{var t=JSON.parse(e);o=P(t,o,n,i,a);var r=o>=Panopto.viewer.kollectiveLongPollErrorThreshold&&Panopto.viewer.kollectiveFallbackToSourcePermanently;!r&&t&&t.ts&&(newTimestamp=t.ts,setTimeout(function(){f(newTimestamp,o,n,i,a)},Panopto.viewer.kollectiveLongPollTimeout))}catch(e){console.log(e)}},error:function(){setTimeout(function(){f(e,0,n,i,a)},Panopto.viewer.kollectiveLongPollTimeout)}})},P=function(e,t,o,n,i){return e&&"manifestProgress"===e.cmd&&e.params?("100"===e.params.percent?o():i(!0),t=0):e&&"switchToCDN"===e.cmd?console.log("Command to switch to CDN."):(t+=1,t>=Panopto.viewer.kollectiveLongPollErrorThreshold?(console.log("Response from Kollective agent we don't explicitly handle, falling back. "+e.cmd),i(!1),n()):i(!0)),t};return e.isKollectiveOptimized=a,e.detectAgent=s,e.tryLoadOptimizedStream=l,e.handleEdgeIssue=u,e}(Panopto.Viewer.Kollective||{});var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.FlashLongPoll=function(e){e.callback,e.flashStartTimer,e.longPollUrlPattern,e.numErrorsInARow=0,e.prefetchUrl,e.timestamp=0;var t=function(t){e.callback=t.callback,e.longPollUrlPattern="http://127.0.0.1:31013/api/v1/longpoll?ts={0}%26ktoken="+t.ktoken,e.prefetchUrl=t.optimizationToken.replace(/\&/g,"%26"),o()},o=function(){var t={longpollUrl:e.longPollUrlPattern.format(e.timestamp),prefetchUrl:e.prefetchUrl},o={allowscriptaccess:"always"};swfobject.embedSWF(Panopto.appRoot+"/Scripts/Kollective/flash/kontikiflashlongpoll-v2.swf","kontikiLongPoll","1","1","10.0.0","",t,o,"",function(o){o.success?(gKontikiAgentLogs+="Flash long-poll embedded, starting poll on URL "+t.longpollUrl+"\n",e.flashStartTimer=setTimeout(function(){var t="Flash long-poll start time-out";gKontikiAgentLogs+=t+"\n",e.callback({error:t},e.numErrorsInARow)},15e3)):(gKontikiAgentLogs+="Flash long-poll failed to embed\n",e.callback({error:"Long-poll .swf failed to embed"},e.numErrorsInARow))})},n=function(e){gKontikiAgentLogs+="Flash long-poll I/O error: "+e+"\n",setTimeout(o,250)},i=function(e){gKontikiAgentLogs+="Flash long-poll load error: {0}\n".format(e)},a=function(){},r=function(e){gKontikiAgentLogs+="Flash prefetch load error: {0}\n".format(e)},s=function(){gKontikiAgentLogs+="Flash long-poll prefetch URL opened\n"},l=function(t){gKontikiAgentLogs+="Flash long-poll message: {0}\n".format(JSON.stringify(t)),t&&t.ts&&(e.timestamp=t.ts),e.numErrorsInARow=e.callback(t,e.numErrorsInARow),e.prefetchUrl="",setTimeout(o,250)},u=function(t){gKontikiAgentLogs+="Flash long-poll security error: "+t+"\n",e.callback({error:t},e.numErrorsInARow)},d=function(t){clearTimeout(e.flashStartTimer),gKontikiAgentLogs+="Flash long-poll bridge has started\n"};return e.ioError=n,e.longpollLoadError=i,e.open=a,e.prefetchError=r,e.prefetchOpen=s,e.response=l,e.securityError=u,e.started=d,e.start=t,e}(Panopto.Viewer.FlashLongPoll||{}),FlashLongPoll=Panopto.Viewer.FlashLongPoll;var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.API.EventType=Panopto.API.EventType||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Tabs.BookmarksTab=function(e,t,o,n,i){var a=[],r=Panopto.Viewer.Tabs.EditableEventTab(e,t,o,n,a,Panopto.API.EventType.Bookmark,!1,i,Panopto.GlobalResources.ViewerPlus_CreateBookmark,Panopto.GlobalResources.ViewerPlus_CreateBookmark_None,Panopto.GlobalResources.ViewerPlus_Bookmarks_SignIn,Panopto.Viewer.Analytics.Labels.Bookmark);return r.fetch(),r};var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.API.EventType=Panopto.API.EventType||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Tabs.CommentsTab=function(e,t,o,n,i,a,r){var s,l=[],u=Panopto.GlobalResources.ViewerPlus_AddComment,d=Panopto.Viewer.Tabs.EditableEventTab(e,t,o,n,l,Panopto.API.EventType.Comment,!1,i,u,u,Panopto.GlobalResources.ViewerPlus_Comments_SignIn,Panopto.Viewer.Analytics.Labels.Comment),c=Panopto.Core.Extensions.base(d),p=function(){e.find(".text").text(0===l.length?Panopto.GlobalResources.ViewerPlus_CommentsHeader:Panopto.GlobalResources.ViewerPlus_CommentHeader_Variable.format(l.length))},f=function(){a&&(clearInterval(s),s=setInterval(function(){d.fetch(void 0,void 0,void 0,void 0,!0)},1e3*r))};return d.render=function(e,t){var o;t&&(o=_.filter(l,function(t){return!_.find(e,function(e){return t.eventId===e.eventId})}),c.remove(o)),c.render(e,!1),p()},d.remove=function(e){c.remove(e),p()},d.addEvent=function(e,t){clearInterval(s),c.addEvent(e,t,void 0,f)},d.editEvent=function(e,t){clearInterval(s),c.editEvent(e,t,f)},d.deleteEvent=function(e){clearInterval(s),c.deleteEvent(e,f)},d.toggleBroadcastIsLive=function(e){d.inputDisabled()&&e?d.inputDisabled(!1):d.inputDisabled()||e||d.inputDisabled(Panopto.GlobalResources.ViewerPlus_Comments_SkipToLive)},d.fetch(),f(),d};var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.API.EventType=Panopto.API.EventType||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Tabs.ContentsTab=function(e,t,o,n,i,a){var r=Panopto.Viewer.Tabs.ViewerEventTab(e,t,o,n,[],Panopto.API.EventType.Slide,!0,Panopto.Viewer.Analytics.Labels.Content),s=t.find("#deliveryDescription");return jQuery.trim(a)&&(Panopto.Core.TextHelpers.addMultilineStringToElement(a,s[0]),s.show()),r.render(i,!0),r};var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.API.EventType=Panopto.API.EventType||{},Panopto.UI=Panopto.UI||{},Panopto.UI.Input=Panopto.UI.Input||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.EditableEventTab=function(e,t,o,n,i,a,r,s,l,u,d,c,p){var f=Panopto.API,P=Panopto.Viewer.Constants,m=Panopto.Viewer.Analytics,v=Panopto.Viewer.Tabs.ViewerEventTab(e,t,o,n,i,a,r,c),h=Panopto.Core.Extensions.base(v);t.append(_.template($("#eventTabInputTemplate").html(),{}));var g,y,w,C=t.find(".event-input"),b=t.find(".cancel-editing"),T="placeholder",S="editing",V=0,E=C.height(),I=function(){Panopto.Core.UI.Components.placeholder(C,w||(i.length?l:u),T)},R=function(e){e?(g=e,t.find("#"+e.id).toggleClass(S,!0),C.val(e.text).toggleClass(T,!1).focus().select(),D(),b.show(),C.prop("disabled",!1).toggleClass(S,!0)):(g&&(t.find("#"+g.id).toggleClass(S,!1),b.hide(),C.toggleClass(S,!1)),g=void 0,C.val(""),D(E),I(),y=void 0,w&&C.prop("disabled",!0))},k=function(e,o,n,i){var a=t.find("#"+e.id),r=a.find(".event-error");r.find(".event-error-message").text(o),Panopto.Core.UI.Handlers.button(r.find(".event-error-retry"),n),Panopto.Core.UI.Handlers.button(r.find(".event-error-cancel"),i),a.toggleClass("errored",!0)},L=function(e){var o=t.find("#"+e.id),n=o.find(".event-edit-controls");Panopto.Core.UI.Handlers.button(o.find(".event-edit"),function(){R(!1),R(e)}),Panopto.Core.UI.Handlers.button(o.find(".event-delete"),function(){e.saved=!1,v.render([e],!1),v.deleteEvent(e)}),Panopto.Core.UI.Handlers.hoverableParent(o,n,function(e){o.find(".event-time").css("visibility",e?"hidden":""),n.toggle(e)})},D=function(e){var t=C.innerHeight()-C.height();C.height(1);var o=C[0].scrollHeight,n=e||o-t;C.height(n)};return s.key?(C.keyup(function(){var e=jQuery.trim(C.val());e&&"undefined"==typeof y?y=p?(new Date).getTime()/1e3:o.position():e||(y=void 0)}),C.on("paste input",function(){D()}),C.keydown(function(e){e.ctrlKey&&e.keyCode===Panopto.Core.Key.UpArrow||(e.stopPropagation(),13!==e.keyCode||e.shiftKey||(e.preventDefault(),"undefined"==typeof y&&C.keyup(),v.submitEvent()))}),Panopto.Core.UI.Handlers.button(b,function(){R(!1)}),l&&I()):(C.hide(),t.find(".event-signin").html(d.format(_.template($("#eventTabSignInTemplate").html(),{url:"{0}?ReturnUrl={1}".format(Panopto.loginUrl,encodeURIComponent(window.location.href)),text:Panopto.GlobalResources.ViewerPlus_EventTab_SignIn}))).show()),v.resize=function(e,t){var o=C.is(":visible")?C.outerHeight(!0):0;b.is(":visible")&&(o+=b.outerHeight(!0)),C.width(e-P.InputMargin),h.resize(e,t-o)},v.render=function(e,t){s.key&&_.each(e,function(e){e.editable=e.saved&&e.user===s.key,e.deletable=e.saved&&(e.editable||s.role>Panopto.Data.AclRoleType.Viewer)}),p&&_.each(e,function(e){delete e.time}),h.render(e,t),_.each(e,function(e){(e.editable||e.deletable)&&L(e)}),I(),o.resize()},v.remove=function(e){h.remove(e),I()},v.addEvent=function(e,t,o,i){f.Delivery.createEvent(n,a,e.text,t,!p,o,function(t){e.eventId=t.EventID,e.eventPublicId=t.PublicId,e.sessionId=t.SessionId,e.saved=!0,v.render([e],!1),v.toggleLoading(!1),m.sendEvent({action:m.Actions.Add.Success,label:c}),i&&i()},function(){k(e,Panopto.GlobalResources.ViewerPlus_EventTab_AddError,function(){v.addEvent(e,t,o,onSuccess),m.sendEvent({action:m.Actions.Add.Retry,label:c})},function(){v.remove([e]),m.sendEvent({action:m.Actions.Add.Cancel,label:c})}),v.toggleLoading(!1),m.sendEvent({action:m.Actions.Add.Error,label:c}),i&&i()})},v.editEvent=function(e,t,o){f.Delivery.editEvent(e.sessionId,e.type||a,e.eventPublicId,e.text,function(){e.saved=!0,v.render([e],!1),v.toggleLoading(!1),m.sendEvent({action:m.Actions.Edit.Success,label:c}),o&&o()},function(){k(e,Panopto.GlobalResources.ViewerPlus_EventTab_EditError,function(){v.editEvent(e,t,onSuccess),m.sendEvent({action:m.Actions.Edit.Retry,label:c})},function(){e.text=t,e.saved=!0,v.render([e],!1),m.sendEvent({action:m.Actions.Edit.Cancel,label:c})}),v.toggleLoading(!1),m.sendEvent({action:m.Actions.Edit.Error,label:c}),o&&o()})},v.deleteEvent=function(e,t){v.toggleLoading(!0),f.Delivery.deleteEvent(e.sessionId,e.type||a,e.eventPublicId,function(){e===g&&R(!1),v.remove([e]),v.toggleLoading(!1),m.sendEvent({action:m.Actions.Delete.Success,label:c}),t&&t()},function(){k(e,Panopto.GlobalResources.ViewerPlus_EventTab_DeleteError,function(){v.deleteEvent(e,t),m.sendEvent({action:m.Actions.Delete.Retry,label:c})},function(){e.saved=!0,v.render([e],!1),m.sendEvent({action:m.Actions.Delete.Cancel,label:c})}),v.toggleLoading(!1),m.sendEvent({action:m.Actions.Delete.Error,label:c}),t&&t()})},v.submitEvent=function(e){var t,o,n,i=jQuery.trim(C.val());i&&(C.val(""),D(E),v.toggleLoading(!0),g?(o=g,R(!1),n=o.text,o.text=i,o.saved=!1,v.render([o],!1),v.editEvent(o,n)):(t=p?y-(new Date).getTime()/1e3:y,o={id:a+V,text:i,time:y,creationTime:Panopto.Core.TimeHelpers.currentWin32EpochTime(),user:s.key,userDisplayName:Panopto.viewer.displayFullNamesInDiscussion?s.name:s.key},v.render([o],!1),y=void 0,V++,v.addEvent(o,t,e)))},v.inputDisabled=function(e){return"undefined"==typeof e?!!w:(g&&R(!1),w=e,C.prop("disabled",!!w).val(""),I(),void 0)},v};var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.API.EventType=Panopto.API.EventType||{},Panopto.UI=Panopto.UI||{},Panopto.UI.Components=Panopto.UI.Components||{},Panopto.UI.Accessibility=Panopto.UI.Accessibility||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.EventTab=function(e,t,o,n,i,a,r,s,l){var u=Panopto.API,d=Panopto.Viewer.Constants,c=Panopto.Viewer.Analytics,p={};t.prepend(_.template($("#eventTabErrorTemplate").html(),{}));var f=$("#eventTemplate"),P=t.find(".event-tab-scroll-pane"),m=t.find(".event-tab-list"),v=t.find(".event-tab-spinner"),h=t.find(".event-tab-error"),g=t.find(".event-tab-help"),y=Panopto.Core.UI.Components.scrollingHighlight(P,!0,d.EventScrollTimeout),w=function(e){y.highlight(_.find(i,function(t){return t.id===e.id}),function(e){o.position(e.time),c.sendEvent({action:c.Actions.Navigate,label:s})})},C=function(e,t){var o=a===Panopto.API.EventType.Comment?e.creationTime-t.creationTime:e.time-t.time;return o||e.id===t.id||(o=e.id>t.id?-1:1),o},b=function(e){for(var t=[],o=[],n=0,a=0;n<i.length&&a<e.length;){var r=i[n],s=e[a],l=C(r,s);0===l?(p.isSameEventRendering(r,s)||(t.push(s),o.push(r)),n++,a++):l<0?(o.push(r),n++):(t.push(s),a++)}for(;n<i.length;)o.push(i[n]),n++;for(;a<e.length;)t.push(e[a]),a++;return{eventsToAdd:t,eventsToRemove:o}},T=Panopto.Core.UI.Accessibility.tab(e,t),S=!Panopto.Core.Browser.inIframe()||Panopto.viewer.linksEnabledInIframe;return Panopto.Branding.animateLoadingIndicator(Panopto.branding.accentColor),e.toggle(!0),m.keydown(function(e){!e.ctrlKey&&_.contains([d.VolumeUpKeyCode,d.VolumeDownKeyCode],e.keyCode)&&e.stopPropagation()}),g.toggle(S),p.isSameEventRendering=function(e,t){return e.id===t.id&&(void 0===e.displayTime||void 0===t.displayTime||e.displayTime===t.displayTime)&&e.inlineEditable===t.inlineEditable&&e.text===t.text&&e.showUser===t.showUser&&e.userDisplayName===t.userDisplayName&&e.time===t.time&&e.timeRange===t.timeRange&&e.editable===t.editable&&e.deletable===t.deletable},p.selected=function(n){return"undefined"==typeof n?e.hasClass("selected"):(e.toggleClass("selected",n),n?t.delay(d.FadeInterval).fadeIn(d.FadeInterval,function(){o.resize()}):t.fadeOut(d.FadeInterval),T.selected(n),void 0)},p.headerId=function(){return e.attr("id")},p.resize=function(e,o){P.css("max-height",o+"px"),t.width(e),m.find(".event-text").each(function(){var t=$(this),o=t.outerWidth()-t.width(),n=e-d.ScrollBarWidth-o;t.siblings().each(function(){n-=$(this).outerWidth()}),t.width(n)})},p.position=function(e){var t;r&&(_.each(i,function(o){o.time<=e&&(t=o)}),y.highlight(t))},p.render=function(e,t,n,r,s){if(n||e.sort(C),r){var l=b(e);e=l.eventsToAdd,_.each(l.eventsToRemove,function(e){i.splice(i.indexOf(e),1),m.find("#"+e.id).remove()})}_.each(e,function(e){var t,n=Panopto.Core.TextHelpers.cleanTextWithHighlighting(e.text);
"number"!=typeof e.time||e.displayTime||(e.displayTime=Panopto.Core.TimeHelpers.formatDuration(e.time,Panopto.GlobalResources.TimeSeparator)),!e.creationTime||a!==Panopto.API.EventType.Comment&&"Comments"!==e.type&&e.displayTime||(t=Panopto.Core.TimeHelpers.toLocalPanoptoTime(Panopto.Core.TimeHelpers.formatWin32EpochTimeToDate(e.creationTime),Panopto.timeZone),e.displayDate=Panopto.GlobalResources.ViewerPlus_CommentTimestamp.format(Panopto.Core.TimeHelpers.utcDateToFormattedString(t,"LL"),Panopto.Core.TimeHelpers.utcDateToFormattedString(t,"LT"),e.userDisplayName)),e.isQuestionList?e.iconCode=Panopto.Core.Constants.QuestionListIconCode:e.url&&e.url.indexOf(Panopto.Viewer.Constants.YouTubeEmbedBaseUrl)!==-1&&(e.iconClass=Panopto.Viewer.Constants.YouTubeIconClass),o.isActiveBroadcast()&&(e.createdDuringWebcast=!1),S&&(n=Panopto.Core.TextHelpers.urlsToLinks(n)),e.content=Panopto.Core.TextHelpers.displayLineBreaks(n)}),!r&&t?(i.length=0,_.each(e,function(e){i.push(e)}),m.html(_.template(f.html(),{events:e})),_.each(i,function(e){p.afterRenderItem(e,m.find("#"+e.id),!1)})):_.each(e,function(e){var t,o,n=_.template(f.html(),{events:[e]}),a=_.findIndex(i,function(t){return t.eventId===e.eventId}),r=!1;if(a>=0)o=m.find("#"+e.id),r=o.hasClass(Panopto.Core.Constants.HighlightedClass)&&!s,o.replaceWith(n),i[a]=e;else{i.push(e),i.sort(C),r=!s,t=i.indexOf(e);var l=$.parseHTML(n);0===t?m.prepend(l):t===i.length-1?m.append(l):m.find("#"+i[t-1].id).after(l),o=$(l)}p.afterRenderItem(e,o,r)})},p.afterRenderItem=function(e,t,o){e.displayTime&&Panopto.Core.UI.Handlers.button(m.find("#"+e.id),w),o&&y.highlight(e),t.find("a").unbind("click keydown").click(function(e){e.stopPropagation()}).keydown(function(e){e.stopPropagation()})},p.remove=function(e){_.each(e,function(e){var t=m.find("#"+e.id);t.slideUp(function(){t.remove()}),i.splice(i.indexOf(e),1)})},p.toggleLoading=function(e){v.toggle(e)},p.error=function(e,t){e?(h.find(".event-tab-error-message").text(e),Panopto.Core.UI.Handlers.button(h.find(".event-tab-error-retry"),t),Panopto.Core.UI.Handlers.button(h.find(".event-tab-error-cancel"),function(){p.error(!1)}),h.slideDown()):h.slideUp()},p.fetch=function(e,t,o,i,r){i=i||a,p.toggleLoading(!0),u.Delivery.search(n,i,e,t,o,l,!r,function(e){p.render(_.map(e,Panopto.Viewer.Data.Event),!0),p.error(!1),p.toggleLoading(!1)},function(){p.fetchError(e,t,o,i)})},p.fetchError=function(e,t,o,n){p.error(Panopto.GlobalResources.ViewerPlus_EventTab_LoadError,function(){p.fetch(e,t,o,n)}),p.toggleLoading(!1)},p};var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.API.EventType=Panopto.API.EventType||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Tabs.NotesTab=function(e,t,o,n,i,a,r,s){var l,u,d,c=Panopto.API,p=Panopto.Viewer.Data,f=Panopto.Viewer.Constants,P=[],m=Panopto.Viewer.Tabs.EditableEventTab(e,t,o,n,P,c.EventType.Note,!0,i,Panopto.GlobalResources.ViewerPlus_AddNote,Panopto.GlobalResources.ViewerPlus_AddNote_None,Panopto.GlobalResources.ViewerPlus_Notes_SignIn,Panopto.Viewer.Analytics.Labels.Note,s),v=Panopto.Core.Extensions.base(m),h=[],g=t.find("#channelSelect"),y=t.find("#channelInput"),w=t.find("#channelOptionTemplate"),C=t.find("#togglePublic"),b="public",T=t.find("#cancelChannel"),S=function(e){g.val(e.value),g.change()},V=function(e){g.toggle(e),C.toggle(r&&e&&a&&l===u),y.toggle(!e),T.toggle(!e)},E=function(e){C.text(e?Panopto.GlobalResources.ViewerPlus_MakePrivate:Panopto.GlobalResources.ViewerPlus_MakePublic),C.toggleClass(b,e)},I=function(){m.toggleLoading(!0),c.Delivery.toggleEventPrivacy(n,!C.hasClass(b),function(e){E(e.Public),m.error(!1),m.toggleLoading(!1)},function(){var e=C.hasClass(b)?Panopto.GlobalResources.ViewerPlus_EventTab_TogglePrivateError:Panopto.GlobalResources.ViewerPlus_EventTab_TogglePublicError;m.error(e,function(){I()}),m.toggleLoading(!1)})};return u=p.Channel("",Panopto.GlobalResources.ViewerPlus_YourNotes.format(i.key)),h.push(u),a&&_.each(a,function(e){e.value!==i.key&&h.push(e)}),h.push(p.Channel(f.JoinChannelOptionValue,Panopto.GlobalResources.ViewerPlus_JoinChannel)),g.html(_.template(w.html(),{channels:h})),d=g.find("option[value='"+f.JoinChannelOptionValue+"']"),g.change(function(){var e=g.val();e===f.JoinChannelOptionValue?(V(!1),y.focus()):(l=_.find(h,function(t){return t.value===e}),m.fetch(),C.toggle(r&&a&&e===u.value))}),a&&(Panopto.Core.UI.Handlers.button(C,I),E("undefined"!=typeof _.find(a,function(e){return e.name===i.key})),C.toggle(r)),y.keydown(function(e){var t,o,n=jQuery.trim(y.val());13===e.keyCode&&(e.preventDefault(),n&&n!==f.JoinChannelOptionValue&&(t=_.find(h,function(e){return e.value===n}),t||(o=p.Channel(n),d.before(_.template(w.html(),{channels:[o]})),h.splice(h.length-2,0,o),y.val(""),t=o),V(!0),S(t))),e.stopPropagation()}),Panopto.Core.UI.Handlers.button(T,function(){y.val(""),S(l),V(!0)}),m.render=function(e,t){_.each(e,function(e){e.showUser=e.user!==i.key}),v.render(e,t)},m.fetch=function(){l===u?v.fetch():l.isUser?v.fetch("",l.value):v.fetch("","",l.value)},m.submitEvent=function(){var e=g.val();e===f.JoinChannelOptionValue&&(e=jQuery.trim(y.val())),e?v.submitEvent(e):v.submitEvent(l.value)},S(h[0]),m};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Tabs.PlayerTabHeader=function(e,t,o,n,i){var a,r,s=e.find(".player-seek-text"),l=!1,u=function(t){var n=_.find(o,function(e){return e>t}),i=o.indexOf(n),l=n&&i%2!==0||!n&&o.length%2!==0||o[i-1]===t;return e.toggleClass(Panopto.Core.Constants.InactiveClass,!l),!l&&r&&e.blur(),r=l,a=l?void 0:n||o[0],s.text(Panopto.GlobalResources.ViewerPlus_SecondarySeekText.format(Panopto.Core.TimeHelpers.formatDuration(n||o[0],Panopto.GlobalResources.TimeSeparator))),l},d=function(t){return"undefined"==typeof t?l:(e.toggleClass(Panopto.Core.Constants.SelectedClass,t),t&&!l&&s.hide(),e.attr("aria-pressed",t),l=t,void 0)},c=function(t){return 1===e.filter(function(){return this===t}).length};return e.addClass(n?Panopto.Viewer.Constants.PrimaryTabHeaderClass:Panopto.Viewer.Constants.SecondaryTabHeaderClass),i&&e.find(".player-tab-wrapper > i").html(i),Panopto.Core.UI.Handlers.hoverableParent(e,s,function(t){e.hasClass(Panopto.Core.Constants.InactiveClass)&&!e.hasClass(Panopto.Core.Constants.DisabledClass)&&t?s.show().css("left",(e.filter(":visible").width()-s.filter(":visible").outerWidth())/2):s.hide()}),{available:u,selected:d,owns:c,id:function(){return t},seekTime:function(){return a},timeline:function(e){o=e}}};var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.API.EventType=Panopto.API.EventType||{},Panopto.UI=Panopto.UI||{},Panopto.UI.Input=Panopto.UI.Input||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Tabs.SearchTab=function(e,t,o,n,i,a){var r,s,l=Panopto.Viewer.Constants,u=[],d=Panopto.Viewer.Tabs.ViewerEventTab(e,t,o,n,u,"",!1,Panopto.Viewer.Analytics.Labels.Search,a),c=Panopto.Core.Extensions.base(d),p="placeholder",f="searchable",P=$("#searchRegion"),m=P.find("#searchInput"),v=P.find("#searchButton"),h=P.find(".clear-button"),g=t.find("#searchTypeSelect"),y=t.find("#searchSortSelect");P.toggle(!0),e.hide();var w=[{value:"",name:Panopto.GlobalResources.ViewerPlus_Search_All}];return _.each(Panopto.API.EventType,function(e,t){w.push({value:e,name:Panopto.GlobalResources[l.SearchTypeResourceString.format(t)]})}),g.html(_.template($("#searchOptionTemplate").html(),{searchOptions:w})),y.html(_.template($("#searchOptionTemplate").html(),{searchOptions:l.SearchSortOrders})),m.keydown(function(e){e.keyCode===Panopto.Core.Key.Enter&&d.fetch(),e.stopPropagation()}),m.keyup(function(){P.toggleClass(f,""!==jQuery.trim(m.val()))}),m.focus(function(){P.toggleClass(f,!m.hasClass(p)&&""!==jQuery.trim(m.val())),o.expandLeftPane()}),g.change(function(){d.fetch()}),y.change(function(){var e=[];_.each(u,function(t){e.push(t)}),y.val()===l.SortTimeValue?d.render(e):d.fetch()}),Panopto.Core.UI.Handlers.button(v,function(){d.fetch()}),Panopto.Core.UI.Handlers.button(h,function(){m.val(""),P.removeClass(f),d.fetch()}),Panopto.Core.UI.Components.placeholder(m,Panopto.GlobalResources.ViewerPlus_SearchHeader,p),d.selected=function(e){return"undefined"==typeof e?c.selected():(c.selected(e),void P.toggleClass(Panopto.Core.Constants.SelectedClass,e))},d.render=function(e){var o;_.each(e,function(e){e.iconClass=e.type,"Notes"===e.type&&(i&&i.key===e.user||(e.showUser=!0))}),c.render(e,!0,y.val()===l.SortRelevanceValue),o=!!e.length,o||t.find("#searchResultsMessage").html(Panopto.GlobalResources.ViewerPlus_Search_NoResults.format("<span class='match'>{0}</span>".format(Panopto.Core.TextHelpers.cleanTextWithHighlighting(r)))),t.find("#searchResultsMessage").toggle(!o)},d.fetch=function(){r=m.hasClass(p)?"":jQuery.trim(m.val()),P.toggleClass("search-active",!!r),e.toggle(!!r);var t=o.getSelectedEventTab();r?(t!==d&&(s=t,o.selectEventTab(d)),c.fetch(r,"","",g.val())):t===d&&(s?o.selectEventTab(s):o.selectFirstEventTab())},d};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Constants=Panopto.Viewer.Constants||{},Panopto.Viewer.Tabs.SecondaryTab=function(e,t,o){var n,i,a=Panopto.Viewer.Analytics,r=Panopto.Viewer.Constants,s=!0,l=function(){var e=60,a="inline",r="flyout";t.hiddenTab||($("#selectedSecondary").before(_.template($("#playerTabHeaderTemplate").html(),{content:t,type:a,tabindex:e})),$("#secondaryExpander .flyout-close").before(_.template($("#playerTabHeaderTemplate").html(),{content:t,type:r,tabindex:e}))),n=$("#"+a+t.id+", #"+r+t.id),i=Panopto.Viewer.Tabs.PlayerTabHeader(n,t.id,t.timeline,!1,o)};return{render:l,remove:function(){e.remove(),n.remove()},position:function(t,o,n){return e.position(t,o,n)},playState:function(t){e.playState(t)},bitrate:function(t){e.bitrate(t)},numericBitrate:function(){return e.numericBitrate()},hasMBR:function(){return e.hasMBR()},bitrateLevelOffset:function(){return e.bitrateLevelOffset()},playSpeed:function(t){e.playSpeed(t)},content:function(o){return"undefined"==typeof o?t:(t=o,i.timeline(o.timeline),i.selected()&&e.content(o),void 0)},resize:function(t,o){e.resize(t,o)},available:function(e){return i.available(e)},timeline:function(){return t.timeline},selected:function(n,r){return"undefined"==typeof n?i.selected():(e.toggle(n),n&&!i.selected()&&($("#secondaryPlayer").attr("class",t.tabClass),e.content(t),$("#selectedSecondaryText").text(t.title),o?$("#selectedSecondaryIcon").html(o).attr("class","material-icons"):$("#selectedSecondaryIcon").html("").attr("class",t.iconClass),r&&a.sendEvent({action:a.Actions.SecondaryTab,label:t.tabClass})),i.selected(n),void 0)},id:function(){return i.id()},owns:function(e){return i.owns(e)},seekTime:function(){return i.seekTime()},pauseWhenAvailable:function(){return t.pauseWhenAvailable},isSessionPlaybackBlocking:function(){return t.isSessionPlaybackBlocking},hiddenTab:function(){return t.hiddenTab},adjustTimeline:function(e){var o=e-1.5*(r.TimedSyncRate/1e3);t.pauseWhenAvailable&&t.timeline[0]>o&&(t.timeline[0]=o)},enabled:function(e){return"undefined"==typeof e?s:(s=e,void n.toggleClass(Panopto.Core.Constants.DisabledClass,!s))}}};var Panopto=Panopto||{};Panopto.API=Panopto.API||{},Panopto.API.EventType=Panopto.API.EventType||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Analytics=Panopto.Viewer.Analytics||{},Panopto.Viewer.Tabs.TranscriptTab=function(e,t,o,n,i){var a=Panopto.API,r=[],s=Panopto.Viewer.Tabs.ViewerEventTab(e,t,o,n.id,r,Panopto.API.EventType.Transcript,!0,Panopto.Viewer.Analytics.Labels.Transcript,i);return s.fetch=function(){s.toggleLoading(!0),a.Delivery.getCaptions(n.id,i,function(e){n.captions=_.map(e,Panopto.Viewer.Data.Event),s.render(n.captions,!0),s.error(!1),s.toggleLoading(!1)},function(){s.fetchError(),s.toggleLoading(!1)})},s.fetch(),s};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.ViewerEventTab=function(e,t,o,n,i,a,r,s,l){var u=Panopto.Viewer.Tabs.EventTab(e,t,o,n,i,a,r,s,l),d=Panopto.Core.Extensions.base(u);return u.render=function(e,t,o,n,i){e=_.filter(e,function(e){return jQuery.trim(e.text)}),d.render(e,t,o,n,i)},u};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},Panopto.Viewer.Tabs.Editor.EditContentsTab=function(e,t,o,n){var i,a=Panopto.Viewer.Tabs.Editor.EditTOCEventTab(e,t,o,Panopto.Viewer.Analytics.EditContents,n,[Panopto.Core.EventType.Label,Panopto.Core.EventType.SlideChange],Panopto.GlobalResources.ViewerPlus_Edit_AddTOC,!0),r=Panopto.Core.Extensions.base(a),s=t.find(".event-input"),l=t.find("#editDescriptionInput"),u=t.find("#quizInputOption"),d=t.find("#youtubeInputOption"),c=function(){var e=s.hasClass(Panopto.Core.Constants.PlaceholderClass)?"":s.val();return $.trim(e)};return a.addEvent=function(e){r.addEvent(e,Panopto.Core.EventType.Label,!0)},a.resize=function(e,t){i.resize(),r.resize(e,t)},a.position=function(e){u.add(d).toggleClass(Panopto.Core.Constants.DisabledClass,a.checkForEmbeddedUrlEvents(e)),r.position(e)},l.attr(Panopto.Core.Constants.InitAttribute,n.session().description||""),i=Panopto.Core.UI.Components.editableLabel(l,function(e){var t=n.session();t.description=e,Panopto.Core.ServiceInterface.Rest.Sessions.update(t,function(){i.save()},function(){i.revert(),t.description=l.val(),Panopto.Core.UI.Components.placeholder(l,Panopto.GlobalResources.ViewerPlus_Edit_NoDescription)})},!0),Panopto.Core.UI.Components.placeholder(l,Panopto.GlobalResources.ViewerPlus_Edit_NoDescription),Panopto.Core.UI.Handlers.button(u,function(){u.hasClass(Panopto.Core.Constants.DisabledClass)||(n.addQuestionList(c()),a.clearInput())}),Panopto.Core.UI.Handlers.button(d,function(){var e=c()||Panopto.GlobalResources.ViewerPlus_Edit_YouTubeDefaultName;d.hasClass(Panopto.Core.Constants.DisabledClass)||r.addEvent(e,Panopto.Core.EventType.Label,!0,Panopto.Viewer.Constants.YouTubeEmbedBaseUrl)}),Panopto.Core.UI.Handlers.button($("#urlInputOption"),function(){var e=c()||Panopto.GlobalResources.ViewerPlus_Edit_UrlEventDefaultName,t=e.match(Panopto.Core.Constants.UrlMatcher)?e:void 0,o=r.addEvent(e,Panopto.Core.EventType.Label,!0,t);a.openEditDialog(o)}),a};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},Panopto.Viewer.Tabs.Editor.EditCutTab=function(e,t,o,n){var i=Panopto.Viewer.Tabs.Editor.EditorTab(e,t,o,Panopto.Viewer.Analytics.Labels.EditCut,n,Panopto.GlobalResources.ViewerPlus_Edit_Modal_EditCutTitle),a=Panopto.Core.Extensions.base(i),r=function(e,t){return e.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream?n.activeState().toTimelineRelativeTime(t,e.targetId)/Panopto.Core.Constants.TimelineChunkMultiplier:(t-n.activeState().firstPrimaryOffset())/Panopto.Core.Constants.TimelineChunkMultiplier},s=function(e,t){return e.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream?n.activeState().fromTimelineRelativeTime(t*Panopto.Core.Constants.TimelineChunkMultiplier,e.targetId):t*Panopto.Core.Constants.TimelineChunkMultiplier+n.activeState().firstPrimaryOffset()};return i.templateDialog=function(e,t){var a=t.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream?n.getStream(t.targetId):void 0;e.html(_.template($("#editCutTemplate").html(),{cut:{streamName:a?n.getStreamName(a,a.id,!0):void 0,streamLength:a?"{0} - {1}".format(i.formatTime(n.activeState().toTimelineRelativeTime(a.absoluteStart)/Panopto.Core.Constants.TimelineChunkMultiplier),i.formatTime(n.activeState().toTimelineRelativeTime(a.absoluteEnd())/Panopto.Core.Constants.TimelineChunkMultiplier)):void 0,startTime:i.formatTime(r(t,t.start)),endTime:i.formatTime(r(t,t.end())),streamIconCode:a?o.getStreamIconCode(a):Panopto.Core.Constants.SessionIconCode}}))},i.hasChanges=function(e,t){var o=e.find(".edit-cut-start-time").val()!==i.formatTime(r(t,t.start));return o=o||e.find(".edit-cut-end-time").val()!==i.formatTime(r(t,t.end()))},i.validate=function(e,t){var o,n,a,r=t.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream?t.targetId:void 0,l=i.validateTime(e.find(".edit-cut-start-time").val(),r),u=i.validateTime(e.find(".edit-cut-end-time").val(),r);return e.find(".edit-cut-start-time-error").text(l||""),e.find(".edit-cut-end-time-error").text(u||""),o=!l&&!u,o&&(n=s(t,Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-cut-start-time").val(),Panopto.GlobalResources.TimeSeparator)),a=s(t,Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-cut-end-time").val(),Panopto.GlobalResources.TimeSeparator)),o=a>n,e.find(".edit-cut-end-time-error").text(o?"":Panopto.GlobalResources.ViewerPlus_Edit_Modal_CutEndError)),o},i.populateEvent=function(e,t){var o=t.start,i=s(t,Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-cut-start-time").val(),Panopto.GlobalResources.TimeSeparator)),a=s(t,Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-cut-end-time").val(),Panopto.GlobalResources.TimeSeparator)),r=t.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream?t.targetId:void 0;n.resizeCut(o,i,a,r)},i.render=function(){var e=_.map(i.events(),function(e){var t=r(e,e.start),i=r(e,e.end()),a=e.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Stream?n.getStream(e.targetId):void 0;return{id:e.id,eventId:e.id,time:t,displayTime:"{0} - {1}".format(Panopto.Core.TimeHelpers.formatDuration(t,Panopto.GlobalResources.TimeSeparator),Panopto.Core.TimeHelpers.formatDuration(i,Panopto.GlobalResources.TimeSeparator)),text:a?n.getStreamName(a,e.targetId,!0):Panopto.GlobalResources.ViewerPlus_Edit_SessionCutName,editable:!a||!a.isPrimary,deletable:!a||!a.isPrimary,timeRange:!0,iconCode:a?o.getStreamIconCode(a):Panopto.Core.Constants.SessionIconCode}});a.render(e),_.each(i.events(),function(e){var o=t.find("#"+e.id);Panopto.Core.UI.Handlers.button(o.find(".event-delete"),function(){var t;n.pushEdit(),t=_.find(i.events(),function(t){return e.id===t.id}),i.events().splice(i.events().indexOf(t),1),n.applyState()})})},i};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},Panopto.Viewer.Tabs.Editor.EditEventTab=function(e,t,o,n,i,a,r,s,l){var u,d,c,p=Panopto.Viewer.Tabs.Editor.EditorTab(e,t,o,n,i,r),f=Panopto.Core.Extensions.base(p),P=t.find(".event-input"),m=t.find(".event-input-options"),v={},h=function(e){e.keyCode===Panopto.Core.Key.Space&&e.shiftKey&&(e.preventDefault(),o.hotkey(e.keyCode))},g=function(e,t,o){var n=v[e.id];if(!n){var a;n=Panopto.Core.UI.Components.editableLabel(o,function(t){var o=$.trim(t);if(o){i.pushEdit();var a=_.find(i.activeState().events(),function(t){return e.id===t.id});a.name=o,a.edited=!0,i.applyState()}else n.revert()},!0),a=Panopto.Core.UI.Components.placeholder(o,Panopto.GlobalResources.ViewerPlus_EventTab_NoContent),o.click(function(e){e.stopPropagation()}),o.keydown(h),v[e.id]=n}n.resize()},y=function(e,t){var o=t.find(".event-text-input"),n=t.find(".event-text-content");p.attachDeleteHandlers(e,t),Panopto.Core.UI.Handlers.hoverableParent(t,o,function(i){i&&(o.show(),n.hide(),g(e,t,o))},{preserveExisting:!0})},w=function(){u=o.position(),d=o.activePrimary().id,activeSecondary=o.activeSecondary(),activeSecondary&&_.find(i.activeState().streams(),function(e){return e.id===activeSecondary.id})&&(c=activeSecondary.id)},C=function(){u=void 0,d=void 0,c=void 0};return p.render=function(){var e=_.filter(p.events(),function(e){return _.contains(a,e.type)&&!e.isDefaultThumbnail}),o="questionList",n=l?i.activeState().questionLists():[],r=_.map(e,function(e){var t=e.link&&e.link.indexOf(Panopto.Viewer.Constants.YouTubeEmbedBaseUrl)!==-1;return{id:e.id,eventId:e.id,time:p.toTimelineRelativeTime(e),text:e.name,editable:!t,deletable:!0,inlineEditable:!0,iconClass:t?Panopto.Viewer.Constants.YouTubeIconClass:void 0}}),s=_.map(n,function(e){return{id:o+e.id,eventId:o+e.id,time:(e.sessionRelativeTime-i.activeState().firstPrimaryOffset())/Panopto.Core.Constants.TimelineChunkMultiplier,text:e.name,deletable:!0,iconCode:Panopto.Core.Constants.QuestionListIconCode}}),u=r.concat(s);f.render(u),v={},_.each(n,function(e){var n=t.find("#"+o+e.id),a=n.find(".event-edit-controls");Panopto.Core.UI.Handlers.hoverableParent(n,a,function(e){n.find(".event-time").css("visibility",e?"hidden":""),a.toggle(e)}),Panopto.Core.UI.Handlers.button(n.find(".event-delete"),function(){var t;i.pushEdit();var o=i.activeState().questionLists();t=_.find(o,function(t){return e.id===t.id}),o.splice(o.indexOf(t),1),i.applyState()})})},p.afterRenderItem=function(e,t,o){f.afterRenderItem(e,t,o),y(e,t)},p.formatEventTime=function(e){return p.formatTime(p.toTimelineRelativeTime(e))},p.eventTimeFromFormattedString=function(e){var t=Panopto.Core.TimeHelpers.durationFromFormattedString(e,Panopto.GlobalResources.TimeSeparator);return i.activeState().fromTimelineRelativeTime(t*Panopto.Core.Constants.TimelineChunkMultiplier)},p.ownsEvent=function(e){return _.contains(a,e.type)},p.clearInput=function(){P.val(""),C(),Panopto.Core.UI.Components.placeholder(P,s)},p.addEvent=function(e,t,o,n){void 0===u&&w();var a=Panopto.Core.ServiceInterface.Rest.Objects.Event({name:e,timelineTime:i.activeState().fromTimelineRelativeTime(u*Panopto.Core.Constants.TimelineChunkMultiplier),type:t,streamId:o&&c?c:d});return n&&(a.link=n),i.pushEdit(),p.events().push(a),i.applyState(),p.clearInput(),a},p.resize=function(e,t){P.width(e-Panopto.Viewer.Constants.InputMargin),m.width(e-Panopto.Viewer.Constants.InputOptionsMargin),f.resize(e,t-(P.length?P.outerHeight(!0):0)-(m.length?m.outerHeight(!0):0))},P.length&&(Panopto.Core.UI.Components.placeholder(P,s),P.keyup(function(){var e=$.trim(P.val());e&&"undefined"==typeof u?w():e||C()}),P.keydown(function(e){e.keyCode===Panopto.Core.Key.Enter&&(e.preventDefault(),"undefined"!=typeof u&&p.addEvent($.trim(P.val()))),e.stopPropagation()}),P.keydown(h)),p};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},Panopto.Viewer.Tabs.Editor.EditorTab=function(e,t,o,n,i,a){var r=Panopto.Viewer.Tabs.EventTab(e,t,o,void 0,[],void 0,!1,n),s=Panopto.Core.Extensions.base(r),l=[],u=(t.find(".event-tab-list"),t.find(".event-tab-none"));return r.templateDialog=function(e,t){},r.hasChanges=function(e,t){return!1},r.validate=function(e,t){return!0},r.populateEvent=function(e,t){},r.formatTime=function(e){return Panopto.Core.TimeHelpers.formatDuration(e,Panopto.GlobalResources.TimeSeparator,!0,Panopto.Viewer.Constants.DisplayTimeMillisecondPrecision)},r.validateTime=function(e,t,o){var n,a,s,l,u;return e?Panopto.Core.TimeHelpers.validateFormattedDuration(e,Panopto.GlobalResources.TimeSeparator,Panopto.Viewer.Constants.DisplayTimeMillisecondPrecision)?o||(s=t?_.find(i.activeState().streams(),function(e){return e.id===t}):void 0,s?(l=i.activeState().toTimelineRelativeTime(s.absoluteStart)/Panopto.Core.Constants.TimelineChunkMultiplier,u=i.activeState().toTimelineRelativeTime(s.absoluteEnd())/Panopto.Core.Constants.TimelineChunkMultiplier):(l=0,u=i.activeState().duration()/Panopto.Core.Constants.TimelineChunkMultiplier),l=Math.floor(l*Panopto.Viewer.Constants.DisplayTimePrecisionMultiplier)/Panopto.Viewer.Constants.DisplayTimePrecisionMultiplier,u=Math.floor(u*Panopto.Viewer.Constants.DisplayTimePrecisionMultiplier)/Panopto.Viewer.Constants.DisplayTimePrecisionMultiplier,a=Panopto.Core.TimeHelpers.durationFromFormattedString(e,Panopto.GlobalResources.TimeSeparator),(a<l||a>u)&&(n=Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_OutOfBounds.format(r.formatTime(l),r.formatTime(u)))):n=Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_InvalidTime:n=Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_NoTime,n},r.openEditDialog=function(e,t){var n,s;o.toggleScreens(!1),Panopto.ModalPopup.defaultInstance.show("#editorDialog",t||a,""),n=$("#editorDialog"),n.show(),s=$("#editorDialogContent"),r.templateDialog(s,e),Panopto.ModalPopup.defaultInstance.closeCriteria.push(function(){return!r.hasChanges(s,e)||confirm(Panopto.GlobalResources.ViewerPlus_Edit_Modal_Confirm)}),Panopto.Core.UI.Handlers.button($("#editorDialogSave"),function(){var t=e.copy();if(r.validate(s,t)){var o=_.find(l,function(e){return e.id===t.id}),n=l.indexOf(o);(r.hasChanges(s,t)||n===-1)&&(i.pushEdit(),n!==-1?l.splice(n,1,t):l.push(t),r.populateEvent(s,t),i.applyState()),Panopto.ModalPopup.defaultInstance.closeCriteria.length=0,Panopto.ModalPopup.defaultInstance.close()}}),Panopto.Core.UI.Handlers.button($("#editorDialogCancel"),function(){Panopto.ModalPopup.defaultInstance.close()}),s.keydown(function(e){e.stopPropagation()}),s.find("textarea, input").first().focus()},r.attachEditHandlers=function(e,t,o){var n=t.find(".event-edit-controls");Panopto.Core.UI.Handlers.button(t.find(".event-edit"),function(){r.openEditDialog(e)}),Panopto.Core.UI.Handlers.hoverableParent(t,n,function(e){o||t.find(".event-time").css("visibility",e?"hidden":""),n.toggle(e)})},r.attachDeleteHandlers=function(e,t){Panopto.Core.UI.Handlers.button(t.find(".event-delete"),function(){var t;i.pushEdit();var o=r.events();t=_.find(o,function(t){return e.id===t.id}),o.splice(o.indexOf(t),1),i.applyState()})},r.render=function(e){s.render(e,!1,!1,!0,!0),u.toggle(!_.any(e,function(e){return e.text}))},r.afterRenderItem=function(e,t,o){s.afterRenderItem(e,t,o),r.attachEditHandlers(_.find(l,function(t){return t.id===e.id}),t)},r.events=function(e){return"undefined"==typeof e?l:(l=e,void r.render())},r.valueChanged=function(e,t){var o=e.val();return e.val(t),t=e.val(),e.val(o),o!==t},r.toTimelineRelativeTime=function(e){return i.activeState().toTimelineRelativeTime(e.timelineTime)/Panopto.Core.Constants.TimelineChunkMultiplier},r.sessionRelativeTimeToViewerTime=function(e){return(e-i.activeState().firstPrimaryOffset())/Panopto.Core.Constants.TimelineChunkMultiplier},r.checkForEmbeddedUrlEvents=function(e){var t=!1,o=function(e,t,o){return e>t-Panopto.Viewer.Constants.UrlEventClosenessTolerance&&e<o+Panopto.Viewer.Constants.UrlEventClosenessTolerance};return _.find(i.activeState().questionLists(),function(n){var i=r.sessionRelativeTimeToViewerTime(n.sessionRelativeTime),a=i+Panopto.Viewer.Constants.UrlEventDuration;return o(e,i,a)&&(t=!0),t}),t||_.find(i.activeState().events(),function(n){if(n.link&&n.link.indexOf(Panopto.Viewer.Constants.YouTubeEmbedBaseUrl)!==-1){var i=r.toTimelineRelativeTime(n),a=i+Panopto.Viewer.Constants.UrlEventDuration;return o(e,i,a)&&(t=!0),t}}),t},r};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},Panopto.Viewer.Tabs.Editor.EditQuestionListTab=function(e,t,o,n,i){var a=Panopto.Viewer.Tabs.Editor.EditorTab(e,t,o,Panopto.Viewer.Analytics.Labels.EditQuestionList,n),r=Panopto.Core.Extensions.base(a),s=$("#addQuestionListButton");return a.render=function(){var e=_.map(a.events(),function(e){var t=a.sessionRelativeTimeToViewerTime(e.sessionRelativeTime);return{id:e.id,eventId:e.id,time:t,displayTime:Panopto.Core.TimeHelpers.formatDuration(t,Panopto.GlobalResources.TimeSeparator),text:e.name,deletable:!0,iconCode:Panopto.Core.Constants.QuestionListIconCode}});r.render(e),_.each(a.events(),function(e){a.attachDeleteHandlers(e,t.find("#"+e.id))})},a.position=function(e){s.toggleClass(Panopto.Core.Constants.DisabledClass,a.checkForEmbeddedUrlEvents(e)),r.position(e)},Panopto.Core.UI.Handlers.button(s,function(){s.hasClass(Panopto.Core.Constants.DisabledClass)||n.addQuestionList()}),a};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},Panopto.Viewer.Tabs.Editor.EditSlidesTab=function(e,t,o,n,i){var a=Panopto.Viewer.Analytics.EditSlides,r=Panopto.Viewer.Tabs.Editor.EditTOCEventTab(e,t,o,a,n,[Panopto.Core.EventType.SlideChange]),s=Panopto.Core.Extensions.base(r),l={},u=$("#slideDeckTemplate"),d=$("#slideTemplate"),c=$("#eventTemplate"),p=t.find(".event-tab-pane-header"),f=t.find("#slideDeckList"),P=function(){f.prepend(_.template(u.html(),{slideDecks:i})),_.each(i,function(e){var t=$("#"+e.id);Panopto.Core.UI.Handlers.button(t.find(".slide-deck-delete"),function(){var t,o;n.pushEdit(),t=n.activeState().events(),o=_.filter(t,function(t){return _.find(l[e.id],function(e){return e.id===t.slideId})}),_.each(o,function(e){t.splice(t.indexOf(e),1)}),n.activeState().slideDecksToDelete().push(e),n.applyState()})})},m=function(e){Panopto.Core.ServiceInterface.Rest.SlideDecks.getAllSlides(e.id,function(t){l[e.id]=t,v(e)},function(){})},v=function(e){var t=l[e.id],i=$("#"+e.id);i.find(".slide-list").html(_.template(d.html(),{slides:t})),_.each(t,function(e){var t=$("#"+e.id);Panopto.Core.UI.Handlers.button(t.find(".slide-add"),function(){var t=Panopto.Core.ServiceInterface.Rest.Objects.Event({name:e.name,metadata:e.content,timelineTime:n.activeState().fromTimelineRelativeTime(o.position()*Panopto.Core.Constants.TimelineChunkMultiplier),type:Panopto.Core.EventType.SlideChange,slideId:e.id,slideUrl:e.imageUrl,thumbnailUrl:e.imageUrl,slideDeckId:e.slideDeckId});n.pushEdit(),r.events().push(t),n.applyState()})});var a=i.find(".slide-deck-expand");Panopto.Core.UI.Handlers.button(a,function(){a.toggleClass(Panopto.Core.Constants.ExpandedClass),i.find(".slide-list").toggle(a.hasClass(Panopto.Core.Constants.ExpandedClass))}),a.show(),r.render(e)},h=function(e){var t=_.filter(r.events(),function(t){return t.type===Panopto.Core.EventType.SlideChange&&t.slideId===e.id}),n=_.map(t,function(t){var o=r.toTimelineRelativeTime(t);return{id:e.id+t.id,eventId:t.id,event:t,time:o,displayTime:Panopto.Core.TimeHelpers.formatDuration(o,Panopto.GlobalResources.TimeSeparator),text:"",editable:!0,deletable:!0}}),i=$("#"+e.id+" .slide-event-list");i.html(_.template(c.html(),{events:n}));var s=Panopto.Core.UI.Components.scrollingHighlight(i,!0,Panopto.Viewer.Constants.EventScrollTimeout);_.each(t,function(t){t.slideDeckId||(t.slideDeckId=e.slideDeckId)}),_.each(n,function(e){var t=i.find("#"+e.id);Panopto.Core.UI.Handlers.button(t,function(){s.highlight(e,function(e){o.position(e.time),Analytics.sendEvent({action:Panopto.Viewer.Analytics.Actions.Navigate,label:a})})}),r.attachEditHandlers(e.event,t,!0),r.attachDeleteHandlers(e.event,t)})};return r.render=function(e){var t=e?[e.id]:_.keys(l);_.each(t,function(e){var t=$("#"+e);t.toggle(!_.find(n.activeState().slideDecksToDelete(),function(t){return t.id===e})),_.each(l[e],h)})},r.resize=function(e,t){s.resize(e,t-p.outerHeight())},P(),_.each(i,m),Panopto.Viewer.StreamUploader({sessionId:n.session().id,streamType:Panopto.Core.StreamType.SecondaryPresentation,supportedExtensions:[".ppt",".pptx"],$addButton:$("#addSlideDeckButton"),$uploadList:f,invalidFileError:Panopto.GlobalResources.ViewerPlus_Edit_InvalidSlideDeck,onComplete:function(e){Panopto.Core.ServiceInterface.Rest.Sessions.getAllSlideDecks(n.session().id,function(t){var o=_.filter(t,function(e){return!_.find(i,function(t){return t.id===e.id})});_.each(o,function(t){e.after(_.template(u.html(),{slideDecks:[t]})),i.push(t),m(t)}),e.remove()},function(){})}}),r};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},
Panopto.Viewer.Tabs.Editor.EditStreamTab=function(e,t,o,n){var i=Panopto.Viewer.Tabs.Editor.EditorTab(e,t,o,Panopto.Viewer.Analytics.Labels.EditStream,n,Panopto.GlobalResources.ViewerPlus_Edit_Modal_EditStreamTitle),a=Panopto.Core.Extensions.base(i),r=function(e){return n.activeState().toTimelineRelativeTime(e)/Panopto.Core.Constants.TimelineChunkMultiplier},s=function(e){return n.activeState().fromTimelineRelativeTime(e*Panopto.Core.Constants.TimelineChunkMultiplier)};return i.templateDialog=function(e,t){e.html(_.template($("#editStreamTemplate").html(),{stream:{name:t.name,streamType:n.getStreamFriendlyType(t),displayType:t.isPrimary?Panopto.GlobalResources.ViewerPlus_Edit_Primary:Panopto.GlobalResources.ViewerPlus_Edit_Secondary,length:Panopto.Core.TimeHelpers.formatDuration(t.duration/Panopto.Core.Constants.TimelineChunkMultiplier,Panopto.GlobalResources.TimeSeparator,!1,Panopto.Viewer.Constants.DisplayTimeMillisecondPrecision),startTime:i.formatTime(r(t.absoluteStart)),iconCode:o.getStreamIconCode(t)}}))},i.hasChanges=function(e,t){var o=i.valueChanged(e.find(".edit-stream-name"),t.name);return o=o||e.find(".edit-stream-time").val()!==i.formatTime(r(t.absoluteStart))},i.validate=function(e,t){var o=i.validateTime(e.find(".edit-stream-time").val(),t.id,!0);return e.find(".edit-stream-time-error").text(o||""),!o},i.populateEvent=function(e,t){var o,i=n.activeState().absoluteStart(),a=n.activeState().firstPrimaryOffset(),r=s(Panopto.Core.TimeHelpers.durationFromFormattedString(e.find(".edit-stream-time").val(),Panopto.GlobalResources.TimeSeparator)),l=r-t.absoluteStart,u=function(e){var t=[];e&&(_.each(n.activeState().cuts(),function(o){o.targetType===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Session&&(o.end()+e<=0||o.start+e>=n.activeState().duration()?t.push(o):(o.start=Math.max(o.start+e,0),o.duration=Math.min(o.duration,n.activeState().duration()-o.start)))}),_.each(t,function(e){n.activeState().cuts().splice(n.activeState().cuts().indexOf(e),1)}))};t.name=e.find(".edit-stream-name").val(),t.absoluteStart=r,n.activeState().refreshTimeline(),_.each(n.activeState().events(),function(e){e.streamId===t.id&&(e.timelineTime+=l,e.edited=!0)}),u(i-n.activeState().absoluteStart()),u(n.activeState().firstPrimaryOffset()-a),t.isPrimary&&(o=_.filter(n.activeState().cuts(),function(e){return e.targetId===t.id}),_.each(o,function(e){n.activeState().cuts().splice(n.activeState().cuts().indexOf(e),1)}),n.applyPrimaryHeuristicCuts())},i.render=function(){var e=_.map(i.events(),function(e){var t=r(e.absoluteStart),i=r(e.absoluteEnd());return{id:e.id,eventId:e.id,time:t,displayTime:"{0} - {1}".format(Panopto.Core.TimeHelpers.formatDuration(t,Panopto.GlobalResources.TimeSeparator),Panopto.Core.TimeHelpers.formatDuration(i,Panopto.GlobalResources.TimeSeparator)),text:n.getStreamName(e,e.id,!0),editable:!0,timeRange:!0,iconCode:o.getStreamIconCode(e)}});a.render(e)},i};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},Panopto.Viewer.Tabs.Editor.EditTOCEventTab=function(e,t,o,n,i,a,r,s){var l=Panopto.Viewer.Tabs.Editor.EditEventTab(e,t,o,n,i,a,Panopto.GlobalResources.ViewerPlus_Edit_Modal_EditTOCTitle,r,s),u=(Panopto.Core.Extensions.base(l),window.location.protocol+"//"),d=/^.*?:\/\//;return l.templateDialog=function(e,t){var o=function(){var o,n,a=[];l.validateTime(e.find(".edit-contents-time").val())?a.push(_.find(i.activeState().streams(),function(e){return e.id===t.streamId})):(o=l.valueChanged(e.find(".edit-contents-time"),l.formatEventTime(t))?l.eventTimeFromFormattedString(e.find(".edit-contents-time").val()):t.timelineTime,a=i.activeState().activeStreams(o)),e.find(".edit-contents-stream").html(_.template($("#editStreamOptionTemplate").html(),{streams:_.map(a,function(e){return{id:e.id,displayName:i.getStreamName(e,e.id,!0)}})})),n=_.find(a,function(e){return e.id===t.streamId})||a[0],e.find(".edit-contents-stream").val(n.id)};e.html(_.template($("#editContentsTemplate").html(),{event:{name:t.name,formattedTime:l.formatEventTime(t),thumbnailSrc:t.thumbnailUrl||Panopto.cacheRoot+"/Styles/Less/Application/Images/Widgets/audio_only_large.png",thumbnailGenerated:!t.thumbnailUrl,metadata:t.metadata,scheme:u,link:t.link?t.link.replace(d,""):"",streamId:t.streamId}})),t.streamId&&(o(),e.find(".edit-contents-time").blur(o)),e.find(".edit-contents-link").width(e.find(".edit-contents-link").width()-e.find(".edit-contents-link-scheme").width()-5)},l.hasChanges=function(e,t){var o=l.valueChanged(e.find(".edit-contents-title"),t.name);return o=o||l.valueChanged(e.find(".edit-contents-time"),l.formatEventTime(t)),o=o||t.streamId&&t.streamId!==e.find(".edit-contents-stream").val(),o=o||l.valueChanged(e.find(".edit-contents-metadata"),t.metadata),o=o||l.valueChanged(e.find(".edit-contents-link"),t.link?t.link.replace(d,""):"")},l.validate=function(e,t){var o=l.validateTime(e.find(".edit-contents-time").val(),e.find(".edit-contents-stream").val()||void 0);return e.find(".edit-contents-time-error").text(o||""),!o},l.populateEvent=function(e,t){var o=e.find(".edit-contents-link").val(),n=e.find(".edit-contents-stream").val();t.name=e.find(".edit-contents-title").val(),t.timelineTime=l.eventTimeFromFormattedString(e.find(".edit-contents-time").val()),t.metadata=e.find(".edit-contents-metadata").val(),t.link=o?u+o.replace(d,""):void 0,t.streamId&&t.streamId!==n&&(t.id=_.uniqueId("event"),t.streamId=n,t.thumbnailUrl=void 0,t.slideUrl=void 0),t.edited=!0},l};var Panopto=Panopto||{};Panopto.Viewer=Panopto.Viewer||{},Panopto.Viewer.Tabs=Panopto.Viewer.Tabs||{},Panopto.Viewer.Tabs.Editor=Panopto.Viewer.Tabs.Editor||{},Panopto.Viewer.Tabs.Editor.EditTranscriptTab=function(e,t,o,n){var i=Panopto.Viewer.Tabs.Editor.EditEventTab(e,t,o,Panopto.Viewer.Analytics.EditTranscript,n,[Panopto.Core.EventType.Caption],Panopto.GlobalResources.ViewerPlus_Edit_Modal_EditCaptionTitle,Panopto.GlobalResources.ViewerPlus_Edit_AddCaption),a=Panopto.Core.Extensions.base(i),r=t.find("#editTranscriptPaneHeader"),s=r.find("#importTranscriptButton"),l=r.find("#importTranscriptPopup"),u=r.find("#importMachineTranscriptButton"),d=r.find("#requestTranscriptButton");return i.render=function(){var e=n.activeState().filterEvents(Panopto.Core.EventType.Caption).length>0;u.text(e?Panopto.GlobalResources.ViewerPlus_Edit_ReplaceWithMachineTranscript:Panopto.GlobalResources.ViewerPlus_Edit_ImportMachineTranscript),a.render()},i.templateDialog=function(e,t){e.html(_.template($("#editTranscriptTemplate").html(),{event:{name:t.name,formattedTime:i.formatEventTime(t)}}))},i.hasChanges=function(e,t){var o=i.valueChanged(e.find(".edit-transcript-title"),t.name);return o=o||i.valueChanged(e.find(".edit-transcript-time"),i.formatEventTime(t))},i.validate=function(e,t){var o,n;return o=!!$.trim(e.find(".edit-transcript-title").val()),e.find(".edit-transcript-title-error").text(o?"":Panopto.GlobalResources.ViewerPlus_Edit_Modal_Error_NoCaption),n=i.validateTime(e.find(".edit-transcript-time").val(),t.streamId),e.find(".edit-transcript-time-error").text(n||""),o=o&&!n},i.populateEvent=function(e,t){t.name=e.find(".edit-transcript-title").val(),t.timelineTime=i.eventTimeFromFormattedString(e.find(".edit-transcript-time").val()),t.edited=!0},i.addEvent=function(e){a.addEvent(e,Panopto.Core.EventType.Caption)},Panopto.Core.UI.Components.popup(l,s,function(){l.show().css({top:r.outerHeight()+"px"}),u.toggle(n.activeState().filterEvents(Panopto.Core.EventType.SpeechRecognition).length>0)},void 0,!0),Panopto.Core.UI.Handlers.button(u,function(){var e;l.hide(),n.pushEdit(),e=_.map(n.activeState().filterEvents(Panopto.Core.EventType.SpeechRecognition),function(e){var t=e.copy();return t.id=_.uniqueId("event"),t.type=Panopto.Core.EventType.Caption,t}),_.each(n.activeState().filterEvents(Panopto.Core.EventType.Caption),function(e){i.events().splice(i.events().indexOf(e),1)}),_.each(e,function(e){i.events().push(e)}),n.applyState()}),Panopto.Core.UI.Handlers.button(d,function(){l.hide(),o.toggleScreens(!1),Panopto.Application.defaultInstance.updateState({modalPage:"SessionTranscript",modalHeader:Panopto.Core.TextHelpers.innerText(n.session().name),modalParams:Panopto.Core.StringHelpers.serializeObjectToQueryString({id:n.session().id})})}),i};